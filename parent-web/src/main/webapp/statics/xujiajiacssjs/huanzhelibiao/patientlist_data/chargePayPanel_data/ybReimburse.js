var ybContextUrl="/pinganwj-mip-web-server/i/clientEntrance/dispatchClient";function ybReimburse(){}ybReimburse.prototype={constructor:ybReimburse,getYBPersonInfo:function(c,d,a){var b={appCode:"A0001"};c=$.extend({},c,b);this.remoteCallYB(c,function(e){d(e)},function(e){a(e)})},ybGHDJ:function(b,c){var a={appCode:"A0002"};b=$.extend({},b,a);this.remoteCallYB(b,function(d){c(d)})},ybDJ:function(b,c){var a={appCode:"A0004"};b=$.extend({},b,a);this.remoteCallYB(b,function(d){c(d)})},ybFYUpload:function(b,c){var a={appCode:"A0005"};b=$.extend({},b,a);this.remoteCallYB(b,function(d){c(d)})},ybPay:function(c,a){var b={appCode:"A0007"};c=$.extend({},c,b);this.remoteCallYBChargeInterface(c,function(d){a(d)})},ybRefund:function(b,c){var a={appCode:"A0006"};b=$.extend({},b,a);this.remoteCallYB(b,function(d){c(d)})},ybMZTH:function(b,c){var a={appCode:"A0010"};b=$.extend({},b,a);this.remoteCallYB(b,function(d){c(d)})},remoteCallYB:function(e,h,g,d){var a=this;if(!this.checkYBPermission()){return}var f=this.getYBBaseInfo();var c={yljgbm:f.ybClinicId,czybm:f.ybOperatorId,czyxm:f.ybOperatorName,};var b="https://"+f.miIpAddr+ybContextUrl;e=$.extend({},e,c);$.ajax({type:"get",async:false,url:b+"?param="+encodeURIComponent(encodeURIComponent(JSON.stringify(e))),beforeSend:function(){Utils.addLoadingMaskTo(null,"医保处理中...")},dataType:"jsonp",jsonp:"backMsg",success:function(i){if(i.errorCode=="E0000000"){if(i.data){if(i.data.clientRet.indexOf("SUC")==-1){$.paConfirm({msg:i.data.clientRet,saveTxt:"确定",hideCancel:true,onYes:function(){}})}else{h(i.data.clientResult)}}else{$.paConfirm({msg:i.errorMessage||i.data.clientRet,saveTxt:"确定",hideCancel:true,onYes:function(){}})}}else{$.paConfirm({msg:i.errorMessage||i.data.clientRet,saveTxt:"确定",hideCancel:true,onYes:function(){}})}},error:function(){$.paConfirm({msg:"医保服务连接失败",saveTxt:"确定",hideCancel:true,onYes:function(){}})},complete:function(){Utils.removeLoadingMaskFrom()}})},remoteCallYBChargeInterface:function(d,g,f,c){if(!this.checkYBPermission()){return}var e=this.getYBBaseInfo();var b={yljgbm:e.ybClinicId,czybm:e.ybOperatorId,czyxm:e.ybOperatorName,};var a="https://"+e.miIpAddr+ybContextUrl;d=$.extend({},d,b);$.ajax({type:"get",async:false,beforeSend:function(){Utils.addLoadingMaskTo(null,"医保处理中...")},url:a+"?param="+encodeURIComponent(encodeURIComponent(JSON.stringify(d))),dataType:"jsonp",jsonp:"backMsg",timeout:180000,success:function(h){if(h.errorCode=="E0000000"){if(h.data){if(h.data.clientRet.indexOf("SUC")==-1){if(h.data.clientRet&&h.data.clientRet.indexOf("ERR:(31140004)")>-1){g(h.data.clientResult)}else{$.paConfirm({msg:h.data.clientRet||h.errorMessage||" 医保系统异常，请到收费记录重新发起医保支付",saveTxt:"确定",hideCancel:true,onYes:function(){}})}}else{g(h.data.clientResult)}}else{$.paConfirm({msg:h.errorMessage||" 医保系统异常，请到收费记录重新发起医保支付",saveTxt:"确定",hideCancel:true,onYes:function(){}})}}else{$.paConfirm({msg:h.errorMessage||" 医保系统异常，请到收费记录重新发起医保支付",saveTxt:"确定",hideCancel:true,onYes:function(){}})}},error:function(h){$.paConfirm({msg:h.errorMessage||" 医保系统异常，请到收费记录重新发起医保支付！",saveTxt:"确定",hideCancel:true,onYes:function(){}})},complete:function(){Utils.removeLoadingMaskFrom()}})},saveYBBizState:function(d,e){var b={type:"POST",url:ContextClinc_Server+"ybReimburse/saveYBBizState",data:JSON.stringify(d),dataType:"json",contentType:"application/json; charset=utf-8",async:true,showMask:true};var a=this;var c=Utils.myAjaxHandler(b);c.done(function(f){if(f.errorCode=="E0000000"){e(f.data)}else{$.paError(f.errorMessage)}}).error(function(){$.paError("请求未响应，请检查网络连接！")}).always(function(){})},updateYBBizState:function(d,e){var b={type:"POST",url:ContextClinc_Server+"ybReimburse/updateYBBizState",data:JSON.stringify(d),dataType:"json",contentType:"application/json; charset=utf-8",async:true,showMask:true};var a=this;var c=Utils.myAjaxHandler(b);c.done(function(f){if(f.errorCode=="E0000000"){e(f.data)}else{$.paError(f.errorMessage)}}).error(function(){$.paError("请求未响应，请检查网络连接！")}).always(function(){})},updateChargeItemState:function(d,e){var d={};var b={type:"POST",url:ContextClinc_Server+"charge/updateChargeItemState",data:JSON.stringify(d),dataType:"json",contentType:"application/json; charset=utf-8",async:true,showMask:true};var a=this;var c=Utils.myAjaxHandler(b);c.done(function(f){if(f.errorCode=="E0000000"){e(f.data)}else{$.paError(f.errorMessage)}}).error(function(){$.paError("请求未响应，请检查网络连接！")}).always(function(){})},getYBBizNo:function(b,f){var e={bizPrefix:b};var c={type:"POST",url:ContextClinc_Server+"ybReimburse/getYBBizNo",data:JSON.stringify(e),dataType:"json",contentType:"application/json; charset=utf-8",async:true,showMask:true};var a=this;var d=Utils.myAjaxHandler(c);d.done(function(g){if(g.errorCode=="E0000000"){f(g.data)}else{$.paError(g.errorMessage)}}).error(function(){$.paError("请求未响应，请检查网络连接！")}).always(function(){})},checkYBPermission:function(){var a=session_cache.getCache("ybData");if(!Utils.notBlank(a)){parent.getYBData(function(d){session_cache.setCache("ybData",d);a=d})}if(!Utils.notBlank(a)){$.paWarn("诊所未开通医保服务！");return false}var b=a.clinicInfo;var c=a.curEmployeeInfo;if(!b||(b&&b.miOpenFlag==1)){$.paWarn("诊所未开通医保服务！");return false}if(!c){$.paWarn("当前操作员未匹配到对应医保用户！");return false}return true},getYBBaseInfo:function(){var a=session_cache.getCache("ybData");if(!Utils.notBlank(a)){parent.getYBData(function(e){session_cache.setCache("ybData",e);a=e})}var d={ybClinicId:null,ybOperatorId:null,ybOperatorName:null,miIpAddr:null};if(a&&a.clinicInfo){var b=a.clinicInfo;var c=a.curEmployeeInfo;ybClinicId=b.orgCode;ybOperatorId=c.miEmployeeCode;ybOperatorName=c.miEmployeeName;d={ybClinicId:ybClinicId,miIpAddr:b.miIpAddr,ybOperatorId:ybOperatorId,ybOperatorName:ybOperatorName}}return d}};