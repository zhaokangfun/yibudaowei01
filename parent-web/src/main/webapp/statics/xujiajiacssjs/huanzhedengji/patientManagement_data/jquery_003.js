(function(b){b.fn.extend({setInputDrop:function(d,c,e){new a(b(this),d,c,e);return b(this)},});function a(e,d,c,f){this._input=e;this._inputParent=e.parent();this._data=b.extend([],this._data,d);this._default=b.extend({},this._default,c);this._callback=f;this._init()}a.prototype={_data:[],_default:{idKey:"id",txtKey:"txt",isNeedDel:false,isNeedSave:false,showMaxNum:5,itemHeight:28,dropWidth:false,isNeedThink:false},_key:{up:38,right:39,down:40,left:37,enter:13,pageUp:33,pageDown:34,tab:9},_dataBox:null,_dropHeight:0,_dropUlHeight:0,_dataLength:0,_timer:null,_init:function(){this.initDom();this.initStyle();this.bindEvent()},initDom:function(){this._inputParent.find(".input_drop_data_box").remove();var e='<div class="input_drop_data_box">                <ul class="input_drop_data">                </ul>                <div class="input_drop_save_box">                    <span class="input_drop_save_btn">保存</span>                    <div class="input_drop_save_new"><input class="input_drop_save_input" placeholder="快速添加常用语" maxlength="20"><div>                </div>            </div>';this._inputParent.append(e);var g=this._data;var f=this._dataLength=this._data.length;var h=this._inputParent.find(".input_drop_data_box");for(var c=0;c<f;c++){var d=b("<li></li>");d.data("tempData",g[c]).attr("data-value",g[c][this._default.idKey]).text(g[c][this._default.txtKey]);if(this._default.isNeedDel){d.append('<i class="input_drop_del_icon" title="删除">×</i>')}c%2==0?d.addClass("even_item"):d.addClass("odd_item");this._inputParent.find(".input_drop_data").append(d)}if(!this._default.isNeedSave){this._inputParent.find(".input_drop_save_box").remove()}},initStyle:function(){var c=this;this._dropHeight=0;if(this._default.isNeedSave){this._dropHeight+=40}if(this._default.showMaxNum>this._data.length){this._dropHeight+=this._data.length*28;this._dropUlHeight=this._data.length*28}else{this._dropHeight+=this._default.showMaxNum*28;this._dropUlHeight=this._default.showMaxNum*28}this._inputParent.find(".input_drop_data").height(c._dropUlHeight);var d=b("head").html();if(d.indexOf(".input_drop_data_box")==-1){b("head").append("<style>.input_drop_data li{height:"+c._default.itemHeight+"px;line-height:"+c._default.itemHeight+"px;}</style>");var e="                    <style>                        .input_drop{position:relative;}                        .input_drop_data_box{position: absolute; width: 100%; border:1px solid #dfdfdf; box-sizing:border-box; z-index:999;}                        .input_drop_data{overflow-y:auto;background:#fff;position:absolute; width:100%;}                        .input_drop li{padding:0 20px 0 8px; text-align:left; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; position: relative; cursor:pointer}                        .input_drop .even_item{background:#fff;}                        .input_drop .odd_item{background:#eff4f8;}                        .input_drop .over_item{background:#01a9db; color:#fff;}                        .input_drop .input_drop_del_icon{display:none; position:absolute; top:-1px; right:2px; font-style:normal; font-size:18px; cursor:pointer; color:#666;}                        .input_drop .over_item .input_drop_del_icon{display:block; color:#fff;}                        .input_drop .input_drop_save_box{height:40px; box-sizing:border-box; padding:8px; overflow:hidden; position:absolute; width:100%; background:#f9f9f9;}                        .input_drop .input_drop_save_new{height:24px; box-sizing:border-box; margin-right:64px;}                        .input_drop .input_drop_save_btn{float:right; background: #01a9db; width:50px; height:24px; box-sizing:border-box; line-height:21px; text-align:center; color:#fff; border-radius:3px; cursor:pointer;}                        .input_drop .input_drop_save_input{width:100%; height:24px; box-sizing:border-box; border:1px solid #dfdfdf; text-indent:4px; line-height:22px; background:#fff;}                    </style>                ";b("head").append(e)}this._dataBox=this._inputParent.find(".input_drop_data_box");if(this._default.dropWidth){this._dataBox.width(this._default.dropWidth)}this._dataBox.height(this._dropHeight).hide()},bindEvent:function(){var c=this;c._input.off("keydown").off("focus").on({focus:function(){b(".input_drop").find(".input_drop_data_box").hide();c.posDom()},keydown:function(d){var d=d||event;var f=d.keyCode;switch(f){case c._key.up:d.preventDefault();if(c._dataBox.is(":visible")){c.moveSelect(-1)}break;case c._key.down:d.preventDefault();if(c._dataBox.is(":visible")){c.moveSelect(1)}break;case c._key.enter:d.preventDefault();if(c._dataBox.is(":visible")){c.selectOverItem()}break;case c._key.tab:d.preventDefault();if(c._dataBox.is(":visible")){c.moveSelect(c._default.showMaxNum)}break;case c._key.pageDown:d.preventDefault();if(c._dataBox.is(":visible")){c.moveSelect(c._default.showMaxNum)}break;case c._key.pageUp:d.preventDefault();if(c._dataBox.is(":visible")){c.moveSelect(-c._default.showMaxNum)}break}}});if(c._default.isNeedThink){c._input.off("keyup").on("keyup",function(d){if(d.keyCode==c._key.up||d.keyCode==c._key.down||d.keyCode==c._key.enter||d.keyCode==c._key.tab||d.keyCode==c._key.pageDown||d.keyCode==c._key.pageUp){return}clearTimeout(c._timer);c._timer=setTimeout(function(){var e=b.trim(c._input.val());if(typeof c._default.isNeedThink[1]=="function"){c._default.isNeedThink[1](e)}},500)})}c._inputParent.find(".input_drop_data_box li").off("mouseenter").off("click").on({mouseenter:function(){b(this).addClass("over_item").siblings().removeClass("over_item")},click:function(f){var d=this;setTimeout(function(){if(!b(f.target).hasClass("input_drop_del_icon")){var e=b.trim(c._input.val());if(c._input.hasClass("pawjzs-error")){e=""}c._input.removeClass("pawjzs-error");if(e==""){c._input.val(b(d).data("tempData")[c._default.txtKey])}else{c._input.val(e+"; "+b(d).data("tempData")[c._default.txtKey])}c._inputParent.find(".input_drop_data_box").hide();if(c._callback){c._callback(b(d).data("tempData"))}}else{var g={};g[c._default.idKey]=b(d).attr("data-value");c.deleteDataForSql(g)}},300)}});b(document).on("click",function(d){var d=d||event;if(!b(d.target).hasClass("input_drop")&&!b(d.target).parents().hasClass("input_drop")){b(".input_drop").find(".input_drop_data_box").hide()}});c._inputParent.find(".input_drop_save_btn").off("click").on("click",function(){var d={};d[c._default.txtKey]=c._inputParent.find(".input_drop_save_input").val();c.saveDataForSql(d)})},posDom:function(){var c=this;var d=b(window).height()-c._input.offset().top+b(window).scrollTop()-c._input.outerHeight();if(d-c._dropHeight<50){c._inputParent.find(".input_drop_data_box").css("top",-c._dropHeight-2);c._inputParent.find(".input_drop_save_box").css("top",0);if(c._default.isNeedSave){c._inputParent.find(".input_drop_data").css("top",40)}else{c._inputParent.find(".input_drop_data").css("top",0)}}else{c._dataBox.css("top",c._input.outerHeight()+1);c._inputParent.find(".input_drop_save_box").css("top",c._dropUlHeight);c._inputParent.find(".input_drop_data").css("top",0)}c._inputParent.find(".input_drop_data li").removeClass("over_item");c._inputParent.find(".input_drop_save_input").val("");c._dataBox.fadeIn();c.jumpToItem()},moveSelect:function(f){var e=this;var c=e._inputParent.find(".input_drop_data_box .over_item").removeClass("over_item").index();var g=e._dataLength;var d=c+f;if(d>g-1){d=g-1}if(d<0){d=0}e._inputParent.find(".input_drop_data_box li").eq(d).addClass("over_item");e.scrollToItem()},selectOverItem:function(){this._inputParent.find(".input_drop_data_box li.over_item").click()},scrollToItem:function(){var c=this._inputParent.find(".input_drop_data_box .over_item").index();var d=-this._dropUlHeight/2+this._default.itemHeight*c;this._inputParent.find(".input_drop_data").scrollTop(d)},jumpToItem:function(){var c=this;this._inputParent.find(".input_drop_data_box li").eq(0).addClass("over_item");this._inputParent.find(".input_drop_data_box li").each(function(d){if(b(this).attr("data-value")==c._input.attr("val")){b(this).addClass("over_item").siblings().removeClass("over_item");return false}});c.scrollToItem()},deleteDataForSql:function(c){if(typeof this._default.isNeedDel[1]=="function"){this._default.isNeedDel[1](c)}},saveDataForSql:function(c){if(typeof this._default.isNeedSave[1]=="function"){this._default.isNeedSave[1](c)}}}})(jQuery);