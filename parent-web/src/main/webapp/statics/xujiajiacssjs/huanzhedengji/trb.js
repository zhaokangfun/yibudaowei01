var trb=function(a,d,c){this.trbPop=$("#"+c);this.flag=a;if(d){this.mobilePhoneNumber=d.mobilePhoneNumber||"";this.empiId=d.empiId}this.init();var b=this;if(this.flag!=2&&this.flag!=3){$(".popPhone").find(".close").on("click",function(){b.trbPop.remove()})}};trb.prototype={init:function(){var a=this;if(this.flag==0){a.downloadShow()}else{if(this.flag==1){a.callShow()}else{if(this.flag==2||this.flag==3){a.cidShow()}else{if(this.flag==5){a.manageShow()}else{if(this.flag==6){a.uploadShow()}}}}}},callShow:function(){var c,a=this;var f='<div class="popcontent" id="callContent">		            <div class="patient-popup-contain">		        <div class="popup-header clear">		            <div class="patient-name"></div>		            <div class="patient-information"><span id="sexAndPatientBirthDate">女/24岁/</span><div class="bl-svg"></div>        			<span id="PATIENT_NO">v12345678/</span><div class="bh-svg"></div><span id="mobilePhoneNumber">18676692222<span></div>		            <div class="phone-state">拨号中...</div>		        </div>		        <div class="information-title">就诊信息</div>		        <table class="information-table">		            <tr>		                <td id="c-date1">就诊日期：</td>		                <td id="c-doctor1" >初诊医生：</td>		                <td id="c-record1" >诊断：</td>		            </tr>		            <tr>		                <td id="c-date2" >最近复诊：</td>		                <td id="c-doctor2" >复诊医生：</td>		                <td id="c-record2" >诊断：</td>		            </tr>		            <tr>		                <td id="c-money1" >累计消费：</td>		                <td id="c-money2" >目前欠费：</td>        				<td></td>		            </tr>		        </table>		        <div class="information-title">预约信息</div>        		<div style="display:none;" class="none-notice">暂无信息</div>		        <table class="doctor-table">		            <thead>		                <tr>		                    <td>预约日期</td>		                    <td>预约时间段</td>		                    <td>类型</td>		                    <td>预约医生/科室</td>		                    <td>预约事项</td>		                    <td>备注</td>		                    <td>操作</td>		                </tr>		            </thead>		            <tbody>		            </tbody>		        </table>		        <div class="btn-contain clear">		            <div class="btn-see">查看健康档案</div>		            <div class="btn-addAppointment">新增预约</div>		            <div class="btn-addFollow">新增随访</div>		        </div>		    </div>		</div>';this.trbPop.find(".popstyle").append(f);var e={empiId:a.empiId,mobilePhoneNumber:a.mobilePhoneNumber};var b={type:"POST",contentType:"application/json; charset=utf-8",url:ContextClinc_Server+"trbInfo/getPatientBaseInfoMore",data:JSON.stringify(e),dataType:"json",async:true,showMask:true};var d=Utils.myAjaxHandler(b);d.done(function(g){if(g.errorCode==SUCCESSCODE){c=g.data;if(c){a.callAppend(c);a.trbPop.show()}}}).fail(function(g){$.paError("请求异常",null)}).always(function(){})},callAppend:function(f){var b=f.keyPatientInfo;var g=f.diagonissMap;var j=f.apptItems;var i=f.apptrecord;var k=this;var c=b.empiId;$(".btn-see").attr("empiId",c);$(".addAppointment").attr("empiId",c);$(".btn-addFollow").attr("empiId",c);$("#c-birth").html((b.patientBirthDate!=null)?b.patientBirthDate:"-");$(".patient-name").html(b.patientName);var a="";var h="";if(b.patientGender){h=(b.patientGender!=1)&&(b.patientGender!=2)?"保密":(b.patientGender!=2?"男":"女")}var e=(b.patientBirthDate!=null)?Utils.getPersonAccurateAge(b.patientBirthDate,"岁","个月"):"";if(!Utils.isBlank(h)){a=e+"/"}else{a=h+"/"+e+"/"}$("#sexAndPatientBirthDate").text(a);if(f.patientClinicRelInfo){$("#PATIENT_NO").html((f.patientClinicRelInfo.PATIENT_NO||"-"))}else{$("#PATIENT_NO").html("-")}$("#mobilePhoneNumber").html(b.mobilePhoneNumber);if(g){$("#c-date1").html("就诊日期："+(g.add_date||"-"));$("#c-doctor1").html("初诊医生："+(g.doctor_name||"-"));$("#c-record1").html("诊断："+(g.diagnosis||"-"));$("#c-date2").html("最近复诊："+(g.rp_add_date||"-"));$("#c-doctor2").html("复诊医生："+(g.rp_doctor_name||"-"));$("#c-record2").html("诊断："+(g.rp_diagnosis||"-"))}else{$("#c-date1").html("就诊日期：-");$("#c-doctor1").html("初诊医生：-");$("#c-record1").html("诊断：-");$("#c-date2").html("最近复诊：-");$("#c-doctor2").html("复诊医生：-");$("#c-record2").html("诊断：-")}if(j){if(j.totalMoney){$("#c-money1").html("累计消费："+(j.totalMoney.toFixed(2)||"-"))}else{$("#c-money1").html("累计消费：0.00")}if(j.oweMoney){$("#c-money2").html("目前欠费："+(j.oweMoney.toFixed(2)||"-"))}else{$("#c-money2").html("目前欠费：0.00")}}else{$("#c-money1").html("累计消费：-");$("#c-money2").html("目前欠费：-")}$("body").delegate(".see-popup-bg .close","click",function(){$(".see-popup-bg").hide()});$(".btn-addAppointment").on("click",function(){var l={};var m=$(".addAppointment").attr("empiId");if(m){l={empiId:k.empiId}}else{l={phoneNumber:k.mobilePhoneNumber}}window.parent.newAppt(l)});$(".btn-addFollow").on("click",function(){var m=$(".btn-addFollow").attr("empiId");if(m){var l="../clinic/followUp/new_follow_up.html?empiId="+m;k.popWindow(l,"新增随访")}});$(".btn-see").on("click",function(){var m=$(".btn-see").attr("empiId");if(m){var l="../clinic/patientArchives/patientDocument.html?id="+m+"&flag=0";k.popWindow(l,"健康档案")}});k.queryApptByEmpiId(k.empiId,function(m){if(m&&m.length>0){$(".none-notice").hide();var l="";$.each(m,function(q,s){var o="";if(s.APPT_TYPE==1){o="初诊"}else{if(s.APPT_TYPE==2){o="复诊"}}var p=true;var n=s.FAPPTSTATUS;var t=s.IS_CONFIRM;var u=s.IS_CLINIC_TREATMENT_CONFIRM;if(n=="0"){p=false}else{if(n=="1"){if(t=="1"&&u=="0"){}else{if(u=="1"){p=false}else{if(t=="1"){}else{}}}}else{if(n=="2"||n=="3"||n=="4"||n=="5"){p=false}else{if(n=="8"){p=false}else{if(n=="9"){p=false}}}}}var r="";if(p){r='<span recordId="'+s.RECORD_ID+'"class="modify-btn">修改</span></td>'}l+="<tr><td>"+(s.FSCHEDATE||"-")+"</td><td>"+(s.FSCHESTARTTIME||"-")+"-"+(s.FSCHEENDTIME||"-")+"</td><td>"+o+"</td><td>"+(s.DOCTOR_NAME||"未分配医生")+"</td><td>"+(s.FAPPTITEM||"-")+"</td><td>"+(s.APPT_REMARK||"-")+'</td><td><span recordId="'+s.RECORD_ID+'"class="detail-btn">详情</span>'+r+"</tr>"});$(".doctor-table").find("tbody").html(l);$(".doctor-table .modify-btn").on("click",function(){editAppt($(this).attr("recordid"))});$(".doctor-table .detail-btn").on("click",function(){appt_line_detail($(this).attr("recordid"))})}else{$(".doctor-table").hide();$(".none-notice").show()}});var d="";if(k.empiId){d=k.empiId}window.parent.callObj.CallRecord.empiId=d;window.parent.callObj.CallRecord.patientName=b.patientName;window.parent.callObj.CallRecord.mobilePhoneNumber=b.mobilePhoneNumber;window.parent.callObj.CallRecord.callStatus="1";window.parent.callObj.startTime=new Date()},queryApptByEmpiId:function(c,d){if(c){a={empiId:c};var a={type:"POST",contentType:"application/json; charset=utf-8",url:ContextClinc_Server+"clinicAppt/queryApptByEmpiId",data:JSON.stringify(a),dataType:"json"};var b=Utils.myAjaxHandler(a);b.done(function(e){if(e.errorCode==SUCCESSCODE){data=e.data;if(data){d.call(self,data)}}}).fail(function(e){$.paError("请求异常",null)}).always(function(){})}},popWindow:function(b,a){var c='<div class="see-popup-bg">';c+='<div class="new-popup new-popup-window">';c+='<div class="popstyle">';c+='<div class="poptitle">';c+='<span class="title">'+a+"</span>";c+='<span class="close">×</span>';c+="</div>";c+='<div class="popcontent">';c+='<iframe height="100%" width="100%" src='+b+' id="paFrame" name="paFrame" scrolling="no" frameborder="no" marginheight="0" marginwidth="0" allowtransparency="true" onload="javascript:SetWinSize()"></iframe>';c+="</div>";c+="</div>";c+="</div>";c+="</div>";$("body").append(c)},cidShow:function(){var d,b=this;if(b.flag==3){$(".phone-state").html("正在通话中...")}else{var a='<div class="popcontent" id="callContent">		            <div class="patient-popup-contain">		        <div class="popup-header clear">		            <div class="patient-name"></div>		            <div class="patient-information"><span id="sexAndPatientBirthDate">女/24岁/</span><div class="bl-svg"></div>        			<span id="PATIENT_NO">v12345678/</span><div class="bh-svg"></div><span id="mobilePhoneNumber">18676692222<span></div>		            <div class="phone-state">请接听...</div>		        </div>		        <div class="information-title">就诊信息</div>		        <table class="information-table">		            <tr>		                <td id="c-date1">就诊日期：-</td>		                <td id="c-doctor1" >初诊医生：-</td>		                <td id="c-record1" >诊断：-</td>		            </tr>		            <tr>		                <td id="c-date2" >最近复诊：-</td>		                <td id="c-doctor2" >复诊医生：-</td>		                <td id="c-record2" >诊断：-</td>		            </tr>		            <tr>		                <td id="c-money1" >累计消费：-</td>		                <td id="c-money2" >目前欠费：-</td>        				<td></td>		            </tr>		        </table>		        <div class="information-title">预约信息</div>        		<div style="display:none;" class="none-notice">暂无信息</div>		        <table class="doctor-table">		            <thead>		                <tr>		                    <td>预约日期</td>		                    <td>预约时间段</td>		                    <td>类型</td>		                    <td>预约医生/科室</td>		                    <td>预约事项</td>		                    <td>备注</td>		                    <td>操作</td>		                </tr>		            </thead>		            <tbody>		            </tbody>		        </table>		        <div class="btn-contain clear">		            <div class="btn-see">查看健康档案</div>		            <div class="btn-addAppointment">新增预约</div>		            <div class="btn-addFollow">新增随访</div>		        </div>		    </div>		</div>';this.trbPop.find(".popstyle").append(a);var f={mobilePhoneNumber:b.mobilePhoneNumber||""};var c={type:"POST",contentType:"application/json; charset=utf-8",url:ContextClinc_Server+"trbInfo/getPatientInfo",data:JSON.stringify(f),dataType:"json",async:true,showMask:true};var e=Utils.myAjaxHandler(c);e.done(function(g){if(g.errorCode==SUCCESSCODE){d=g.data;if(d){b.cidAppend(d);b.cidUpShow()}}}).fail(function(g){$.paError("请求异常",null)}).always(function(){})}b.trbPop.find(".close").on("click",function(){b.cidDownHide()})},cidAppend:function(e){var l=this;var d=null;var k=null;if(e&&"null"!=e){var b=e.emPatientKeyInfo;$(".msg").html("请接听...");if(b){$(".patient-name").html(b.PATIENT_NAME);var c=b.EMPI_ID;$(".btn-see").attr("empiId",c);$(".addAppointment").attr("empiId",c);$(".btn-addFollow").attr("empiId",c);var g=(b.PATIENT_GENDER!=1)&&(b.PATIENT_GENDER!=2)?"保密":(b.PATIENT_GENDER!=2?"男":"女");var j=Utils.getPersonAccurateAge(b.PATIENT_BIRTH_DATE,"岁","个月");var a="";if(!Utils.isBlank(g)){a=j+"/"}else{a=g+"/"+j+"/"}$("#sexAndPatientBirthDate").text(a);$("#PATIENT_NO").html((b.PATIENT_NO||"-"));$("#mobilePhoneNumber").html(e.mobilePhoneNumber);var f=e.diagonissMap;if(f){$("#c-date1").html("就诊日期："+(f.add_date||"-"));$("#c-doctor1").html("初诊医生："+(f.doctor_name||"-"));$("#c-record1").html("诊断："+(f.diagnosis||"-"));$("#c-date2").html("最近复诊："+(f.rp_add_date||"-"));$("#c-doctor2").html("复诊医生："+(f.rp_doctor_name||"-"));$("#c-record2").html("诊断："+(f.rp_diagnosis||"-"))}else{$("#c-date1").html("就诊日期：-");$("#c-doctor1").html("初诊医生：-");$("#c-record1").html("诊断：-");$("#c-date2").html("最近复诊：-");$("#c-doctor2").html("复诊医生：-");$("#c-record2").html("诊断：-")}var h=e.apptItems;if(h){if(h.totalMoney){$("#c-money1").html("累计消费："+(h.totalMoney.toFixed(2)||"-"))}else{$("#c-money1").html("累计消费：0.00")}if(h.oweMoney){$("#c-money2").html("目前欠费："+(h.oweMoney.toFixed(2)||"-"))}else{$("#c-money2").html("目前欠费：0.00")}}else{$("#c-money1").html("累计消费：-");$("#c-money2").html("目前欠费：-")}d=b.EMPI_ID;window.parent.callObj.CallRecord.empiId=d;window.parent.callObj.CallRecord.patientName=b.PATIENT_NAME;window.parent.callObj.CallRecord.mobilePhoneNumber=b.mobilePhoneNumber;window.parent.callObj.CallRecord.callStatus="2";window.parent.callObj.startTime=new Date()}else{k=e.mobilePhoneNumber;$(".patient-name").html("未知患者");var i=""+(e.regProvince||"")+"   "+(e.regCity||"");i=(i==null||i==""||i.replace(/^\s+|\s+$/g,"")=="")?"未知归属地          ":i;$(".bl-svg").hide();$("#sexAndPatientBirthDate").html(i);$("#mobilePhoneNumber").html(k);$("#PATIENT_NO").hide();$(".btn-see").hide();$(".btn-addAppointment").hide();$(".btn-addFollow").hide();window.parent.callObj.CallRecord.empiId="";window.parent.callObj.CallRecord.patientName="";window.parent.callObj.CallRecord.mobilePhoneNumber=k;window.parent.callObj.CallRecord.callStatus="2";window.parent.callObj.startTime=new Date()}$("body").delegate(".see-popup-bg .close","click",function(){$(".see-popup-bg").hide()});$(".submit-btn").on("click",function(){var m={};if(d&&"null"!=d){m={empiId:d}}else{m={phoneNumber:k}}window.parent.newAppt(m)});$(".btn-addAppointment").on("click",function(){var m={};var n=$(".btn-addAppointment").attr("empiId");if(n){m={empiId:n}}else{m={phoneNumber:l.mobilePhoneNumber}}window.parent.newAppt(m)});$(".btn-addFollow").on("click",function(){var n=$(".btn-addFollow").attr("empiId");if(n){var m="../clinic/followUp/new_follow_up.html?empiId="+n;l.popWindow(m,"新增随访")}});$(".btn-see").on("click",function(){var n=$(".btn-see").attr("empiId");if(n){var m="../clinic/patientArchives/patientDocument.html?id="+n+"&flag=0";l.popWindow(m,"健康档案")}});l.queryApptByEmpiId(l.empiId,function(n){if(n&&n.length>0){$(".none-notice").hide();var m="";$.each(n,function(r,t){var p="";if(t.APPT_TYPE==1){p="初诊"}else{if(t.APPT_TYPE==2){p="复诊"}}var q=true;var o=t.FAPPTSTATUS;var u=t.IS_CONFIRM;var v=t.IS_CLINIC_TREATMENT_CONFIRM;if(o=="0"){q=false}else{if(o=="1"){if(u=="1"&&v=="0"){}else{if(v=="1"){q=false}else{if(u=="1"){}else{}}}}else{if(o=="2"||o=="3"||o=="4"||o=="5"){q=false}else{if(o=="8"){q=false}else{if(o=="9"){q=false}}}}}var s="";if(q){s='<span recordId="'+t.RECORD_ID+'"class="modify-btn">修改</span></td>'}m+="<tr><td>"+(t.FSCHEDATE||"-")+"</td><td>"+(t.FSCHESTARTTIME||"-")+"-"+(t.FSCHEENDTIME||"-")+"</td><td>"+p+"</td><td>"+(t.DOCTOR_NAME||"未分配医生")+"</td><td>"+(t.FAPPTITEM||"-")+"</td><td>"+(t.APPT_REMARK||"-")+'</td><td><span recordId="'+t.RECORD_ID+'"class="detail-btn">详情</span>'+s+"</tr>"});$(".doctor-table").find("tbody").html(m);$(".doctor-table .modify-btn").on("click",function(){editAppt($($(this).attr("recordid")).attr("recordid"))});$(".doctor-table .detail-btn").on("click",function(){appt_line_detail($(this).attr("recordid"))})}else{$(".doctor-table").hide();$(".none-notice").show()}})}},cidUpShow:function(){var a=this;this.trbPop.css({"margin-top":a.trbPop.innerHeight()});a.trbPop.show();a.trbPop.animate({marginTop:"-="+a.trbPop.innerHeight()})},cidDownHide:function(){var a=this;a.trbPop.show();a.trbPop.animate({marginTop:"+="+a.trbPop.innerHeight()},function(){a.trbPop.fadeOut();a.trbPop.remove()})},downloadShow:function(){var a='<div class="popcontent download-content">                <div class="download-img"></div>                <div class="clear download-text">                <span>购买请联系客服：400-1028-120</span>                <a href="https://download.pinganwj.com/download/wanjia_box_install.zip" class="btn download-btn normal-btn" id="downloadBtn">下载插件></a>                <span>解压缩后点击exe文件安装</span>                <br>                <p class="tips">安装了仍不可用？请确认后台程序已开启，或联系客服</p>            </div>        </div>';this.trbPop.find(".popstyle").append(a);this.trbPop.show()},uploadShow:function(){var a=' <div class="popcontent " >            <p>为了提升用户体验，请更新插件。(下载后解压缩，双击exe文件即可安装)</p>                <a href="https://download.pinganwj.com/download/wanjia_box_install.zip" class="btn normal-btn" id="uploadBtn">立即更新</a>            </div>';this.trbPop.find(".popstyle").append(a);this.trbPop.show()},manageShow:function(){var b='<div class="popcontent manage-content">            <div class="clear tab-top">            <span class="fl">通话日期：</span>        <div class="date-box">            <div class="date date-div fr" id="telDate" >            <span class="date-prev"></span>            <input class="input-text" id="addDate" readonly="readonly" value="" placeholder="请选择日期">            <i class="date-icon"> </i>            <span class="date-next"></span>            </div>            </div>            <div class="search-box fr" style="margin-right: 80px;">            <div class="fl" style="margin-right: 5px;margin-top: 5px;">通话类型：</div>        <div class="drop">            <input id="callStatus" type="text" class="input-text" disabled="disabled"  value="请选择">            <i class="drop-icon"></i>            <ul class="drop-menu dsn">            </ul>            </div>            </div>            </div>            <div class="table-wrap">            <div class="table-content">            <table class="full-width-table common-table">            <thead>            <tr>            <th>通话类型</th>            <th>患者姓名</th>            <th>手机号</th>            <th>归属地</th>            <th>开始时间</th>            <th>时长</th>            <th>操作</th>            </tr>            </thead>            <tbody>            <tr id="tr-clone" style="display: none">            <td class="callStatus"></td>            <td class="patientName"></td>            <td class="mobilePhoneNumber"></td>            <td class="regArea"></td>            <td class="startDate"></td>            <td class="callTime"></td>            <td><a class="addAppt">新增预约</a><a class="addCall">拨号</a></td>            </tr>            </tbody>            </table>            </div>            <div id="myPageTrb" class="page-nav"></div>            </div>            </div>';this.trbPop.find(".popstyle").append(b);$(".addAppt").on("click",function(){var e=$(this).data("empiId");var d=$(this).data("mobilePhoneNumber");var c={};if(e&&"null"!=e){c={empiId:e}}else{c={phoneNumber:d}}window.parent.newAppt(c)});$(".addCall").on("click",function(){var c=$(this).data("mobilePhoneNumber");var d=$(this).data("empiId");window.parent.phoneBox.ubox_dialnum(c,d)});this.initalCallInfo();this.getCallRecords();this.trbPop.show();var a=this;$(".callTime").on("click",function(){var f=$(this);var e=f.find("audio")[0];if(!e){return}var d=$(e).attr("soundfilename");var c=$($(e).find("source")[0]).attr("src");var g=$(e).attr("stop");if(callObj.Audio!=null){if($(callObj.Audio).attr("stop")=="3"){callObj.Audio.pause();$(e).attr("stop","1");g="1"}else{phoneBox.playStop($(callObj.Audio).attr("soundfilename"));console.log("playStop:"+$(callObj.Audio).attr("soundfilename"));$(e).attr("stop","1");g="1"}a.voiceShow($(callObj.Audio).parent(),0);if(d==$(callObj.Audio).attr("soundfilename")){console.log("暂停播放....");callObj.Audio=null;return}}callObj.Audio=e;if(g=="3"){callObj.Audio.pause();$(e).attr("stop","1");return}if(g=="0"){phoneBox.playStop(d);console.log("playStop:xxxx"+d);$(e).attr("stop","1");a.voiceShow(f,0)}else{if(g=="1"){if(phoneBox.playCall(d,c)){console.log("playCall:"+d);$(e).attr("stop","0")}a.voiceShow(f,1)}}})},sleep:function(b){var a=new Date();var c=a.getTime()+b;while(true){a=new Date();if(a.getTime()>c){return}}},voiceShow:function(b,a){if(a==1){b.find(".voice").addClass("voice-on");console.log("song....")}else{b.find(".voice").removeClass("voice-on");console.log("stop song....")}},initalCallInfo:function(){var c=Utils.timeStampToDateStr(new Date(),7);var b=this;$("#addDate").val(c);$("#addDate").datetimepicker({lang:"ch",format:"Y-m-d",timepicker:false,maxDate:c,onSelectDate:function(){b.getCallRecords()}});var a=$("#addDate");$(".date-prev").off("click").on("click",function(){var d=a.val();var e=b.calcPreAftDate("",d);a.val(e);b.getCallRecords()});$(".date-next").off("click").on("click",function(){var d=a.val();var e=b.calcPreAftDate("add",d);a.val(e);b.getCallRecords()});b.initalCallStatus()},initalCallStatus:function(){var a=this;var c=[{modeId:"1",modeName:"呼出"},{modeId:"2",modeName:"呼入"},{modeId:"3",modeName:"未接来电"}];var b={idKey:"modeId",txtKey:"modeName",isNeedAll:false,isNeedClear:true};$("#callStatus").WJZSDropdown(c,b,function(d,e){a.getCallRecords()})},getCallRecords:function(d){var f=$("#addDate").val();var b=this;var c=$.trim($("#callStatus").attr("val"));var g={addDate:f,callStatus:c,currentPage:1,pageSize:10};var e=$.extend({},g,d);e.ajaxopts={url:ContextClinc_Server+"trbInfo/selectCallRecords",showMask:true};e.callback=function(h){if(h.errorCode==SUCCESSCODE){b.showCallRecordList(h.data.dataSource)}else{$.paWarn(h.errorMessage)}};var a=$("#myPageTrb").generatePagination(e)},onend:function(a){},showCallRecordList:function(f){var c=this;$("#tr-clone").siblings("tr").remove();if(f&&f.length>0){for(var e=0;e<f.length;e++){var b=$("#tr-clone").clone(true);var d=Utils.trimObj(f[e].callStatus);if(d=="1"){b.find(".callStatus").text("呼出")}else{if(d=="2"){b.find(".callStatus").text("呼入")}else{if(d=="3"){b.find(".callStatus").text("未接来电");b.addClass("spec")}}}b.find(".patientName").text(f[e].patientName||"未知患者");b.find(".mobilePhoneNumber").text(f[e].mobilePhoneNumber);b.find(".regArea").text((f[e].regProvince||"")+" "+(f[e].regCity||""));b.find(".startDate").text((new Date(f[e].startDate)).Format("HH:mm"));var a="";if(f[e].soundAddr==0||f[e].soundAddr==null||f[e].soundFileName==""||f[e].soundFileName==null){}else{a='<audio onended=\'$(callObj.Audio).attr("stop","1");$($(callObj.Audio).prev()[0]).find("i").removeClass("voice-on");callObj.Audio=null;\'  mp3Key=\''+(f[e].soundAddr||"")+"' soundfilename='"+(f[e].soundFileName||"")+"' preload='none' stop='"+1+"'><source src='"+ContextClinc_Server+"/publicWjboxFileController/downloadFile.mp3?mp3key="+(f[e].soundAddr||"")+"&&fileName="+(f[e].soundFileName||"")+".mp3&&cookie_pawj_medical_user_id="+Utils.getCookie("cookie_pawj_medical_user_id")+"&sysType=B' type='audio/mpeg'></audio>"}if(a!=""&&f[e].callTime){b.find(".callTime").html('<a href="javascript:void(0)" ><i class="voice"></i>'+c.formatCallTime(f[e].callTime)+"</a>"+a)}else{if(f[e].callTime){b.find(".callTime").html('<a href="javascript:void(0)" title="录音未上传"><i class="voice voice-gray"></i>'+c.formatCallTime(f[e].callTime)+"</a>")}else{b.find(".callTime").removeClass("callTime")}}b.find(".addAppt").data("empiId",f[e].empiId);b.find(".addAppt").data("mobilePhoneNumber",f[e].mobilePhoneNumber);b.find(".addCall").data("empiId",f[e].empiId);b.find(".addCall").data("mobilePhoneNumber",f[e].mobilePhoneNumber);b.removeAttr("style");b.removeAttr("id");$(".common-table tbody").append(b)}}},calcPreAftDate:function(h,c){var d=new Date(c.replace(/-/g,"/"));var f=new Date();var i=null;var a=parseInt(Math.abs(f-d)/1000/60/60/24);if(h==="add"){if(a>0){i=new Date(d.setDate(d.getDate()+1))}else{i=d}}else{i=new Date(d.setDate(d.getDate()-1))}var b=i.getMonth()+1;var e=b>9?b:"0"+b;var g=i.getDate()>9?i.getDate():"0"+i.getDate();return i.getFullYear()+"-"+e+"-"+g},formatCallTime:function(a){if(null!=a&&""!=a&&"null"!=a&&0!=a){var c=parseInt(a/60);var b=parseInt(a%60);if(c>0){c=c+"′"}else{c=""}if(b>0){b=b+"″"}else{b=""}return c+b}else{return""}}};