var userInfo_aclcHis=config_cache.getCache("medical_user_data");var clinicParamsHis=userInfo_aclcHis.clinicParams;var hidePriceHis="2";for(var index in clinicParamsHis){if(clinicParamsHis[index].parameterCode=="3013"){hidePriceHis=clinicParamsHis[index].parameterValue}}var AssistCheckHistory=function(){this.quoteObj=$("<span class='quote' title='引用'></span>")};AssistCheckHistory.prototype={init:function(a){this.bindEvent();this.initHistoryRecord(a)},initHistoryRecord:function(b){var a=this;this.selectDwsAcByAcographyID(b,function(c){a.fillHistoryRecord(c)})},fillHistoryRecord:function(b){var a=this;$(".historyRecord").empty();$.each(b,function(h,g){var d=a.newHistoryRecordItem();var j=g.dwsAcography;d.find(".check-style").text(a.convertTreatmentType(j.treatmentType));d.find(".checkDate").text(new Date(j.addDate).Format("yyyy-MM-dd HH:mm:ss"));d.find(".doctorName").text(j.doctorName);d.attr("isSelfRecord",1);if(g.isSelfRecord=="0"){d.find(".shareClinicName").text("门店："+g.clinicName);d.attr("isSelfRecord",0)}d.attr("acographyId",j.acographyId);d.attr("empiId",j.empiId);d.attr("listId",h);var c=a.newHistoryAssistCheckTable();var f=g.dwsAssistCheckList;$.each(f,function(o,n){var m=a.newHistoryAssistCheckTr();var l=null;if(n.CHARGESTATUS=="0"){l="未收费"}else{if(n.CHARGESTATUS=="1"){l="已收费"}else{if(n.CHARGESTATUS=="2"){l="已退费";m.find(".chargeStatus").addClass("viewReturnPremium")}else{if(n.CHARGESTATUS=="3"){l="部分退费"}else{if(n.CHARGESTATUS=="4"){l="收费中"}else{if(n.CHARGESTATUS=="5"){l="退费中"}}}}}}m.find(".itemName").text(n.ITEMNAME||"");m.find(".parts").text(n.PARTS||"");m.find(".illstat").text(n.ILLSTAT||"");m.find(".chargeStatus").text(l||"");c.append(m)});d.find(".history-table-wrapper").append(c);var e=a.newHistoryLaboratoryCheckTable();var k=g.dwsLaboratoryCheckList;$.each(k,function(l,o){var m=a.newHistoryLaboratoryCheckTr();var n=null;if(o.CHARGESTATUS=="0"){n="未收费"}else{if(o.CHARGESTATUS=="1"){n="已收费"}else{if(o.CHARGESTATUS=="2"){n="已退费";m.find(".chargeStatus").addClass("viewReturnPremium")}else{if(o.CHARGESTATUS=="3"){n="部分退费"}else{if(o.CHARGESTATUS=="4"){n="收费中"}else{if(o.CHARGESTATUS=="5"){n="退费中"}}}}}}m.find(".itemName").text(o.ITEMNAME||"");m.find(".samples").text(o.SAMPLES||"");m.find(".chargeStatus").text(n||"");e.append(m)});e.show();d.find(".history-table-wrapper").append(e);d.data("checkItem",g);$(".historyRecord").append(d)});$(".history_record_item[isSelfRecord=0]").find(".history_print").addClass("dsn");$(".history_record_item[isSelfRecord=0]").find(".quote").attr("style","display:none")},bindEvent:function(){$(".historyRecord").off("click",".check-btn");$(".historyRecord").on("click",".check-btn",function(){$(this).addClass("current").siblings(".check-btn").removeClass("current");var b=$(this).attr("tableClass");$(this).parent(".choose-jyjc").parent(".history-top-btn").siblings(".history-table-wrapper").find("."+b).show().siblings("table").hide()});$(".historyRecord").off("click",".head-line");$(".historyRecord").on("click",".head-line",function(){if($(this).find("button").hasClass("expand")){$(this).find("button").removeClass("expand").addClass("collapse");$(this).siblings(".detail").show()}else{$(this).find("button").removeClass("collapse").addClass("expand");$(this).siblings(".detail").hide()}});var a=this;$(".historyRecord").off("click",".quote");$(".historyRecord").on("click",".quote",function(){var b=$(this).parent(".history-top-btn").parent(".detail").parent(".history_record_item").attr("listId");a.selectDwsAcByAcographyID(acographyId,function(c){a.fillAcAndLcHistoryItem(c[b]);a.fillHistoryRecord(c);if(hidePriceHis=="1"){$(".priceTh").addClass("dsn");$(".price").addClass("dsn");$(".total-price-left").addClass("dsn")}})});$(".historyRecord").off("click",".history_print");$(".historyRecord").on("click",".history_print",function(){var b=$(this).parent(".history-top-btn").parent(".detail").parent(".history_record_item");var c=b.attr("acographyId");var d=b.attr("empiId");a.printAssistCheckByAcographyId(c,d)})},printAssistCheckByAcographyId:function(a,b){print_model.examineFormPrint(a,b,hidePriceHis);print_model.inspectReportPrint(a,b,hidePriceHis)},fillAcAndLcHistoryItem:function(a){this.cleanAcAnLcInputTr();_acView.showAcAndLcHistoryItem(a.dwsAssistCheckList,1);_acView.showAcAndLcHistoryItem(a.dwsLaboratoryCheckList,2);$("#table_ac").append(_acView.showNewATr(1,1));$("#table_lc").append(_acView.showNewATr(1,2));_acMain.thinksearchAcCEM();_acMain.thinksearchLcCEM();_acMain.initCheckBox();$(".jyjc .popup-model").hide();_acView.checkSaveTmplBtn()},cleanAcAnLcInputTr:function(){$("#table_ac .ac_newtr:last").remove();$("#table_lc .lc_newtr:last").remove()},convertTreatmentType:function(a){if(a===1||a==="1"||a==null){return"初诊"}else{if(a===2||a==="2"){return"复诊"}}return"未知"},quoteBtnShow:function(){this.quoteObj.show();$(".historyRecord").find(".quote").show()},quoteBtnHide:function(){this.quoteObj.hide();$(".historyRecord").find(".quote").hide()},newHistoryRecordItem:function(){var b="<div class='history_record_item'>                        <div class='head-line history'>                            <span class='check-style'>初诊</span>                            就诊时间:<span class='checkDate'>2016-08-23 09:52:47</span>                            就诊医生:<span class='doctorName'>刘东源</span>                  <span class='shareClinicName'></span>                        <button class='expand'>                            <i></i>                        </button>                        </div>                            <div class='detail' style='display: none'>                                <div class='history-top-btn'>                                    <div class='choose-jyjc'>                                        <a class='check-btn current' href='javascript:;' tableClass='historyLaboratoryCheckTable'>检验</a>                                        <a class='check-btn' id='check-jc' href='javascript:;' tableClass='historyAssistCheckTable'>检查</a>                                    </div>                                    <span class='print history_print' title='打印'></span>                                </div>                                <div class='table-wrapper history-table-wrapper'>                            </div>                        </div>                    </div>";var a=$(b);a.find(".history_print").after(this.quoteObj.clone());return a},newHistoryAssistCheckTable:function(){var a="<table class='common-table full-width-table historyAssistCheckTable' style='display: none'>                        <tr>                            <th width='30%'>项目名称</th>                            <th>部位</th>                            <th width='30%'>检查目的</th>        					<th width='10%'>收费状态</th>                        </tr>                    </table>";return $(a)},newHistoryAssistCheckTr:function(){var a="<tr>                        <td class='itemName'></td>                        <td class='parts'></td>                        <td class='illstat'></td>                        <td class='chargeStatus'></td>                    </tr>";return $(a)},newHistoryLaboratoryCheckTable:function(){var a="<table class='common-table full-width-table historyLaboratoryCheckTable' style='display: none'>                        <tr>                            <th width='45%'>项目名称</th>                            <th>标本</th>        					<th width='10%'>收费状态</th>                        </tr>                    </table>";return $(a)},newHistoryLaboratoryCheckTr:function(){var a="<tr>                          <td class='itemName'></td>                          <td class='samples'></td>						  <td class='chargeStatus'></td>                    </tr>";return $(a)},selectDwsAcByAcographyID:function(c,f){var a=this;var d={};var b={url:AssistCheck_url.assistCheck_selectDwsShareHistoryAcByAcographyID,dataType:"json",data:{acographyid:c},async:true,showMask:true};var e=Utils.myAjaxHandler(b);e.done(function(g){if(g!=null&&g.errorCode==SUCCESSCODE){f&&f.call(a,g.data)}else{$.paError(g.errorMessage)}}).fail(function(g){$.paError("操作失败!")}).always(function(){});return d},};