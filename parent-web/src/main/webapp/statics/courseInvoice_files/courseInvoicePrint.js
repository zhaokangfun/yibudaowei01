var gender={"1":"男","2":"女","3":"保密"};var userInfo_aclc=config_cache.getCache("medical_user_data");var item3013=_.find(userInfo_aclc.clinicParams,function(a){return a.parameterCode=="3013"});var isHidePrice=item3013&&item3013.parameterValue;function CourseInvoicePrint(){}CourseInvoicePrint.prototype={doPrintFacade:function(c,d,b){var a=this;a.doPrint(c,d,b)},doPrint:function(a,c,h,m){var p=this;LODOP=getLodop();if(!LODOP){return}LODOP.PRINT_INITA(0,0,530,763,"");LODOP.SET_PRINT_PAGESIZE(1,1480,2100,"");var q=p.renderCourse(a,c,h);var k=q.courseExecution;var f=k.courseExecutionDetail;var e=q.course;p.createHead(q.empi,e);p.createFooter(e);var o=245;var n=0;var g=0;var l=42;for(var d=0;k[d];d++){if(o>650){o=245;LODOP.NEWPAGEA();p.createHead(q.empi,e);p.createFooter(e)}g=g+1;LODOP.ADD_PRINT_TEXT(o,10,140,25,g+". "+k[d].courseName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",10);LODOP.ADD_PRINT_TEXT(o,140,35,25,k[d].courseQty);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",10);LODOP.ADD_PRINT_TEXT(o,177,61,25,this.coursePlanName(k[d].coursePlanExecrate)||k[d].coursePlanExecrate);LODOP.SET_PRINT_STYLEA(0,"FontSize",10);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(o,242,45,25,k[d].coursePlanTotalTimes);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",10);LODOP.ADD_PRINT_TEXT(o,288,65,25,(k[d].doctorName||""));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",10);LODOP.ADD_PRINT_TEXT(o,408,135,25,(k[d].remark||""));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",10);LODOP.ADD_PRINT_TEXT(o,348,65,25,(isHidePrice==1?"-":k[d].coursePlanPrice));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",10);o+=20;LODOP.ADD_PRINT_TEXT(o,10,300,25,"明细：");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",9);var f=k[d].courseExecutionDetail;for(var b=0;f[b];b++){LODOP.ADD_PRINT_TEXT(o,45,300,25,(f[b].TREATMENT_NAME||f[b].DRUG_NAME)+"  "+(isHidePrice==1?"":((f[b].itemPrice||f[b].TREATMENT_PRICE)+"元/次 * "))+f[b].itemNum+(isHidePrice==1?"次":""));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",9);o+=20}o+=30;LODOP.ADD_PRINT_LINE(o-15,0,o-15,530,2,0);LODOP.SET_PRINT_STYLEA(0,"FontColor","#B4B4B4");n+=(k[d].coursePlanPrice*k[d].courseQty)}LODOP.ADD_PRINT_TEXT(741,190,74,25,"总金额(元):");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.SET_PRINT_STYLEA(0,"ItemType",4);LODOP.ADD_PRINT_TEXT(741,253,100,25,(isHidePrice==1?"-":p.toDecimal2(n)));LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",10);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_LINE(753,350,753,254,0,1);operateType()},createHead:function(result,data){var self=this;LODOP.ADD_PRINT_TEXT(7,5,32,25,"NO.");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(79,7,111,20,"医疗证/医保卡号：");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(79,110,127,20,result.IS_YB_REG==1?(result.INSURANCE_NO||"-"):"-");LODOP.ADD_PRINT_TEXT(7,38,120,25,result.ACOGRAPHY_SERIAL_NO);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(7,491,35,25,"#/&");LODOP.SET_PRINT_STYLEA(0,"ItemType",2);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"ItemType",2);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.ADD_PRINT_TEXT(105,7,45,25,"姓名 :");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(105,159,40,25,"性别 :");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(105,229,41,25,"年龄 :");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(105,332,40,25,"科室 :");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(105,442,40,25,"费别 :");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(135,8,55,25,"病历号 :");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(135,160,71,25,"住址/电话 :");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(170,8,100,25,"临床诊断及证型 :");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(170,384,65,25,"开具日期 :");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(105,50,108,25,result.PATIENT_NAME);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(105,194,34,25,eval("gender["+result.PATIENT_GENDER+"]"));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.ADD_PRINT_TEXT(105,270,70,25,Utils.getPersonAccurateAge(result.PATIENT_BIRTH_DATE));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(105,370,81,25,result.DEPARTMENT_NAME||"-");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(105,479,59,25,result.MI_TYPE_NAME||"自费");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(741,420,99,25,result.DOCTOR_NAME);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);var patient_no=result.PATIENT_NO;if(null==patient_no||"null"==patient_no||""==patient_no){patient_no=""}else{patient_no=patient_no.substr(0,18)}LODOP.ADD_PRINT_TEXT(135,54,119,25,patient_no);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");var living_address_countryside=result.LIVING_ADDRESS_COUNTRYSIDE;if(null==living_address_countryside||"null"==living_address_countryside||""==living_address_countryside){living_address_countryside="-"}var addressPhone=living_address_countryside+"/"+result.MOBILE_PHONE_NUMBER;if(null!=result.MOBILE_PHONE_NUMBER&&self.getStrLength(addressPhone)>102){var mobileLength=self.getStrLength("/"+result.MOBILE_PHONE_NUMBER);addressPhone=self.cutStr(living_address_countryside,102-mobileLength)+"/"+result.MOBILE_PHONE_NUMBER}if(result.MOBILE_PHONE_NUMBER==null){addressPhone=living_address_countryside+"/-"}LODOP.ADD_PRINT_TEXT(135,229,310,25,addressPhone);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");var diagnosis=result.CHINESE_TRA_DIAGNOSIS;if(diagnosis){if(result.DiagnosisList){diagnosis+="；"+result.DiagnosisList}}else{diagnosis=result.DiagnosisList}LODOP.ADD_PRINT_TEXT(170,107,281,25,diagnosis||"-");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(170,449,95,25,Utils.timeStampToDateStr(result.MODIFY_DATE,7));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_LINE(94,4,94,530,0,1);LODOP.ADD_PRINT_LINE(198,4,198,530,0,1)},createFooter:function(b){var a=this;LODOP.ADD_PRINT_SHAPE(4,207,0,530,30,0,1,"#DCDCDC");LODOP.ADD_PRINT_TEXT(217,26,61,25,"疗程名称");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",10);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(217,140,35,25,"数量");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",10);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(217,177,65,25,"执行频率");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",10);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(217,240,50,25,"总次数");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",10);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(217,288,65,25,"执行医生");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",10);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(217,412,45,25,"备注");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",10);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(217,348,60,25,"单价(元)");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",10);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(30,476,67,20,"疗程单"+b.recipeNo);LODOP.ADD_PRINT_TEXT(28,10,510,25,userInfo_aclc.clinicName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",13);LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(53,10,510,25,"疗程单");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",13);LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(741,360,70,25,"开单医生 :");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.SET_PRINT_STYLEA(0,"ItemType",4);LODOP.ADD_PRINT_LINE(753,420,753,516,0,1);LODOP.ADD_PRINT_LINE(733,0,733,530,0,1)},coursePlanName:function(b){var a="";if(b==0){a="两天一次"}else{if(b==1){a="一天一次"}else{if(b==2){a="两天一次"}else{if(b==3){a="三天一次"}else{if(b==4){a="四天一次"}else{if(b==5){a="五天一次"}else{if(b==6){a="六天一次"}else{if(b==7){a="七天一次"}}}}}}}}return a},getStrLength:function(b){var a=b.match(/[^\x00-\xff]/ig);return b.length+(a==null?0:a.length)},cutStr:function(d,a){if(!d){return""}if(a<=0){return""}var c=0;for(var b=0;b<d.length;b++){if(d.charCodeAt(b)>255){c+=2}else{c++}if(c==a){return d.substring(0,b-2)}else{if(c>a){return d.substring(0,b-2)}}}return d},convertId2Name:function(b){for(var a=0;a<drugSourceData.length;a++){if(drugSourceData[a].id==b){return drugSourceData[a].name}}return""},toDecimal2:function(a){var d=parseFloat(a);if(isNaN(d)||d<0){return"0.00"}var d=Math.round(a*100)/100;var c=d.toString();var b=c.indexOf(".");if(b<0){b=c.length;c+="."}while(c.length<=b+2){c+="0"}return c},renderCourse:function(d,f,c){var b={};var a={url:ContextClinc_Server+"tcmCourse/getCourse4Print",dataType:"json",data:{acographyId:d,empiId:f,courseRecipeId:c},async:false,showMask:true};var e=Utils.myAjaxHandler(a);e.done(function(g){if(g!=null&&g.errorCode==SUCCESSCODE){b=g.data}else{$.paError(g.errorMessage)}}).fail(function(g){$.paError("操作失败!")}).always(function(){});return b},};