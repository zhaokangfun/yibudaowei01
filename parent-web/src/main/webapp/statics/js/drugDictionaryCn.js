$(function(){new DrugDictionaryCn()._switchTab()});function DrugDictionaryCn(){this.pageSize=20;this.currPage=1;this.drugType=2;this.bindEventPint=0;this.pageMsg=null;this.addChineseMedic=new AddChineseMedic(this);if(Utils.getQueryString("type")!=null&&Utils.getQueryString("type")!=2){$(".pageNav .pageNav-item.chinese-medicine").click()}}DrugDictionaryCn.prototype={_init:function(){this.currPage=1;this.pageSize=20;this.renderPage();if(this.bindEventPint==0){this.bindEventPint++;this._bindEvent();this.addChineseMedic.init()}},_switchTab:function(){var a=this;$(".pageNav .pageNav-item.chinese-medicine").on("click",function(){if($(this).hasClass("checked")){return}$(this).addClass("checked").siblings().removeClass("checked");$(".chineseMedic").removeClass("dsn").siblings().addClass("dsn");$("#chinese_medicine_add_edit_div").addClass("dsn");a._init()})},_bindEvent:function(){var a=this;$("#chin_status").WJZSDropdown([{id:0,txt:"启用"},{id:1,txt:"停用"}],{isNeedAll:true,isNeedClear:false},function(b,c){a.currPage=1;a._search()});$("#chin_status").SetWJZSDropdownSelectedData(0);$("#chin_btn_search").click(function(){a.currPage=1;a._search()});$("#chin_drugName").keydown(function(b){var c=b.which;if(c==13){a._search()}b.stopPropagation()});$("#chin_btn_add").click(function(){$("#chinese_medicine_add_edit_div").removeErrorMsg();$("#cn_drugPackageSpec").val("");$("#cn_pyCode").val("");$("#cn_wbCode").val("");$("#cn_drugManuFactorName,#cn_drugManuFactorId,#cn_productionPlace").val("");$("#cn_drugStoreUnitRate").attr("placeholder","1g=?g");$("#cn_ceilingPrice").val("");$("#chinese_medicine_add_edit_div").removeClass("dsn");$("#list_div").addClass("dsn")});$(".chineseMedic .tableBox-cont").on("click","tr span.disabled-method",function(d){if($(this).attr("data")>0&&$(this).attr("value")==="0"){$.paAlert("该药品有库存，不能停用!");return}var b=$(this).parent().parent().find("input[type='hidden']").val();var c=$(this).attr("value");var e=$(this);a.disabledOrNot(b,c,function(){e.text(c!="1"?"启用":"停用");e.attr("value",c!="1"?1:0);$.paSuccess("更新状态成功！");a._search()})});$(".chineseMedic .tableBox-cont").on("click","tr span.edit-method",function(b){$("#chinese_medicine_add_edit_div").removeErrorMsg();$("#chinese_medicine_add_edit_div").removeClass("dsn");$("#list_div").addClass("dsn");a.addChineseMedic.fillDrugInfo($(this).attr("value"))});$("#cn li").on("click",function(c){var b=$(this).find("input");b.hasClass("checked")?b.removeClass("checked"):b.addClass("checked");var d=$(this).find("span");d.hasClass("active")?d.removeClass("active"):d.addClass("active");$(this).attr("val",($(this).attr("val")==="0"?1:0));a.currPage=1;a._search()})},_search:function(){var a=$("#chin_drugName").val();var b={keyword:a,disabled:$.trim($("#chin_status").attr("val")),zeroCn:$("#zero_cn").attr("val"),drugType:this.drugType};this.showListInPage(b,function(){})},renderPage:function(){this._search()},showListInPage:function(b,e){var a=this;var d={currentPage:a.currPage,pageSize:a.pageSize,params:b};var c=$.extend({},d);c.ajaxopts={url:ContextClinc_Server+"mdcDictDrug/page",contentType:"application/json;charset=utf-8",showMask:true};c.callback=function(f){if(f.errorCode=="E0000000"){var g=f.data;a.pageMsg=g.dataSource;$(".chineseMedic .tableBox-cont .common-table").empty();$.each(g.dataSource,function(h,i){var j="<tr><td class='dsn'><input type='hidden' value='"+i.DRUG_ID+'\' /></td><td width="30%" '+(i.DISABLED==1?' style="color: rgb(168, 168, 168);"':"")+">"+i.DRUG_NAME+'</td><td width="10%" '+(i.DISABLED==1?' style="color: rgb(168, 168, 168);"':"")+">"+i.DRUG_PACKAGE_SPEC+'</td><td width="10%" '+(i.DISABLED==1?' style="color: rgb(168, 168, 168);"':"")+">"+i.DRUG_SORT_NAME+'</td><td width="15%" '+(i.DISABLED==1?' style="color: rgb(168, 168, 168);"':"")+">"+i.DRUG_RETAIL_PRICE+'</td><td width="15%" '+(i.DISABLED==1?' style="color: rgb(168, 168, 168);"':"")+">"+i.DRUG_DISPENSE_UNIT_NAME+"</td><td class='operateBtn'><span class='edit-method' WJPerm='DICT02-UPDATE' value='"+h+"'>编辑</span><span class='disabled-method' data='"+(i.DRUG_STORE_UNIT_QTY||0)+"' value='"+i.DISABLED+"' WJPerm='DICT02-ENABLE'>"+(i.DISABLED===0?"停用":"启用")+"</span></td></tr>";j=j.replace(/null/g,"");$(".chineseMedic .tableBox-cont .common-table").append(j)});a.currPage=g.currentPage}else{$.paError(f.errorMessage+": "+f.errorCode)}};$("#chin-my-page").generatePagination(c)},disabledOrNot:function(b,e,h){if(b==undefined||b==null||b==""){return}if(e!=1){e=1}else{e=0}var c={drugId:b,disabled:e};var a={mdcDictDrug:c};var f=JSON.stringify(a);var d={method:"POST",url:ContextClinc_Server+"mdcDictDrug/updateByPrimaryKeySelective",dataType:"json",data:f,contentType:"application/json;charset=utf-8"};var g=Utils.myAjaxHandler(d);g.done(function(i){var k=i.data;var j=i.errorMessage;var l=i.errorCode;if(l!="E0000000"){$.paError(l+": "+j);return}if(h!=undefined&&typeof(h)=="function"){h()}}).fail(function(i){}).always(function(){})}};