$(function(){$("#import").click(function(){$("#platform_list").show();$("#list").hide();cleanInput();dropInit();getPlatformTreatmentList("","")});$("#platform_info_cancel").click(function(){$("#platform_list").hide();$("#list").show()});$("#platform_info_import").click(function(){platformBatchImport()});$("#searchPlatformCode").off("keyup").on("keyup",function(){searchPlatformTreatment()})});function dropInit(){var a={method:"POST",url:maindata_url.getUrl().mdcTreatment_getPlatFormCategoryList,dataType:"json",showMask:true};var b=Utils.myAjaxHandler(a);b.done(function(g){var d=g.data;var e=g.errorMessage;var f=g.errorCode;if(f!="E0000000"){$.paAlert("失败："+f+"，"+e);return}var c={idKey:"TREATMENT_TYPE_ID",txtKey:"TREATMENT_TYPE_NAME",isNeedAll:true,isNeedClear:false};$("#treatmentType").WJZSDropdown(d,c,function(h,i){getPlatformTreatmentList($.trim(i.TREATMENT_TYPE_ID),"");$("#searchPlatformCode").val("")});$("#treatmentType").SetWJZSDropdownSelectedData("")}).fail(function(c){}).always(function(){})}function getPlatformTreatmentList(c,b){var a={method:"POST",url:maindata_url.getUrl().mdcTreatment_getPlatformTreatmentList,data:{treatmentTypeId:c,searchPlatformCode:b},dataType:"json",showMask:true};var d=Utils.myAjaxHandler(a);d.done(function(l){var e=l.data;var f=l.errorMessage;var j=l.errorCode;if(j!="E0000000"){$.paAlert("失败："+j+"，"+f);return}$("#platFormTreatmentTable tr:not(:first)").remove();if(e!=null&&e.length>0){for(var g=0;g<e.length;g++){var k="已引入";var h="";if(e[g].P_TREATMENT_ID==null){k="&nbsp";h="checkboxes"}if(e[g].TREATMENT_TYPE_NAME!=null&&e[g].TREATMENT_TYPE_NAME!=""&&e[g].TREATMENT_TYPE_NAME.length>0){var k="<tr><td><ul class='imported "+h+"'><li class='imported' val='"+e[g].TREATMENT_ID+"'>"+k+"</li></ul></td><td>"+(g+1)+"</td><td>"+e[g].TREATMENT_TYPE_NAME+"</td><td>"+e[g].TREATMENT_NAME+"</td><td>"+e[g].TREATMENT_UNIT_NAME+"</td><td>"+e[g].TREATMENT_PRICE+"</td><td>"+e[g].REMARK+"</td></tr>";k=k.replace(/null/g,"");$("#platFormTreatmentTable").append(k)}}$(".checkboxes li").on("click",function(i){$(this).hasClass("checked")?$(this).removeClass("checked"):$(this).addClass("checked")})}}).fail(function(e){}).always(function(){})}function searchPlatformTreatment(){var b=$("#searchPlatformCode").val();var a=$("#treatmentType").attr("val");getPlatformTreatmentList(a,b)}function platformBatchImport(){var d=[];for(var c=0;c<$(".checkboxes li.checked").length;c++){var a=$(".checkboxes li.checked").eq(c).attr("val");d.push(a)}var b={method:"POST",url:maindata_url.getUrl().mdcTreatment_batchImportTreatment,dataType:"json",data:{treatmentIdList:d},showMask:true};var e=Utils.myAjaxHandler(b);e.done(function(h){var f=h.errorMessage;var g=h.errorCode;if(g!="E0000000"){$.paAlert("失败："+g+"，"+f);return}$.paAlert("引入成功！");$("#platform_list").hide();$("#list").show()}).fail(function(f){}).always(function(){})}function cleanInput(){$("#treatmentType").val("");$("#treatmentType").attr("")};