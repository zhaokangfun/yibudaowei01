(function(c){function b(g,d){var f=this;this.$el=g;this.selectedLiFlag=0;this.data={};var e={mustSelect:false,keyAndValue:{keyName:"keyName",valueName:"valueName"},resaultName:"结果展示",callback:function(h){f.$el.val(h[this.keyAndValue.valueName])},columns:[]};this.options=c.extend(true,{},e,d);this.bindEvent()}b.prototype={setKeyAndValue:function(d){this.options.keyAndValue=d},dataChange:function(m){var q=this;var r=q.$el.siblings(".easy-resault");q.data=m;if(!(m&&m.length>0)){return false}r.fadeIn(0);var e=q.options.columns.length;var g=c('<li class="easy_header"></li>');var e=q.options.columns.length;var s="";if(e>0){for(var f=0;f<e;f++){s+='<span title="'+q.options.columns[f].name+'" style="width:'+q.options.columns[f]["width"]+'">'+q.options.columns[f].name+"</span>"}}else{s+="<span>"+q.options.resaultName+"</span>"}g.append(s);r.css({"padding-top":"28px"});r.html("").append(g);for(var o=0,p=m.length;o<p;o++){var d=m[o];var h=d.highlight=="true"?c('<li class="easy_option ac_special"></li>'):c('<li class="easy_option"></li>');if(e>0){var l="";for(var k=0;k<e;k++){l+='<span title="'+d[q.options.columns[k].dataKey]+'" style="width:'+q.options.columns[k]["width"]+'">'+d[q.options.columns[k].dataKey]+"</span>"}h.append(l);if(!q.options.columns[0].width){h.find("span").css("width",Math.floor(100/e)+"%")}}else{h.append(d[q.options.keyAndValue.valueName])}(function(i){h.on("click",function(){if(c(this).hasClass("easy_option")){q.options.callback(i);q.easyresaultFadeOut()}})})(d);r.append(h)}},computeScroll:function(){var h=this.$el.siblings(".easy-resault");var d=h.scrollTop();var g=h.children(".easy_option.selected");var e=g.index();var i=e*28;var f=h.height();if(d+f<i){h.scrollTop((e+1)*28-f)}else{if((e+1)*28>d){h.scrollTop((e-1)*28)}}},easyresaultFadeOut:function(){var d=this.$el.siblings(".easy-resault");d.fadeOut(0).scrollTop(0);this.selectedLiFlag=0;if(this.options.mustSelect&&!this.$el.attr("val")){this.$el.val("")}},bindEvent:function(){var d=this;this.$el.on("keydown",function(f){switch(f.keyCode){case 9:case 13:f.preventDefault();d.enter();break;case 27:f.preventDefault();break;case 38:f.preventDefault();d.prev();break;case 40:f.preventDefault();d.next();break}}).on("blur",function(){setTimeout(function(){d.easyresaultFadeOut()},200)});this.$el.siblings(".easy-resault").on("scroll",function(){var e=c(this).scrollTop();c(this).children(".easy_header").css("top",e+"px")})},next:function(){var e=this.$el.siblings(".easy-resault");var d=e.find(".easy_option");if(this.selectedLiFlag<d.length){this.selectedLiFlag++;d.removeClass("selected").eq(this.selectedLiFlag-1).addClass("selected")}this.computeScroll()},prev:function(){var e=this.$el.siblings(".easy-resault");var d=e.find(".easy_option");if(this.selectedLiFlag>1){this.selectedLiFlag--;d.removeClass("selected").eq(this.selectedLiFlag-1).addClass("selected")}else{if(this.selectedLiFlag==1){this.selectedLiFlag--;d.removeClass("selected")}}this.computeScroll()},enter:function(){var h=this;var g=h.$el.siblings(".easy-resault");var e=g.find(".easy_option");if(g.is(":visible")){var f=g.find(".easy_option.selected");if(f.length>0){var d=f.index()-1;h.options.callback(h.data[d]);h.easyresaultFadeOut()}}}};var a={};easyAutoCompleteNum=0;c.fn.extend({easyAutoComplete:function(d){var f=this;var e=c(f).attr("id");if(!e){e="easyAutoComplete"+easyAutoCompleteNum;c(this).attr("id",e);easyAutoCompleteNum++}a[e]=new b(c(this),d);return this},easyDataChange:function(e){var f=c(this).attr("id");var d=a[f];d.dataChange(e)}})})(jQuery);