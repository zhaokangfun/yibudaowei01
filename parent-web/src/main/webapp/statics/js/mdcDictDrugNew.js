var dictDrugManagerMain;var global_loadDrugDosage;$(function(){var b=new DictDrugManagerMainAction();var a=new DrugBasicData(b);dictDrugManagerMain=new DictDrugManagerMain(a,b);dictDrugManagerMain.load();renderPermissionControl()});var operationType={OPT_ADD:1,OPT_UPDATE:2};function getSelectValue(c){var a=$("#"+c);var b=$.trim(a.attr("val"));if(b===""){return""}else{return $.trim(a.val())}}function accDiv(arg1,arg2){var t1=0,t2=0,r1,r2;try{t1=arg1.toString().split(".")[1].length}catch(e){}try{t2=arg2.toString().split(".")[1].length}catch(e){}with(Math){r1=Number(arg1.toString().replace(".",""));r2=Number(arg2.toString().replace(".",""));return(r1/r2)*pow(10,t2-t1)}}function equals(b,a){if(b&&a&&b===a){return true}return false}var DictDrugManagerMain=function(b,a){this.drugBasicData=b;this.dictDrugManagerMainAction=a;this.curPage=1;this.totalPage=1;this.isQuerying=0;this.returnMsg=null;this.drugPropId=null;this.isStandardData=null;this.drugPackageSpec=null};DictDrugManagerMain.prototype={load:function(){this.loadDataPage();this.drugBasicData.initBasicData();this.initBtnAction()},initBtnAction:function(){var a=this;$(".pageNav .pageNav-item.west-medicine").on("click",function(){if($(this).hasClass("checked")){return}$(this).addClass("checked").siblings().removeClass("checked");$(".westernMedic").removeClass("dsn").siblings().addClass("dsn")});var b=$("#west_sc_value");b.val("");b.on("input propertychange",function(){a.loadDataPage()});$("#btn_search").on("click",function(){a.search()});$("#btn_add").on("click",function(){a.showAddPanelNoQuery()});$("#drugCommonName").on("keyup",function(){var c=$.trim($("#drugCommonName").val());$("#drugName").val(c);a.dictDrugManagerMainAction.fillPYValue();a.dictDrugManagerMainAction.fillWBValue()});$("#btn_save").off("click").on("click",function(){$("#add_edit_div").ketchup();var c=$.trim($(this).attr("data-pos"));if(c&&c!==""){a.saveDrugDict(parseInt(c),operationType.OPT_UPDATE)}else{a.saveDrugDict()}});$("#btn_cancel").off("click").on("click",function(){var c={curPage:a.curPage};a.loadDataPage(c);a.dictDrugManagerMainAction.switchToListViewDiv()});a._initThinkInput($("#searchInput"));a._initThinDosagekInput($("#drugDosageName"));$(".hintInfo").on("click",function(){a.dictDrugManagerMainAction.clearDrugBasicBox();a.dictDrugManagerMainAction.clearSpecEditBox();a.dictDrugManagerMainAction.enableAllInput($("#drugBasicBox"));a.dictDrugManagerMainAction.enableOrDisableSelect("drugPropIdDrop",0);$("#add_edit_div").ketchup();$("#drugDose-suffix").hide();$("#drugRetailPrice-suffix").hide();$("#drugCeilingPrice-suffix").hide();a.isStandardData=false});$("#dosage").on("keyup",function(){var c=$.trim($("#dosage").val());$("#drugDose").val(c)});$("#xi li").on("click",function(d){var c=$(this).find("input");c.hasClass("checked")?c.removeClass("checked"):c.addClass("checked");var f=$(this).find("span");f.hasClass("active")?f.removeClass("active"):f.addClass("active");$(this).attr("val",($(this).attr("val")==="0"?1:0));var e={curPage:1};a.loadDataPage(e)})},_initThinkInput:function(c){var d=this;var b={columns:[{display:"国药准字",dataKey:"SFDA_APPROVAL_NUM",width:90},{display:"名称",dataKey:"DRUG_NAME",width:180},{display:"规格",dataKey:"DRUG_PACKAGE_SPEC",width:90},{display:"厂家",dataKey:"DRUG_MANUFACTOR_NAME",width:200}],extraParams:{limitRows:20},selectFirst:true,autoFill:false,width:680,multiple:false,multipleSeparator:", ",scroll:true,scrollHeight:200,wrapperHandle:"#add_edit_div",beSelected:false,onlistCallback:function(e){d._fillDrugDataOnOneRow(e[0])}};var a=ContextClinc_Server+"mdcDictDrug/matchByKeyWord";c.autocomplete(a,b).result(function(e,f){d._fillDrugDataOnOneRow(f)})},_fillDrugDataOnOneRow:function(a){var c=this;var b=$("#drugBarcode");b.removeClass("wjzs-disabled").removeAttr("disabled").val(b.val());$("#drugId").val(a.DRUG_ID);$("#SFDAApprovalNum").val(a.SFDA_APPROVAL_NUM);$("#drugCommonName").val(a.DRUG_COMMON_NAME);$("#drugDosageId").val(a.DRUG_DOSAGE_ID);$("#drugDosageName").val(c.drugBasicData.getDosageName(a.DRUG_DOSAGE_ID));$("#drugPackageSpec").val(a.DRUG_PACKAGE_SPEC);$("#drugManuFactorName").val(a.DRUG_MANUFACTOR_NAME);$("#drugManuFactorId").val(a.DRUG_MANUFACTOR_ID);$("#drugPropId").SetWJZSDropdownSelectedData(c.drugBasicData.getDrugPropId(a.DRUG_PROP_ID));b.val(a.DRUG_BARCODE);$("#drugGoodsName").val(a.DRUG_GOODS_NAME);$("#drugStandardCode").val(a.DRUG_STANDARD_CODE);c.dictDrugManagerMainAction.fillPYValue();c.dictDrugManagerMainAction.fillWBValue();$("#drugBasicUnitId").SetWJZSDropdownSelectedData(a.DRUG_BASIC_UNIT_ID);$("#drugDoseUnitId").SetWJZSDropdownSelectedData(a.DRUG_DOSE_UNIT_ID);$("#drugStoreUnitId").SetWJZSDropdownSelectedData(a.DRUG_STORE_UNIT_ID);$("#dosage").val(a.DOSAGE_AMOUNT);$("#preparationAmount").val(a.PREPARATION_AMOUNT);$("#drugDose").val(a.DOSAGE_AMOUNT);c.dictDrugManagerMainAction.changeInputSuffix("drugRetailPrice","drugStoreUnitId","元");c.dictDrugManagerMainAction.changeInputSuffix("drugCeilingPrice","drugStoreUnitId","元");c.dictDrugManagerMainAction.changeInputSuffix("scatteredPrice","drugBasicUnitId","元");c.dictDrugManagerMainAction.changeInputSuffix("drugDose","drugDoseUnitId");c.isStandardData=true;c.drugPackageSpec=a;$("#drugRetailPrice").focus()},timeouter:null,_initThinDosagekInput:function(a){var b=this;options={mustSelect:true,resaultName:"剂型名称",keyAndValue:{keyName:"DRUG_DOSAGE_ID",valueName:"DRUG_DOSAGE_NAME"},callback:function(c){$("#drugDosageId").val(c.DRUG_DOSAGE_ID);$("#drugDosageName").val(c.DRUG_DOSAGE_NAME);$("#drugDosageName").attr("val",c.DRUG_DOSAGE_ID)}};a.easyAutoComplete(options).on("input propertyChange",function(){$("#drugDosageName").attr("val","");b.getMenuData($(this))}).on("focus",function(){b.getMenuData($(this))})},getMenuData:function(c){var b=this;var a=$("#drugDosageName").val();if(!a){return}if(b.timeouter){clearTimeout(b.timeouter)}b.timeouter=setTimeout(function(){var e={url:ContextClinc_Server+"mdcDrugDosageForm/selectByDosageName",dataType:"json",contentType:"application/json;charset=utf-8",data:JSON.stringify({q:a,startIndex:0,limitRows:100})};var d=Utils.myAjaxHandler(e);d.done(function(h){var f=h.errorMessage;var g=h.errorCode;if(g!=="E0000000"){$.paError("失败："+g+"，"+f);return}c.easyDataChange(h.data)}).fail(function(f){}).always(function(){})},300)},loadDataPage:function(f){var e=this;var b={keyword:$("#west_sc_value").val(),type:"0",delFlag:0,drugType:1,splitXi:$("#split_xi").attr("val"),zeroXi:$("#zero_xi").attr("val"),disabled:$.trim($("#status").attr("val"))};var a={pageSize:20,params:b};for(var d in f){a.currentPage=f.curPage}var c=$.extend({},a);c.ajaxopts={showMask:true,url:maindata_url.getUrl().mdcDictDrug_page,type:"POST"};c.callback=function(h){e.returnMsg=h;var l=h.data.dataSource;var m=h.errorMessage;var p=h.errorCode;if(p!=="E0000000"){$.paError("失败："+p+"，"+m);return}var r=$("#tb_detailList");r.empty();for(var k=0;k<l.length;k++){var g=l[k];var o=$("<tr>");var j;j=$("<td width='23%'>");j.html(g.DRUG_NAME);e.dictDrugManagerMainAction.detailDataDisabled(g,j);o.append(j);j=$("<td width='15%'>");j.html(g.DRUG_PACKAGE_SPEC);e.dictDrugManagerMainAction.detailDataDisabled(g,j);o.append(j);j=$("<td width='12%'>");j.html(g.DRUG_MANUFACTOR_NAME);e.dictDrugManagerMainAction.detailDataDisabled(g,j);o.append(j);j=$("<td width='8%'>");j.html(g.DRUG_SPLIT===0?"":g.SCATTERED_PRICE);e.dictDrugManagerMainAction.detailDataDisabled(g,j);o.append(j);j=$("<td width='8%'>");j.html(g.DRUG_SPLIT===0?"":g.DRUG_BASIC_UNIT_NAME);e.dictDrugManagerMainAction.detailDataDisabled(g,j);o.append(j);j=$("<td width='8%'>");j.html(g.DRUG_RETAIL_PRICE);e.dictDrugManagerMainAction.detailDataDisabled(g,j);o.append(j);j=$("<td width='8%'>");j.html(g.DRUG_STORE_UNIT_NAME);e.dictDrugManagerMainAction.detailDataDisabled(g,j);o.append(j);j=$("<td width='12%'>");if(g.PRESET_STATUS!=="1"){var q=$("<a id='btn_modify_"+k+"' WJPerm='DICT02-UPDATE' onclick='dictDrugManagerMain.showModifyPanel("+k+")'>编辑</a>");j.append(q);var n="";if(g.DISABLED===0){n=$("<a id='btn_updateStat_"+k+"' WJPerm='DICT02-DISABLE' onclick='dictDrugManagerMain.updateStatus(this.id, "+k+", 1)'>停用</a>")}else{n=$("<a id='btn_updateStat_"+k+"' WJPerm='DICT02-ENABLE' onclick='dictDrugManagerMain.updateStatus(this.id, "+k+", 0)'>启用</a>")}j.append(n)}o.append(j);r.append(o)}e.curPage=h.data.currentPage;e.totalPage=h.data.totalPage};$("#my-page").generatePagination(c)},showAddPanelNoQuery:function(){var f=this;var c=$("#add_edit_div");var e=$("#drugSplit");var d=$("#drugAntibiotic");c.removeErrorMsg();if(!f.drugBasicData.drugDosageData){var b=new DictDrugManagerMainAction();var a=new DrugBasicData(b);a.loadDrugDosageData();f.drugBasicData.drugDosageData=global_loadDrugDosage}f.dictDrugManagerMainAction.resetControlVal();$("#SFDAApprovalNum-searchBox").show();f.dictDrugManagerMainAction.enableAllInput($("#drugBasicBox"));f.dictDrugManagerMainAction.enableAllInput($("#specEdit"));$("#drugBarcode").removeClass("wjzs-disabled").removeAttr("disabled");f.dictDrugManagerMainAction.enableOrDisableSelect("drugSplit");f.dictDrugManagerMainAction.enableOrDisableSelect("drugPropIdDrop",0);$("#drugDose-suffix").hide();$("#drugRetailPrice-suffix").hide();$("#drugCeilingPrice-suffix").hide();$("#scattered_div").hide();e.checkedItem([{id:"0"}]);d.checkedItem([{id:"0"}]);$("#btn_save").attr("data-pos","");$("#list_div").addClass("dsn");c.removeClass("dsn");$("#searchInput").focus();c.ketchup()},search:function(){this.isQuerying=1;this.loadDataPage()},showModifyPanel:function(c){var f=this;var a=f.returnMsg.data.dataSource;var e=a[c];var b=$("#add_edit_div");var d=$("#SFDAApprovalNum");$("#list_div").addClass("dsn");b.removeErrorMsg();$("#SFDAApprovalNum-searchBox").hide();f.dictDrugManagerMainAction.enableAllInput($("#drugBasicBox"));d.val(e.SFDA_APPROVAL_NUM);$("#drugCommonName").val(e.DRUG_COMMON_NAME);$("#drugPackageSpec").val(e.DRUG_PACKAGE_SPEC);$("#drugDosageName").val(f.drugBasicData.getDosageName(e.DRUG_DOSAGE_ID));$("#drugDosageId").val(e.DRUG_DOSAGE_ID);$("#drugManuFactorName").val(e.DRUG_MANUFACTOR_NAME);$("#drugPropId").SetWJZSDropdownSelectedData(e.DRUG_PROP_ID);$("#drugBarcode").val(e.DRUG_BARCODE);$("#drugGoodsName").val(e.DRUG_GOODS_NAME);$("#drugStandardCode").val(e.DRUG_STANDARD_CODE);$("#drugBasicUnitId").SetWJZSDropdownSelectedData(e.DRUG_BASIC_UNIT_ID);$("#drugDoseUnitId").SetWJZSDropdownSelectedData(e.DRUG_DOSE_UNIT_ID);$("#drugStoreUnitId").SetWJZSDropdownSelectedData(e.DRUG_STORE_UNIT_ID);$("#dosage").val(e.DOSAGE_AMOUNT);$("#preparationAmount").val(e.PREPARATION_AMOUNT);$("#drugSplit").checkedItem([{id:e.DRUG_SPLIT}]);$("#drugAntibiotic").checkedItem([{id:e.IS_ANTIBIOTIC}]);$("#drugRetailPrice").val(e.DRUG_RETAIL_PRICE);$("#drugCeilingPrice").val(e.CEILING_PRICE);$("#scatteredPrice").val(e.SCATTERED_PRICE);$("#drugUsageId").SetWJZSDropdownSelectedData(e.DRUG_USAGE_ID);$("#drugFrequencyId").SetWJZSDropdownSelectedData(e.DRUG_FREQUENCY_ID);$("#drugDose").val(e.DRUG_DOSE);$("#pyCode").val(e.PY_CODE);$("#wbCode").val(e.WB_CODE);f.dictDrugManagerMainAction.changeInputSuffix("drugRetailPrice","drugStoreUnitId","元");f.dictDrugManagerMainAction.changeInputSuffix("drugCeilingPrice","drugStoreUnitId","元");f.dictDrugManagerMainAction.changeInputSuffix("drugDose","drugDoseUnitId");f.dictDrugManagerMainAction.drugSplitChange(e.DRUG_SPLIT.toString());f.dictDrugManagerMainAction.changeControlEditStatus(operationType.OPT_UPDATE,e.DRUG_STORE_UNIT_QTY);$("#btn_save").attr("data-pos",c);$("#drugBarcode").removeClass("wjzs-disabled").removeAttr("disabled");b.removeClass("dsn");b.ketchup()},saveDrugDict:function(h,e){var d=$("#add_edit_div").ableToFinish();if(!d){return}if(!$("#drugCommonName").val()){$.paError("请完善药品基本信息!");return}var j=this;var f=j.dictDrugManagerMainAction.buildDrugDictObject();if(e===operationType.OPT_UPDATE){var g=j.returnMsg.data.dataSource;var b=g[h];f.pDrugId=b.P_DRUG_ID;f.drugId=b.DRUG_ID;f.presetStatus=b.PRESET_STATUS}else{var k="";if(j.isStandardData){k=$("#drugId").val()}f.pDrugId=k;f.presetStatus=0;f.disabled=0;f.delFlag=0;f.isMaterial=0;f.isStandard=1;f.drugDoseUnitRate=1;f.drugSortId=$("#drugSortId").val()}var c={mdcDictDrug:f,isAntibiotic:$("#drugAntibiotic").getCheckedData()[0].id};var l=JSON.stringify(c);var a;if(e===operationType.OPT_UPDATE){a=maindata_url.getUrl().mdcDictDrug_updateDrugAndConvertRate}else{a=maindata_url.getUrl().mdcDictDrug_saveDrugAndConvertRate}var n={url:a,dataType:"json",data:l,contentType:"application/json",showMask:true};var m=Utils.myAjaxHandler(n);m.done(function(r){var o=r.errorMessage;var p=r.errorCode;if(p!=="E0000000"){$.paError("失败："+p+"，"+o);return}var q={curPage:j.curPage};if(e===operationType.OPT_UPDATE){j.loadDataPage(q);j.dictDrugManagerMainAction.switchToListViewDiv();$.paSuccess("更新成功！")}else{j.showAddPanelNoQuery();$.paSuccess("保存成功！")}}).fail(function(o){$.paError("获取数据失败!")}).always()},updateStatus:function(d,g,e){var h=this;var f=h.returnMsg.data.dataSource;var a=f[g];if(e===1){if(a.DRUG_STORE_UNIT_QTY>0){$.paAlert("该药品有库存，不能停用!");return}}var c={drugId:a.DRUG_ID,disabled:e,presetStatus:a.PRESET_STATUS};var b={mdcDictDrug:c};var j=JSON.stringify(b);var l={url:maindata_url.getUrl().mdcDictDrug_updateByPrimaryKeySelective,dataType:"json",data:j,contentType:"application/json"};var k=Utils.myAjaxHandler(l);k.done(function(p){var m=p.errorMessage;var n=p.errorCode;if(n==="E2SP0212"){$.paAlert("该药品有库存，不能停用!");return}if(n!=="E0000000"){$.paError("失败："+n+"，"+m);return}$.paSuccess("更新状态成功！");var o={curPage:h.curPage};h.loadDataPage(o)}).fail(function(m){$.paError("获取数据失败!")}).always()}};var DrugBasicData=function(a){this.statusData=[{id:0,txt:"启用"},{id:1,txt:"停用"}];this.yesOrNoData=[{id:"0",txt:"否"},{id:"1",txt:"是"}];this.drugTypesData=null;this.drugDosageData=null;this.drugDosageDropOptions={idKey:"DRUG_DOSAGE_ID",txtKey:"DRUG_DOSAGE_NAME",isNeedClear:true};this.drugUsageData=null;this.drugFrequencyData=null;this.drugUnitData=null;this.dictDrugManagerMainAction=a};DrugBasicData.prototype={initBasicData:function(){this.loadDrugTypeData();this.loadStatusData();this.loadSplitData();this.loadDrugAntibioticData();this.loadDrugDosageData();this.loadDrugUsageData();this.loadDrugFrequencyData();this.loadDrugUnitData()},loadDrugTypeData:function(){var c=this;var a={url:ContextClinc_Server+"mdcDictDrug/drugtypes?searchType=1",dataType:"json",contentType:"application/json",data:{},method:"GET"};var b=Utils.myAjaxHandler(a);b.done(function(g){c.drugTypesData=g.data;var e=g.errorMessage;var f=g.errorCode;if(f!=="E0000000"){$.paError("失败："+f+"，"+e)}var d={idKey:"drugTypeId",txtKey:"drugTypeName"};$("#drugPropId").WJZSDropdown(c.drugTypesData,d,function(h,j){})}).fail(function(d){$.paError("获取数据失败!")}).always(function(){})},loadStatusData:function(){var b=this;var a=$("#status");a.WJZSDropdown(b.statusData,{isNeedAll:true,isNeedClear:false},function(c,d){dictDrugManagerMain.loadDataPage()});a.SetWJZSDropdownSelectedData(0)},loadSplitData:function(){var a=this;$("#drugSplit").setInputForm(a.yesOrNoData,{type:"radio",idKey:"id",txtKey:"txt"},function(b){var c=b.id;a.dictDrugManagerMainAction.drugSplitChange(c)})},loadDrugAntibioticData:function(){var a=this;$("#drugAntibiotic").setInputForm(a.yesOrNoData,{type:"radio",idKey:"id",txtKey:"txt"},function(b){})},loadDrugDosageData:function(){var c=this;var a={url:maindata_url.getUrl().combox_mdcDrugDosageForm,dataType:"json",contentType:"application/json",async:false,data:{}};var b=Utils.myAjaxHandler(a);b.done(function(f){c.drugDosageData=f.data;global_loadDrugDosage=f.data;var d=f.errorMessage;var e=f.errorCode;if(e!=="E0000000"){$.paError("失败："+e+"，"+d)}}).fail(function(d){$.paError("获取数据失败!")}).always(function(){})},loadDrugUsageData:function(){var c=this;var a={url:maindata_url.getUrl().combox_mdcDrugUsage,dataType:"json",method:"GET",contentType:"application/json;charset=utf-8"};var b=Utils.myAjaxHandler(a);b.done(function(g){c.drugUsageData=g.data;var e=g.errorMessage;var f=g.errorCode;if(f!=="E0000000"){$.paError("失败："+f+"，"+e);return}var d={idKey:"DRUG_USAGE_ID",txtKey:"DRUG_USAGE_NAME",isNeedClear:true};$("#drugUsageId").WJZSDropdown(c.drugUsageData,d,function(h,j){})}).fail(function(d){}).always(function(){})},loadDrugFrequencyData:function(){var c=this;var a={url:maindata_url.getUrl().combox_mdcDrugFrequency,dataType:"json",contentType:"application/json",data:{}};var b=Utils.myAjaxHandler(a);b.done(function(g){c.drugFrequencyData=g.data;var e=g.errorMessage;var f=g.errorCode;if(f!=="E0000000"){$.paError("失败："+f+"，"+e);return}var d={idKey:"DRUG_FREQUENCY_ID",txtKey:"DRUG_FREQUENCY_NAME",isNeedClear:true};$("#drugFrequencyId").WJZSDropdown(c.drugFrequencyData,d,function(h,j){})}).fail(function(d){$.paError("获取数据失败!")}).always(function(){})},loadDrugUnitData:function(){var c=this;var a={url:maindata_url.getUrl().combox_mdcDrugUnitWithType,dataType:"json",contentType:"application/json",data:{}};var b=Utils.myAjaxHandler(a);b.done(function(j){c.drugUnitData=j.data;var g=j.errorMessage;var h=j.errorCode;if(h!=="E0000000"){$.paError("失败："+h+"，"+g);return}var e={idKey:"DRUG_UNIT_ID",txtKey:"DRUG_UNIT_NAME",isNeedClear:false};var f=[];var d=[];var k=[];for(i in c.drugUnitData){if(c.drugUnitData[i].DRUG_UNIT_TYPE==="1"){f.push(c.drugUnitData[i])}else{if(c.drugUnitData[i].DRUG_UNIT_TYPE==="2"){d.push(c.drugUnitData[i])}else{if(c.drugUnitData[i].DRUG_UNIT_TYPE==="3"){k.push(c.drugUnitData[i])}}}}$("#drugDoseUnitId").WJZSDropdown(f,e,function(l,m){c.dictDrugManagerMainAction.changeInputSuffix("drugDose","drugDoseUnitId")});$("#drugBasicUnitId").WJZSDropdown(d,e,function(l,m){var n=$("#drugSplit").getCheckedData()[0].id;if(n==="1"){c.dictDrugManagerMainAction.changeInputSuffix("scatteredPrice","drugBasicUnitId","元")}});$("#drugStoreUnitId").WJZSDropdown(k,e,function(l,m){c.dictDrugManagerMainAction.changeInputSuffix("drugRetailPrice","drugStoreUnitId","元");c.dictDrugManagerMainAction.changeInputSuffix("drugCeilingPrice","drugStoreUnitId","元")})}).fail(function(d){$.paError("获取数据失败!")}).always(function(){})},getDosageName:function(a){for(x in global_loadDrugDosage){if(global_loadDrugDosage[x].DRUG_DOSAGE_ID===a){return global_loadDrugDosage[x].DRUG_DOSAGE_NAME}}},getDrugPropId:function(a){for(x in this.drugTypesData){if(this.drugTypesData[x].pDrugTypeId===a){return this.drugTypesData[x].drugTypeId}}}};var DictDrugManagerMainAction=function(){};DictDrugManagerMainAction.prototype={changeInputClassToSuffix:function(b){var a=$("#"+b);a.addClass("input-text-with-suffix");a.removeClass("input-text")},changeInputSuffix:function(h,c,e){var f=this;var b=$("#"+h+"-suffix");var a=$("#"+c);var g=$.trim(a.attr("val"));var d=a.val();if(!e){e=""}if(h&&h!==""){if(g&&g!==""){f.changeInputClassToSuffix(h);if(h!=="drugDose"){b.text(e+"/"+d)}else{b.text(d)}b.show()}else{if(!g||g===""){f.changeInputClassToSuffix(h);b.hide()}}}},drugSplitChange:function(d){this.changeInputClassToSuffix("drugRetailPrice");var b=$("#drugRetailPrice-suffix");if(getSelectValue("drugStoreUnitId")!==""){b.text("元/"+$("#drugStoreUnitId").val());b.show()}this.changeInputClassToSuffix("drugCeilingPrice");var c=$("#drugCeilingPrice-suffix");if(getSelectValue("drugStoreUnitId")!==""){c.text("元/"+$("#drugStoreUnitId").val());c.show()}this.changeInputClassToSuffix("scatteredPrice");var a=$("#scatteredPrice-suffix");if(getSelectValue("drugBasicUnitId")!==""){a.text("元/"+$("#drugBasicUnitId").val());a.show()}if(d==="1"){$("#scattered_div").show();$("#scatteredPrice").addClass("validate(required,number,notspace,decimal(4),maxlength(10))")}else{$("#scattered_div").hide();$("#scatteredPrice").removeClass("validate(required,number,notspace,decimal(4),maxlength(10))");$("#scattered_div").removeErrorMsg();isNaN($("#scatteredPrice").val())?$("#scatteredPrice").val(""):""}$("#add_edit_div").ketchup()},fillPYValue:function(){var b=$.trim($("#drugCommonName").val());var a=hz2JP(b);$("#pyCode").val(a)},fillWBValue:function(){var b=$.trim($("#drugCommonName").val());var a=hz2WB(b);$("#wbCode").val(a)},clearDrugBasicBox:function(){var a=$("#drugBasicBox");a.find("input:not(#drugBarcode)").val("");a.find("input:not(#drugBarcode)").attr("val","")},clearSpecEditBox:function(){var a=$("#specEdit");a.find("input").val("");a.find("input").attr("val","")},detailDataDisabled:function(a,b){if(a.DISABLED===1){b.css("color","#A8A8A8")}},switchToListViewDiv:function(){$("#add_edit_div").addClass("dsn");$("#list_div").removeClass("dsn")},resetControlVal:function(){var a=$("#add_edit_div");a.find("input").val("");a.find("input").attr("val","")},changeControlEditStatus:function(a,c){var d=this;if(a===operationType.OPT_UPDATE){var b=$("#drugPackageSpecInfo");if(c!==null&&parseFloat(c)>0){d.disabledAllInput(b);d.enableOrDisableSelect("drugSplit",1)}else{d.enableAllInput(b);d.enableOrDisableSelect("drugSplit")}}},buildDrugDictObject:function(){var u=$("#drugBasicUnitId");var m=$.trim(u.attr("val"));var k=$.trim(u.val());var p=$("#drugDoseUnitId");var v=$.trim(p.val());var t=$.trim(p.attr("val"));var c=$("#drugStoreUnitId");var q=$.trim(c.val());var s=$.trim(c.attr("val"));var b=$.trim($("#drugPackageSpec").val());var f=$.trim($("#drugCommonName").val());var n=$.trim($("#drugRetailPrice").val());var e=$.trim($("#drugCeilingPrice").val());var h=$.trim($("#scatteredPrice").val());var j=$.trim($("#dosage").val());var d=$.trim($("#preparationAmount").val());var l=$("#drugSplit").getCheckedData()[0].id;var w;var r;var y;if(l==="1"){w=j;r=m;y=k}else{w=j*d;r=s;y=q}var a=d*j;var g=$.trim($("#SFDAApprovalNum").val());var o={drugName:f,drugCommonName:f,drugPropId:$.trim($("#drugPropId").attr("val")),drugDosageId:$.trim($("#drugDosageId").val()),drugBarcode:$.trim($("#drugBarcode").val()),drugGoodsName:$.trim($("#drugGoodsName").val()),drugStandardCode:$.trim($("#drugStandardCode").val()),drugPackageSpec:b,dosageAmount:j,preparationAmount:d,drugBasicUnitId:m,drugDoseUnitId:t,drugDispenseUnitId:r,drugStoreUnitId:s,drugBasicUnitName:k,drugDoseUnitName:v,drugDispenseUnitName:y,drugStoreUnitName:q,drugSplit:l,drugUsageId:$.trim($("#drugUsageId").attr("val")),drugFrequencyId:$.trim($("#drugFrequencyId").attr("val")),drugDose:$("#drugDose").val(),drugRetailPrice:n,scatteredPrice:h,ceilingPrice:e||-1,pyCode:$.trim($("#pyCode").val()),wbCode:$.trim($("#wbCode").val()),drugDispenseUnitRate:w,drugStoreUnitRate:a,sfdaApprovalNum:g,drugManuFactorName:$.trim($("#drugManuFactorName").val()),drugManuFactorId:$("#drugManuFactorId").val()};return o},isDrugPackageSpecModify:function(a){if(!equals(parseFloat($("#dosage").val()),a.DOSAGE_AMOUNT)){return true}if(!equals(parseFloat($("#preparationAmount").val()),a.PREPARATION_AMOUNT)){return true}if(!equals($("#drugDoseUnitId").attr("val"),a.DRUG_DOSE_UNIT_ID)){return true}if(!equals($("#drugBasicUnitId").attr("val"),a.DRUG_BASIC_UNIT_ID)){return true}return !equals($("#drugStoreUnitId").attr("val"),a.DRUG_STORE_UNIT_ID)},disabledAllInput:function(a){a.each(function(){var c=$(this);c.addClass("wjzs-disabled");c.find("input").addClass("wjzs-disabled");c[0].setAttribute("disabled","disabled");c.find("input").each(function(){$(this)[0].setAttribute("disabled","disabled")});c.find(".drop").each(function(){$(this).addClass("disabled")});if(c.hasClass("drop")){c.addClass("disabled")}if(c.hasClass("checkboxes")){c[0].removeAttribute("readonly");c.removeClass("wjzs-disabled");c.append("<div class='select-disabled'>&nbsp;</div>");c.find("li").each(function(){$(this).addClass("wjzs-disabled")})}if(c.find("span").hasClass("radio")){c[0].removeAttribute("readonly");c.removeClass("wjzs-disabled");var b=c.position().top;c.append("<div class='select-disabled' style='top:"+b+"px'>&nbsp;</div>");c.find("span").each(function(){$(this).addClass("wjzs-disabled")})}})},enableAllInput:function(a){a.each(function(){var b=$(this);b.removeClass("wjzs-disabled");b.find("input").removeClass("wjzs-disabled");b[0].removeAttribute("disabled");b.find("input").each(function(){$(this)[0].removeAttribute("disabled")});b.find(".disabled").each(function(){$(this).removeClass("disabled");$(this).addClass("drop")});if(b.hasClass("disabled")){b.removeClass("disabled");b.addClass("drop")}if(b.find("span").hasClass("radio")){b.find(".select-disabled").remove();b.find("span").each(function(){$(this).removeClass("wjzs-disabled")})}if(b.hasClass("checkboxes")){b.find(".select-disabled").remove();b.find("li").each(function(){$(this).removeClass("wjzs-disabled")})}})},enableOrDisableSelect:function(c,b){var a=$("#"+c);if(b===1){if(!a.hasClass("eventInvalid")){a.addClass("eventInvalid")}}else{if(a.hasClass("eventInvalid")){a.removeClass("eventInvalid")}}}};