var userInfo_aclc=config_cache.getCache("medical_user_data");var empiId=Utils.getQueryString("empiId");var isYbReg=Utils.getQueryString("isYbReg");var clinicID=userInfo_aclc!=null?userInfo_aclc.clinicId:$.paWarn("页面参数错误:[clinicID]不能为空");var acographyId=Utils.getQueryString("acographyId");var treatmentState=Utils.getQueryString("treatmentState");var treatTypes=1;var triageId=Utils.getQueryString("triageId");var iflytek;var gender;var userInfo_aclc=config_cache.getCache("medical_user_data");var doctorName=Utils.isBlank(userInfo_aclc.employee)?userInfo_aclc.employee.employeeName:"";var employeeId=userInfo_aclc.id;var finishPatFlag=true;$(function(){var a=[];var b=[];var g=[];var d=[];var k=[];var p=0;var j=false;var m=[];var s={authKey:"B212C1499F",hospitalGuid:1,userGuid:4361,doctorGuid:1,serialNumber:7225};try{var n=new Cdss("#cdss_container",s)}catch(q){}var t={medicalRecordId:"",acographyId:"",clinicId:"",empiId:"",chiefComplaint:"",historyOfPresentIllness:"",pastHistory:"",mensesHistory:"",procreateHistory:"",operationHistory:"",allergiesHistory:"",personalHistory:"",historyOfPreventiveIno:"",familyHistory:"",bloodPressureMin:"",bloodPressureMax:"",heartRate:"",temperature:"",height:"",weight:"",doctorAdvice:"",breathRate:"",otherPhysicalExamination:"",othersInfo:"",treatmentType:"",diagnosis:"",diagnosisIcd10:"",diagnosisIcd10Code:"",treatmentType:""};$("ul.inner-form").ketchup();document.getElementsByClassName("mc_submit")[0].onclick=function(){c.saveMedRecord()};document.getElementById("search_patient").onclick=function(){var e=document.getElementById("doctorAdvice").scrollHeight;c.getDoctorAdviceQuoteList(e)};function l(){}function o(){}function h(){}h.prototype={_init:function(){r.initPage()},initPage:function(){r.initMedicalRecordData();r.initEmpiInfo();r.casesOfMenAndWomen();r.hideEditeBtn();r.clickMedRecTmplBtn();r.clickSaveMedRecTmplBtn();r.checkTreatmentStatus();r.clinicPrintBtn();r.clickHisMedPrint();r.getStockParam();r.clickAddDisBtn();f.initChiefComThinkInput();f.bindDiagnosisChange()},getStockParam:function(){var u=JSON.parse(localStorage.getItem("medical_user_data")).clinicParams;for(var e=0;e<u.length;e++){if(u[e].parameterCode=="3009"){var v=u[e].parameterValue==2?false:true;if(v){$(".solove_box").css("right","40px")}else{$(".solove_box").css("right","15px")}}}},initMedicalRecordData:function(){t.clinicId=userInfo_aclc.clinicId;t.empiId=empiId;t.acographyId=acographyId;iflytek=new Iflytek();c.validateArea();c.selectMedRecordNew();try{c.initialization()}catch(e){}},initArea:function(){r.temperatureOnBlur();r.heartRateOnBlur();r.breathRateOnBlur();r.bloodPressureMinOnBlur();r.bloodPressureMaxOnBlur();r.heightOnBlur();r.weightOnBlur()},unBindArea:function(){$("#temperature").off("blur").removeClass("addRedColor");$("#heartRate").off("blur").removeClass("addRedColor");$("#breathRate").off("blur").removeClass("addRedColor");$("#bloodPressureMin").off("blur").removeClass("addRedColor");$("#bloodPressureMax").off("blur").removeClass("addRedColor");$("#height").off("blur").removeClass("addRedColor");$("#weight").off("blur").removeClass("addRedColor")},initEmpiInfo:function(){var u=window.top.$("#patOtherInfo").text();if(u){var e=u.split("|")[0];age=u.split("|")[1].split("岁")[0]}if(e.indexOf("男")!=-1){gender=1}else{if(e.indexOf("女")!=-1){gender=0}}},casesOfMenAndWomen:function(){if(gender){document.getElementById("fk").classList.add("dsn")}else{document.getElementById("fk").classList.remove("dsn")}},bindQuicklySelect:function(e){if(!e){c.quicklySelect.historyQueryData(["allergiesHistory","familyHistory","pastHistory","personalHistory","historyOfPreventiveIno"])}else{$("#allergiesHistory,#familyHistory,#pastHistory,#personalHistory,#historyOfPreventiveIno").unbind()}},hideEditeBtn:function(){document.getElementById("editeBtn").style.display="none"},resumeBtn:function(){$(".mc_submit").off("click").addClass("disable").attr("disabled",true)},suspendBtn:function(){$(".mc_submit").off().on("click",function(){c.saveMedRecord()}).removeClass("dsn disable").attr("disabled",false)},sleep:function(u){var e=new Date();var v=e.getTime()+u;while(true){e=new Date();if(e.getTime()>v){return}}},checkRadio:function(){$(".radio").off("click").on("click",function(){if(!$(this).hasClass("checked")){$(this).addClass("checked");$(this).siblings().removeClass("checked")}})},clickAddDisBtn:function(){$(".addDiagnosis").off("click").on("click",function(u){if($(this).hasClass("add-cf")){$(".dsn.delete-cf").eq(0).removeClass("dsn").prev().removeClass("dsn")}else{try{n.removeDiagnosisData(m[$(this).prev().attr("index")])}catch(v){}$(this).addClass("dsn").prev().addClass("dsn").attr("val","").attr("valname","").val("")}})},isContains:function(x){var w=["鼠疫","霍乱","传染性非典型肺炎","艾滋病","病毒性肝炎","脊髓灰质炎","人感染高致病性禽流感","甲型H1N1流感","麻疹","流行性出血热","狂犬病","流行性乙型脑炎","登革热","炭疽","细菌性和阿米巴性痢疾","肺结核","伤寒和副伤寒","流行性脑脊髓膜炎","百日咳","白喉","新生儿破伤风","猩红热","布鲁氏菌病","淋病","梅毒","钩端螺旋体病","血吸虫病","疟疾","流行性感冒","流行性腮腺炎","风疹","急性出血性结膜炎","麻风病","流行性和地方性斑疹伤寒","黑热病","包虫病","丝虫病，除霍乱","细菌性和阿米巴性痢疾","伤寒和副伤寒以外的感染性腹泻病","手足口病"];var u="";for(var e=0;e<w.length;e++){if(e==w.length-1){u+=w[e]}else{u+=w[e]+"|"}}var v=new RegExp(u,"g");if(v.test(x)){return true}else{return false}},checkTreatmentStatus:function(){if(treatmentState==2){document.getElementsByClassName("input-text")[0].setAttribute("readonly","readonly");document.getElementsByClassName("think-text")[0].setAttribute("readonly","readonly");document.getElementsByClassName("mc_submit")[0].style.display="none";document.getElementById("medRecSaveTmplBtn").style.display="none";document.getElementById("medRecTmplBtn").style.display="none"}},clickSaveMedRecTmplBtn:function(){var e=document.getElementById("medRecSaveTmplBtn");e.style.display="block";e.onclick=function(){var u={msg:'<div class="clear" style="margin-bottom: 12px; padding-left: 18px;"><div class="fl" style="color:#5c5c5c;">模板级别：</div><div class="template-level"><span class="radio checked" val="3" >个人模板</span><span class="radio" val="2">诊所模板</span></div></div><i class="necessary">*</i>模板名称：<input type="text" class="input-text" maxlength="15" id="cfm-input">',label:"模板名称: ",cancelTxt:"取消",saveTxt:"确认",onYes:function(){var v=$.trim($("#cfm-input").val());if(v==null||v==undefined||v==""){$.paWarn("不能为空");return}if(v.length>15){$.paWarn("不得多于15个字");return}if(c.checkMrTmplName(v)){r.saveToMedRecTmpl(v);config_cache.removeCache(cacheMap.MedRecTmplList)}else{$.paWarn("名字重复");return}}};$.paConfirm(u);r.checkRadio()}},getDiagnosisList:function(){var A=[];var e=document.getElementsByClassName("input-diagnosis");for(i=0;i<e.length;i++){var w=e[i].getAttribute("val");var z=e[i].getAttribute("valName");var v=e[i].value;if(Utils.notBlank(w)){w=w.replace(/(^\s*)|(\s*$)/g,"")}if(Utils.notBlank(z)){z=z.replace(/(^\s*)|(\s*$)/g,"")}if(Utils.notBlank(v)){v=v.replace(/(^\s*)|(\s*$)/g,"")}if(Utils.notBlank(w)&&v==z&&Utils.notBlank(v)){var y={};y.diagnosisIcd10=e[i].getAttribute("valName");y.diagnosisIcd10Code=e[i].getAttribute("val");y.diagnosisKind=1;A.push(y)}else{var x=e[i].value.replace(/(^\s*)|(\s*$)/g,"");if(Utils.notBlank(x)){var u={};u.diagnosis=x;u.diagnosisKind=1;A.push(u)}}}return A},checkMedRcd:function(u){var e=t.treatmentType;if(e==2||e==1){if(Utils.notBlank(u)){return true}else{$.paWarn("ERROR002:诊断为必填项");return false}}},checkEmpiIdVal:function(e){if(e!=null&&e!=""){return true}else{$.paWarn("ERROR003:患者Id不能为空");return false}},checkIcd10InputOK:function(){var v=document.getElementById("diagnosis");var u=v.getAttribute("valName");var e=v.value;return u==e},saveToMedRecTmpl:function(e){var x={templateId:null,clinicId:clinicID,departmentId:null,doctorId:null,templateName:e,templateType:"",chiefComplaint:"",historyOfPresentIllness:"",mensesHistory:"",procreateHistory:"",operationHistory:"",allergiesHistory:"",personalHistory:"",pastHistory:"",historyOfPreventiveIno:"",familyHistory:"",otherPhysicalExamination:"",othersInfo:"",remark:""};var y=document.getElementById("diagnosis");x.chiefComplaint=document.getElementById("chiefComplaint").value;x.historyOfPresentIllness=document.getElementById("historyOfPresentIllness").value;x.allergiesHistory=document.getElementById("allergiesHistory").value;x.mensesHistory=document.getElementById("mensesHistory").value;x.procreateHistory=document.getElementById("procreateHistory").value;x.operationHistory=document.getElementById("operationHistory").value;x.personalHistory=document.getElementById("personalHistory").value;x.pastHistory=document.getElementById("pastHistory").value;x.historyOfPreventiveIno=document.getElementById("historyOfPreventiveIno").value;x.familyHistory=document.getElementById("familyHistory").value;x.otherPhysicalExamination=document.getElementById("otherPhysicalExamination").value;x.templateType=$(".template-level").find(".checked").attr("val");x.othersInfo=document.getElementById("othersInfo").value;var w=r.getDiagnosisList();var v={};v.dwsDiagnosisRecordList=w;var u={dwsMedicalRecordTmpl:x,mdDictDiagnosisReq:v};c.editeMedicalRecTmpl(u)},clearAcogAndMedRec:function(){document.getElementById("chiefComplaint").value="";document.getElementById("historyOfPresentIllness").value="";document.getElementById("allergiesHistory").value="";document.getElementById("personalHistory").value="";document.getElementById("pastHistory").value="";document.getElementById("mensesHistory").value="";document.getElementById("procreateHistory").value="";document.getElementById("operationHistory").value="";document.getElementById("historyOfPreventiveIno").value="";document.getElementById("familyHistory").value="";document.getElementById("othersInfo").value="";document.getElementById("otherPhysicalExamination").value="";document.getElementById("height").value="";document.getElementById("weight").value="";document.getElementById("temperature").value="";document.getElementById("bloodPressureMin").value="";document.getElementById("heartRate").value="";document.getElementById("doctorAdvice").value="";document.getElementById("bmi").value="";document.getElementById("bmiLevelArea").value="";document.getElementById("bloodSugar").value="";document.getElementById("bloodOxygen").value="";document.getElementById("grs").classList.remove("checked");document.getElementById("grs").classList.remove("checked");document.getElementsByClassName("input-grs")[0].classList.add("dsn");document.getElementById("yfbds").classList.remove("checked");document.getElementsByClassName("input-yfbds")[0].classList.add("dsn");document.getElementById("jzs").classList.remove("checked");document.getElementsByClassName("input-jzs")[0].classList.add("dsn");document.getElementById("fk").classList.remove("checked");document.getElementsByClassName("input-fk")[0].classList.add("dsn");document.getElementById("qt").classList.remove("checked");document.getElementsByClassName("input-qt")[0].classList.add("dsn");config_cache.removeCache(cacheMap.MedRecTmplList)},checkMedRecColumn:function(e,u){var v=config_cache.getCache(cacheMap.hisMedRecList);if($(e).children(".input-chiefComplaint-his").children("td").children(".checkbox-chiefComplaint").hasClass("checked")){t.chiefComplaint=v[u].chiefComplaint}if($(e).children(".input-hisPreIll-his").children("td").children(".checkbox-hisPreIll").hasClass("checked")){t.historyOfPresentIllness=v[u].historyOfPresentIllness}if($(e).children(".input-pastHis-his").children("td").children(".checkbox-pastHis").hasClass("checked")){t.pastHistory=v[u].pastHistory}if($(e).children(".input-mensesHis-his").children("td").children(".checkbox-mensesHis").hasClass("checked")){t.mensesHistory=v[u].mensesHistory}if($(e).children(".input-procreateHis-his").children("td").children(".checkbox-procreateHis").hasClass("checked")){t.procreateHistory=v[u].procreateHistory}if($(e).children(".input-operationHis-his").children("td").children(".checkbox-operationHis").hasClass("checked")){t.operationHistory=v[u].operationHistory}if($(e).children(".input-allerHis-his").children("td").children(".checkbox-allerHis").hasClass("checked")){t.allergiesHistory=v[u].allergiesHistory}if($(e).children(".input-grs-his").children("td").children(".checkbox-perHistory").hasClass("checked")){t.personalHistory=v[u].personalHistory}if($(e).children(".input-yfbds-his").children("td").children(".checkbox-hisOfPreIno").hasClass("checked")){t.historyOfPreventiveIno=v[u].historyOfPreventiveIno}if($(e).children(".input-jzs-his").children("td").children(".checkbox-familyHis").hasClass("checked")){t.familyHistory=v[u].familyHistory}if($(e).children(".input-qt-his").children("td").children(".checkbox-othersInfo").hasClass("checked")){t.othersInfo=v[u].othersInfo}if($(e).children(".input-pe-his").children("td").children(".checkbox-pe").hasClass("checked")){t.bloodPressureMin=v[u].bloodPressureMin;t.bloodPressureMax=v[u].bloodPressureMax;t.heartRate=v[u].heartRate;t.temperature=v[u].temperature;t.breathRate=v[u].breathRate;t.otherPhysicalExamination=v[u].otherPhysicalExamination}if($(e).children(".input-docAd-his").children("td").children(".checkbox-docAd").hasClass("checked")){t.doctorAdvice=v[u].doctorAdvice}if($(e).children(".input-diagnosis-his").children("td").children(".checkbox-diagnosis").hasClass("checked")){t.dwsDiagnosisRecordList=v[u].dwsDiagnosisRecordList}return t},clickEditeBtn:function(){document.getElementById("editeBtn").onclick=function(){var e=document.getElementById("doctorAdvice").scrollHeight;if(e>82){$(".icon-voice").last().css({width:"20px",right:"50px"})}f.showSaveBtn()}},clickHisMedPrint:function(){$(".his_med_print").off("click").on("click",function(){var u=$(this).parents().parents().parents().parents().attr("index_hislist");var e=config_cache.getCache(cacheMap.hisMedRecList);wjPrintUtils.getPrintSetting(wjPrintUtils.printFunction.medicalRecord,function(y,w){if(y==1){print_model.hisRecords(e[u])}else{if(y==2){var v=e[u].acographyId;var x=e[u].empiId;print_model.customPrint(v,x,w,true)}else{$.paWarn("请先配置打印参数！")}}})})},clickMedRecTmplBtn:function(){document.getElementById("medRecTmplBtn").onclick=function(e){$(".search-input").val("");e.stopPropagation();c.selectTmplInfo();document.getElementsByClassName("mtr")[0].style.display="block";document.getElementsByClassName("popup-model")[0].style.display="block";$("#medRec_person_tmpl").find("dd").show();$("#medRec_person_tmpl").find("dt").addClass("topIcon");Utils.renderPopup()};$(".mtr .popup-model").on("click","dt",function(u){var e=$(this).parents("dl").find("dd").is(":visible");if(!e){$(this).parents("dl").siblings().find("dd").hide();$(this).parents("dl").find("dd").show();$(this).parents("dl").siblings().find("dt").removeClass("topIcon");$(this).addClass("topIcon")}else{$(this).parents("dl").find("dd").hide();$(this).removeClass("topIcon")}Utils.renderPopup()})},asemblePeHtml:function(e){var u="";if(e.temperature!=""&&e.temperature!=null){u+=" 体温："+e.temperature}if(e.bloodPressureMax!=""&&e.bloodPressureMax!=null){u+=" 收缩压："+e.bloodPressureMax}if(e.bloodPressureMin!=""&&e.bloodPressureMin!=null){u+=" 舒张压："+e.bloodPressureMin}if(e.heartRate!=""&&e.heartRate!=null){u+=" 脉搏："+e.heartRate}if(e.breathRate!=""&&e.breathRate!=null){u+=" 呼吸："+e.breathRate}if(e.otherPhysicalExamination!=""&&e.otherPhysicalExamination!=null){u+=" "+e.otherPhysicalExamination}return u},clinicPrintBtn:function(){$(".print").off("click").on("click",function(){var x=document.getElementById("historyOfPresentIllness").value;var z=document.getElementById("allergiesHistory").value;var u=document.getElementById("personalHistory").value;var M=document.getElementById("pastHistory").value;var L=document.getElementById("historyOfPreventiveIno").value;var D=document.getElementById("familyHistory").value;var J=document.getElementById("mensesHistory").value;var G=document.getElementById("procreateHistory").value;var v=document.getElementById("operationHistory").value;var E=document.getElementById("otherPhysicalExamination").value;var F=document.getElementById("othersInfo").value;var y=document.getElementById("bloodPressureMin").value;var A=document.getElementById("bloodPressureMax").value;var K=document.getElementById("heartRate").value;var I=document.getElementById("temperature").value;var C=document.getElementById("height").value;var B=document.getElementById("weight").value;var w=document.getElementById("bloodSugar").value;var e=document.getElementById("bloodOxygen").value;var H=document.getElementById("breathRate").value;dwsMedicalRecord={acographyId:acographyId,empiId:empiId,chiefComplaint:chiefComplaint,historyOfPresentIllness:x,allergiesHistory:z,personalHistory:u,pastHistory:M,mensesHistory:J,procreateHistory:G,operationHistory:v,historyOfPreventiveIno:L,familyHistory:D,otherPhysicalExamination:E,othersInfo:F,bloodPressureMin:y,bloodPressureMax:A,heartRate:K,temperature:I,height:C,weight:B,bloodSugar:w,bloodOxygen:e,breathRate:H};if($(this).hasClass("printReview")){reviewFlag=true}print_model.printRecordsFacade(acographyId,empiId)})},temperatureOnBlur:function(){$("#temperature").off("blur").on("blur",function(){var e=$.trim($("#temperature").val());if(e&&e.length>1){e=Number(e);if(!e||e<20||e>45){$("#temperature").val("");$("#temperature").removeClass("addRedColor");$.paWarn("超出输入范围")}else{if(!e||(e<36&&e>=20)||e>37){$("#temperature").addClass("addRedColor")}else{$("#temperature").removeClass("addRedColor")}}}else{if(e.length===1&&!Number(e)){$("#temperature").val("");$("#temperature").removeClass("addRedColor");$.paWarn("超出输入范围")}else{if(e==""){$("#temperature").removeClass("addRedColor")}}}})},heartRateOnBlur:function(){$("#heartRate").off("blur").on("blur",function(){var e=$.trim($("#heartRate").val());e=Number(e);if(e){if(!e||e<60||e>100){$("#heartRate").addClass("addRedColor")}else{$("#heartRate").removeClass("addRedColor")}}else{if(e==""){$("#heartRate").removeClass("addRedColor")}else{if(!Number(e)){$("#heartRate").val("");$("#heartRate").removeClass("addRedColor");$.paWarn("超出输入范围")}}}})},breathRateOnBlur:function(){$("#breathRate").off("blur").on("blur",function(){var e=$.trim($("#breathRate").val());e=Number(e);if(e){if(!e||e<15||e>45){$("#breathRate").addClass("addRedColor")}else{$("#breathRate").removeClass("addRedColor")}}else{if(e==""){$("#breathRate").removeClass("addRedColor")}else{if(!Number(e)){$("#breathRate").val("");$("#breathRate").removeClass("addRedColor");$.paWarn("超出输入范围")}}}})},bloodPressureMinOnBlur:function(){$("#bloodPressureMin").off("blur").on("blur",function(){var e=$.trim($("#bloodPressureMin").val());e=Number(e);if(e){if(!e||e<60||e>90){$("#bloodPressureMin").addClass("addRedColor")}else{$("#bloodPressureMin").removeClass("addRedColor")}}else{if(e==""){$("#bloodPressureMin").removeClass("addRedColor")}else{if(!Number(e)){$("#bloodPressureMin").val("");$("#bloodPressureMin").removeClass("addRedColor");$.paWarn("超出输入范围")}}}})},bloodPressureMaxOnBlur:function(){$("#bloodPressureMax").off("blur").on("blur",function(){var e=$.trim($("#bloodPressureMax").val());e=Number(e);if(e){if(!e||e<90||e>140){$("#bloodPressureMax").addClass("addRedColor")}else{$("#bloodPressureMax").removeClass("addRedColor")}}else{if(e==""){$("#bloodPressureMax").removeClass("addRedColor")}else{if(!Number(e)){$("#bloodPressureMax").val("");$("#bloodPressureMax").removeClass("addRedColor");$.paWarn("超出输入范围")}}}})},heightOnBlur:function(){$("#height").off("blur").on("blur",function(){var e=$.trim($("#height").val());if(e!=""){e=/^\d+$/.test(e);if(!e){$("#height").val("");$.paWarn("超出输入范围")}}else{$("#bmi").val("")}})},weightOnBlur:function(){$("#weight").off("blur").on("blur",function(){var e=$.trim($("#weight").val());if(e!=""){e=/^\d{1,3}$|^\d{1,3}\.\d{1}$/.test(e);if(!e){$("#weight").val("");$.paWarn("超出输入范围")}}else{$("#bmi").val("")}})}};l.prototype={showNurPreexamData:function(e){if(e&&e.PREEXAM_ID){document.getElementById("allergiesHistory").value=Utils.trimObj(e.ALLERGIES_HISTORY);document.getElementById("pastHistory").value=Utils.trimObj(e.PAST_HISTORY);if(!gender){document.getElementById("fk").classList.remove("dsn");document.getElementById("mensesHistory").value=Utils.trimObj(e.MENSES_HISTORY);document.getElementById("procreateHistory").value=Utils.trimObj(e.PROCREATE_HISTORY);document.getElementById("operationHistory").value=Utils.trimObj(e.OPERATION_HISTORY)}if(e.FAMILY_HISTORY){document.getElementById("jzs").classList.add("checked");document.getElementsByClassName("input-jzs")[0].classList.remove("dsn");document.getElementById("familyHistory").value=Utils.trimObj(e.FAMILY_HISTORY)}else{document.getElementById("jzs").classList.remove("checked");document.getElementsByClassName("input-jzs")[0].classList.add("dsn")}document.getElementById("temperature").value=Utils.trimObj(e.TEMPERATURE);document.getElementById("bloodPressureMin").value=Utils.trimObj(e.DIASTOLIC);document.getElementById("bloodPressureMax").value=Utils.trimObj(e.SYSTOLIC);document.getElementById("heartRate").value=Utils.trimObj(e.PULSE_RATE);document.getElementById("breathRate").value=Utils.trimObj(e.BREATH_RATE);document.getElementById("height").value=Utils.trimObj(e.HEIGHT);document.getElementById("weight").value=Utils.trimObj(e.WEIGHT);document.getElementById("bmi").value=e.BMI;document.getElementById("bloodSugar").value=e.BLOOD_SUGAR;document.getElementById("bloodOxygen").value=e.BLOOD_OXYGEN;c.calBMI()}},clickHisDetail:function(){$(".full-width-table tbody tr td >i").off("click").on("click",function(){var e=$(this);if(e.hasClass("checked")){$(e).removeClass("checked")}else{$(e).addClass("checked")}})},appendHisMedRecord:function(v,e){var u=v.dwsHisMedicalRecord;if(u.length>0){var w="";$.each(u,function(y){var x=f.appendHisMedRecordDetail(u[y],y,e);w+=x});if(w!=""){$(".mtr-historyRecord").append(w);f.clickQuoteBtn();f.clickConfirmQuoteBtn();f.clickHisDetail();r.clickHisMedPrint()}}},appendHisMedRecordNew:function(v,e){var u=v;if(u.length>0){var w="";$.each(u,function(y){var x=f.appendHisMedRecordDetail(u[y],y,e);w+=x});if(w!=""){$(".mtr-historyRecord").append(w);f.clickQuoteBtn();f.clickConfirmQuoteBtn();f.clickHisDetail();r.clickHisMedPrint();f.clickOpenHisMedRecord()}}},appendHisMedRecordDetail:function(U,B,w){var R="";var Q="";var v=f.checkHisMedRecordDetail(U.chiefComplaint);var J=f.checkHisMedRecordDetail(U.historyOfPresentIllness);var K=f.checkHisMedRecordDetail(U.pastHistory);var G=f.checkHisMedRecordDetail(U.mensesHistory);var D=f.checkHisMedRecordDetail(U.procreateHistory);var S=f.checkHisMedRecordDetail(U.operationHistory);var F=f.checkHisMedRecordDetail(U.allergiesHistory);var z=f.checkHisMedRecordDetail(U.personalHistory);var y=f.checkHisMedRecordDetail(U.historyOfPreventiveIno);var M=f.checkHisMedRecordDetail(U.familyHistory);var H=f.checkHisMedRecordDetail(U.othersInfo);var x="";var A=f.checkHisMedRecordDetail(U.doctorAdvice);var P="";var u="";var O=f.checkHisMedRecordDetail(U.doctorName);if(U.treatmentType==1){Q="初诊"}else{Q="复诊"}if(U.visitDate!=""&&U.visitDate!=null){P=U.visitDate}else{P="--"}if(!gender){u='<tr class="input-mensesHis-his">		       			<td><span class="tspan">月经史：</span> <span class="historyOfPresentIllness Cspan">'+G+'</span><i class="check-box checkbox-mensesHis dsn"></i></td>		       			</tr>		       			<tr class="input-procreateHis-his">		           			<td><span class="tspan">生育史：</span> <span class="historyOfPresentIllness Cspan">'+D+'</span><i class="check-box checkbox-procreateHis dsn"></i></td>		       			</tr>		       			<tr class="input-operationHis-his">		           			<td><span class="tspan">手术史：</span> <span class="historyOfPresentIllness Cspan">'+S+'</span><i class="check-box checkbox-operationHis dsn"></i></td>		       			</tr>'}if((U.bloodPressureMin!=""&&U.bloodPressureMin!=null)||(U.bloodPressureMax!=""&&U.bloodPressureMax!=null)||(U.heartRate!=""&&U.heartRate!=null)||(U.temperature!=""&&U.temperature!=null)||(U.breathRate!=""&&U.breathRate!=null)||(U.otherPhysicalExamination!=""&&U.otherPhysicalExamination!=null)){var L=r.asemblePeHtml(U);x=L}else{x="--"}var E="";var e=U.dwsDiagnosisRecordList;if(Utils.notBlank(e)){for(var N=0;N<e.length;N++){if(Utils.notBlank(e[N].diagnosis)){E+=e[N].diagnosis+";"}else{if(Utils.notBlank(e[N].diagnosisIcd10)){E+=e[N].diagnosisIcd10+";"}}}}E=f.checkHisMedRecordDetail(E);var C="";if(w){C='<span class="fl quote reference" title="引用"></span>'}else{C='<span class="fl quote reference dsn" title="引用"></span>'}var T="";var I="";if(Utils.isBlank(U.isShareEmpiId)&&U.isShareEmpiId==1){T="门店："+U.clinicName;I="dsn"}R='<div class="history_record_item" index_hisList='+B+' >		    					<div class="head-line">		    		           		<span class="check-style">'+Q+'</span> <span class="checkDate">'+f.checkHisMedRecordDetail(U.visitDate)+'</span> <span class="doctorName">'+O+'</span> <span class="clinicName">'+T+'</span>		    		                	<i class="expand"></i>		    		           </div>						       <div class="history-content hide">					       	   <div class="history-top-wrap clear">					               <div class="historyBtn fr" medicalId='+U.medicalRecordId+" acographyId="+U.acographyId+">					                   "+C+'					                   <span class="fl his_med_print '+I+'" title="打印"></span>					               </div>					           </div>					       	   <table class="full-width-table patient-table">									<tbody>			    		           		<tr class="input-chiefComplaint-his">			    		           			<td><span class="tspan">主诉：</span> <span class="cnChiefComplaint Cspan">'+v+'</span><i class="check-box checkbox-chiefComplaint dsn"></i></td>			    		           		</tr>			    		           		<tr class="input-hisPreIll-his">			    		           			<td><span class="tspan">现病史：</span> <span class="historyOfPresentIllness Cspan">'+J+'</span><i class="check-box checkbox-hisPreIll dsn"></i></td>			    		           		</tr>			    		           		'+u+'<tr class="input-pastHis-his">			    		           			<td><span class="tspan">既往史：</span> <span class="pastHistory Cspan">'+K+'</span><i class="check-box checkbox-pastHis dsn"></i></td>		    		           			</tr>										<tr class="input-allerHis-his">											<td><span class="tspan">过敏史：</span> <span class="allerHistory Cspan">'+F+'</span><i class="check-box checkbox-allerHis dsn"></i></td>										</tr>										<tr class="input-grs-his">											<td><span class="tspan">个人史：</span> <span class="personalHistory Cspan">'+z+'</span><i class="check-box checkbox-perHistory dsn"></i></td>										</tr>										<tr class="input-yfbds-his">											<td><span class="tspan">预防接种史：</span> <span class="historyOfPreventiveIno Cspan">'+y+'</span><i class="check-box checkbox-hisOfPreIno dsn"></i></td>										</tr>										<tr class="input-jzs-his">											<td><span class="tspan">家族史：</span> <span class="familyHistory Cspan">'+M+'</span><i class="check-box checkbox-familyHis dsn"></i></td>										</tr>										<tr class="input-qt-his">											<td><span class="tspan">其他：</span> <span class="othersInfo Cspan">'+H+'</span><i class="check-box checkbox-othersInfo dsn"></i></td>										</tr>										<tr class="input-pe-his">											<td><span class="tspan">体格检查：</span> <span class="otherPhysicalExamination Cspan">'+x+'</span><i class="check-box checkbox-pe dsn"></i></td>										</tr>										<tr class="input-diagnosis-his">											<td><span class="tspan">诊断：</span> <span class="diagnosis Cspan">'+E+'</span><i class="check-box checkbox-diagnosis dsn"></i></td>										</tr>											<tr class="input-docAd-his">											<td><span class="tspan">处理意见：</span> <span class="doctorAdvice Cspan">'+A+'</span><i class="check-box checkbox-docAd dsn"></i></td>										</tr>									</tbody>								</table>								<div class="mtr-history-footBtn clear ">								     <span class="btn quoteBtn fr dsn" id="">确认引用</span>								</div>					       </div>						</div>';return R},checkHisMedRecordDetail:function(e){if(e!=null&&e!="null"&&e!=""){return $("<div/>").text(e).html()}return"--"},clickQuoteBtn:function(){$(".history-top-wrap .historyBtn .quote").off("click").on("click",function(){var u=$(this);var w=$(u).parents().parents().siblings(".full-width-table");var v=$(u).parents().parents().siblings(".mtr-history-footBtn");var e=$(w).children("tbody").children("tr").children("td").children("i");$.each(e,function(x){$(e[x]).removeClass("dsn")});$(v).children(".quoteBtn").removeClass("dsn")})},clickConfirmQuoteBtn:function(){$(".quoteBtn").off("click").on("click",function(){var u=$(this);var v=true;var x=$(u).parents().siblings(".full-width-table").children("tbody");var w=$(u).parents().parents().parents().attr("index_hislist");var e=$(x).children("tr").children("td").children("i");$.each(e,function(y){if($(e[y]).hasClass("checked")){v=false}});if(v){$.each(e,function(y){$(e[y]).removeClass("checked");$(e[y]).addClass("dsn")});$(u).addClass("dsn");return}t=r.checkMedRecColumn(x,w);f.clearMedRecTmpl();f.showDiagnosisList(t.dwsDiagnosisRecordList);f.appendAcogAndMedRecInfo(t);$.paSuccess("引用成功");$.each(e,function(y){$(e[y]).removeClass("checked");$(e[y]).addClass("dsn")});$(u).addClass("dsn")})},clearMedRecTmpl:function(){$("#chiefComplaint").val("");$("#historyOfPresentIllness").val("");$("#allergiesHistory").val("");$("#personalHistory").val("");$("#pastHistory").val("");$("#mensesHistory").val("");$("#procreateHistory").val("");$("#operationHistory").val("");$("#historyOfPreventiveIno").val("");$("#familyHistory").val("");$("#othersInfo").val("");$("#doctorAdvice").val("");$("#diagnosis").val("");$("#diagnosis").attr("val","");$("#diagnosis").attr("valName","");$("#grs").removeClass("checked");$(".input-grs").addClass("dsn");$("#yfbds").removeClass("checked");$(".input-yfbds").addClass("dsn");$("#jzs").removeClass("checked");$(".input-jzs").addClass("dsn");$("#fk").removeClass("checked");$(".input-fk").addClass("dsn");$("#qt").removeClass("checked");$(".input-qt").addClass("dsn");$("#otherPhysicalExamination").val("")},appendAcogAndMedRecInfo:function(e){if(e.chiefComplaint){document.getElementById("chiefComplaint").value=e.chiefComplaint}$("#chiefComplaint").data("preValue",e.chiefComplaint);if(e.historyOfPresentIllness){document.getElementById("historyOfPresentIllness").value=e.historyOfPresentIllness}if(e.allergiesHistory){document.getElementById("allergiesHistory").value=e.allergiesHistory}$("#allergiesHistory").data("preValue",e.allergiesHistory);document.getElementById("personalHistory").value=e.personalHistory;document.getElementById("pastHistory").value=e.pastHistory;if(!gender){document.getElementById("mensesHistory").value=e.mensesHistory;document.getElementById("procreateHistory").value=e.procreateHistory;document.getElementById("operationHistory").value=e.operationHistory}$("#pastHistory").data("preValue",e.pastHistory);document.getElementById("historyOfPreventiveIno").value=e.historyOfPreventiveIno;document.getElementById("familyHistory").value=e.familyHistory;document.getElementById("othersInfo").value=e.othersInfo;if(e.otherPhysicalExamination!=null&&e.otherPhysicalExamination!=""){document.getElementById("otherPhysicalExamination").value=e.otherPhysicalExamination}if(e.height!=null&&e.height!=""){document.getElementById("height").value=e.height}if(e.weight!=null&&e.weight!=""){document.getElementById("weight").value=e.weight}if(e.temperature!=null&&e.temperature!=""){document.getElementById("temperature").value=e.temperature}if(e.bloodPressureMin!=null&&e.bloodPressureMin!=""){document.getElementById("bloodPressureMin").value=e.bloodPressureMin}if(e.bloodPressureMax!=null&&e.bloodPressureMax!=""){document.getElementById("bloodPressureMax").value=e.bloodPressureMax}if(e.heartRate!=null&&e.heartRate!=""){document.getElementById("heartRate").value=e.heartRate}if(e.breathRate!=null&&e.breathRate!=""){document.getElementById("breathRate").value=e.breathRate}if(e.bloodSugar!=null&&e.bloodSugar!=""){document.getElementById("bloodSugar").value=e.bloodSugar}if(e.bloodOxygen!=null&&e.bloodOxygen!=""){document.getElementById("bloodOxygen").value=e.bloodOxygen}if(e.doctorAdvice!=null&&e.doctorAdvice!=""){document.getElementById("doctorAdvice").value=e.doctorAdvice}c.calBMI();if(e.personalHistory!=null&&e.personalHistory!=""){document.getElementById("grs").classList.add("checked");document.getElementsByClassName("input-grs")[0].classList.remove("dsn")}if(e.historyOfPreventiveIno!=null&&e.historyOfPreventiveIno!=""){document.getElementById("yfbds").classList.add("checked");document.getElementsByClassName("input-yfbds")[0].classList.remove("dsn")}if(e.familyHistory!=null&&e.familyHistory!=""){document.getElementById("jzs").classList.add("checked");document.getElementsByClassName("input-jzs")[0].classList.remove("dsn")}if(!gender){if(e.mensesHistory!=null&&e.mensesHistory!=""||e.procreateHistory!=null&&e.procreateHistory!=""||e.operationHistory!=null&&e.operationHistory!=""){document.getElementById("fk").classList.add("checked");$(".input-fk").removeClass("dsn")}}if(e.othersInfo!=null&&e.othersInfo!=""){document.getElementById("qt").classList.add("checked");document.getElementsByClassName("input-qt")[0].classList.remove("dsn")}},appendMedRecInfo:function(v){var w=v.dwsAcography;var u=v.dwsMedicalRecord;if(u!=null&&u!=undefined&&u!=""){f.appendAcogAndMedRecInfo(u)}if(w!=null){f.showDiagnosisList(v.diagnosisRecordList);var e=w.treatmentType;if(e==1){document.getElementById("firDiag").classList.add("cur");t.treatmentType=1}else{if(e==2){document.getElementById("secDiag").classList.add("cur");document.getElementsByClassName("hisPreIll")[0].classList.add("dsn");document.getElementsByClassName("pastHis")[0].classList.add("dsn");t.treatmentType=2}else{document.getElementById("firDiag").classList.add("cur");t.treatmentType=1}}f.checkChiefComplaintIsEmpty(t.treatmentType)}if(treatmentState==2){document.getElementById("medRecTmplBtn").style.display="none";document.getElementsByClassName("diagnosis-btn")[0].style.display="none"}else{document.getElementById("medRecSaveTmplBtn").style.display="block";document.getElementById("medRecTmplBtn").style.display="block"}c.selectTmplInfo()},checkChiefComplaintIsEmpty:function(e){},firDiagCondition:function(e){e.off("click blur").on({blur:function(){if($(this).val()==""){$(this).val($.fn.ketchup.messages.required).addClass("pawjzs-error")}else{if($(this).val()==$.fn.ketchup.messages.required){$(this).val("")}$(this).removeClass("pawjzs-error")}},click:function(){if($(this).val()==$.fn.ketchup.messages.required){$(this).val("").removeClass("pawjzs-error")}}}).addClass("validate(required)").addClass("validate(maxlength(500))")},showEditeBtn:function(){f.showAddDiagnosis(false);$(".submit-btn").hide();$("#search_patient").hide();if(treatmentState==1){$("#editeBtn").show();$(".diagnosis-btn").hide()}$("#medRecSaveTmplBtn").show();$("#medRecTmplBtn").hide();$(".inner-form .input-text").css("background-color","transparent");$(".inner-form textarea").css("background-color","transparent");$(".inner-form .input-text").attr("readonly","readonly");$(".inner-form textarea").attr("readonly","readonly");$(".med-checkboxes li").off("click");r.clickEditeBtn();r.unBindArea();f.clickOpenHisMedRecord();$(".inner-form").off("keydown");$(".inner-form").off("blur");if(iflytek){iflytek.hideVoice()}var e=$(".med-checkboxes >li");$.each(e,function(u){if($(e[u]).hasClass("checked")){$(e[u]).addClass("check-disable")}});$(".tab-content-top .print").show();$(".com_status_left .clear .treatType").off("click");finishPatFlag=true;r.bindQuicklySelect(true)},showSaveBtn:function(){f.showAddDiagnosis(true);$("#docs").show();$("#doci").hide();$(".submit-btn").hide();if(treatmentState==1){$("#saveBtn").show();$("#medRecSaveTmplBtn").show();$("#medRecTmplBtn").show();$(".diagnosis-btn").show();$("#search_patient").show()}$(".inner-form .input-text").css("background-color","");$(".inner-form textarea").css("background-color","");$(".inner-form .input-text").removeAttr("readonly");$(".inner-form textarea").removeAttr("readonly");f.clickMedicRecCheckBox();f.checkSaveTmplBtn();f.checkSaveBtnIsShow();f.checkSaveTmplBtn();f.clickOpenHisMedRecord();f.clickFisrtOrSecDiag();r.initArea();var e=$(".history-content .history-top-wrap .historyBtn .quote");$.each(e,function(v){$(e[v]).removeClass("dsn")});var u=$(".med-checkboxes >li");$.each(u,function(v){if($(u[v]).hasClass("checked")){$(u[v]).removeClass("check-disable")}});if(iflytek){iflytek.initIflytek("#chiefComplaint,#historyOfPresentIllness,#pastHistory,#doctorAdvice");iflytek.showVoice()}$(".tab-content-top .print").hide();finishPatFlag=false;r.bindQuicklySelect(false)},showAddDiagnosis:function(u){var e=r.getDiagnosisList();f.showDiagnosisList(e);var w=$(".addDiagnosis").size();for(var v=0;v<w;v++){if(!$(".addDiagnosis").eq(v).prev().hasClass("dsn")&&u){$(".addDiagnosis").eq(v).removeClass("dsn")}else{$(".addDiagnosis").eq(v).addClass("dsn");if(!Utils.notBlank($(".addDiagnosis").eq(v).prev().val().replace(/(^\s*)|(\s*$)/g,""))){if(v!=0){$(".addDiagnosis").eq(v).prev().addClass("dsn")}}}}},clickMedicRecCheckBox:function(e){$(".med-checkboxes li").off("click").on("click",function(){var u=$(this).hasClass("checked");if(u){$(this).removeClass("checked");$(".input-"+$(this).attr("id")).addClass("dsn")}else{$(this).addClass("checked");$(".input-"+$(this).attr("id")).removeClass("dsn")}return false})},checkSaveTmplBtn:function(){$(".inner-form").off("keydown").on("keydown",".input-text",function(){f.checkSaveBtnIsShow()});$(".inner-form").off("blur").on("blur",".input-text",function(){f.checkSaveBtnIsShow()})},initChiefComThinkInput:function(){if(!Utils.notBlank(isYbReg)){isYbReg=0}var u={wrapperHandle:".tab-content-wrapper",canedit:true,columns:[{display:"编码",dataKey:"DICT_DIAGNOSIS_CODE",width:60},{display:"名称",dataKey:"DICT_DIAGNOSIS_NAME",width:230}],extraParams:{key:"keyword",pageSize:20,isJoinMI:isYbReg},selectFirst:false,formatResult:function(v){return},formatMatch:function(x,w,v){return x.DICT_DIAGNOSIS_NAME+"--"+x.DICT_DIAGNOSIS_CODE+"--"+x.PY_CODE+"--"+x.WB_CODE},matchContains:"word",autoFill:false,width:485,max:100,multiple:false,multipleSeparator:", ",highlight:function(w,v){return w.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+v.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>")},scroll:true,scrollHeight:180};var e=MedicalRecord_url.medicalRecord_getMdcDictChiefComplaint;$(".input-diagnosis").autocomplete(e,u).result(function(v,x,w){if(r.isContains(x.DICT_DIAGNOSIS_NAME)){$.paWarn("该诊断为传染病，请及时填写传染病报卡")}if(f.checkDiagnosis(x.DICT_DIAGNOSIS_CODE)){$(this).val(x.DICT_DIAGNOSIS_NAME);$(this).attr("val",x.DICT_DIAGNOSIS_CODE);$(this).attr("valName",x.DICT_DIAGNOSIS_NAME)}else{$(this).attr("val","").attr("valName","").val("")}})},checkDiagnosis:function(v){if(Utils.notBlank(v)){var e=r.getDiagnosisList();if(Utils.notBlank(e)){for(var u=0;u<e.length;u++){if(e[u]["diagnosisIcd10Code"]==v){$.paWarn("已存在此诊断!");return false}}}return true}},removeDiagnosis:function(u){if(Utils.notBlank(u)){var e=$(".input-diagnosis");e.each(function(v){if(!$(e[v]).hasClass("dsn")){if($(e[v]).attr("val")==u){if(v!=0){$(".addDiagnosis").eq(v).addClass("dsn").prev().addClass("dsn").attr("val","").attr("valname","").val("")}else{$(".addDiagnosis").eq(v).prev().attr("val","").attr("valname","").val("")}}}})}},bindDiagnosisChange:function(){$(".input-diagnosis").on("keyup",function(){if(Utils.notBlank($(this).attr("val"))){$(this).attr("val","");$(this).attr("valname","")}});$(".input-diagnosis").off("click").on("click",function(){p=$(this).attr("index");j=true})},checkSaveBtnIsShow:function(){var u=document.getElementById("chiefComplaint").value;var v=document.getElementById("allergiesHistory").value;var e=document.getElementById("pastHistory").value;if(Utils.isBlank(u)&&Utils.isBlank(v)&&Utils.isBlank(e)){if(treatmentState==2){document.getElementById("medRecSaveTmplBtn").style.display="none";document.getElementById("medRecTmplBtn").style.display="none"}else{document.getElementById("medRecSaveTmplBtn").style.display="block";document.getElementById("medRecTmplBtn").style.display="block"}}else{document.getElementById("medRecSaveTmplBtn").style.display="block"}},commonInputKeyup:function(){var e=$(".mtr .think-text");e.each(function(u){f.itemInputThinkBox($(e[u]).attr("id"))})},itemInputThinkBox:function(v){var e={wrapperHandle:".tab-content-wrapper",canedit:true,columns:[{display:"",dataKey:v+"",width:380}],extraParams:{key:"keyword",limitRows:20},selectFirst:true,formatResult:function(w){return w[""+v+""]},formatMatch:function(y,x,w){return y[""+v+""]},matchContains:"word",autoFill:false,width:400,multiple:false,multipleSeparator:", ",scroll:false,scrollHeight:180};var u=config_cache.getCache(cacheMap.MedRecTmplList);$("#"+v).autocomplete(u,e).result(function(w,y,x){f.checkSaveBtnIsShow()})},clickOpenHisMedRecord:function(){$(".history_record_item .head-line").off("click").on("click",function(){var e=$(this);if($(e).siblings(".history-content").hasClass("hide")){$(e).siblings(".history-content").removeClass("hide");$(e).children("i").removeClass("expand");$(e).children("i").addClass("collapse")}else{$(e).siblings(".history-content").addClass("hide");$(e).children("i").removeClass("collapse");$(e).children("i").addClass("expand")}})},clickFisrtOrSecDiag:function(){$(".com_status_left .clear .treatType").off("click").on("click",function(){$(this).addClass("cur");$(this).siblings().removeClass("cur");var e=$(this).val();if(e==2){$(".pastHis").hide();$(".hisPreIll").hide();t.treatmentType=2}else{$(".pastHis").show();$(".hisPreIll").show();t.treatmentType=1}f.checkChiefComplaintIsEmpty(t.treatmentType)})},appendFirstOrSecTreat:function(u){var v=u.dwsAcography;document.getElementById("allergiesHistory").value="否认";if(v!=null){var e=v.treatmentType;if(e==1){document.getElementById("firDiag").classList.add("cur");t.treatmentType=1}else{if(e==2){document.getElementById("secDiag").classList.add("cur");document.getElementsByClassName("hisPreIll")[0].classList.add("dsn");document.getElementsByClassName("pastHis")[0].classList.add("dsn");t.treatmentType=2}else{document.getElementById("firDiag").classList.add("cur");t.treatmentType=1}}f.checkChiefComplaintIsEmpty(t.treatmentType)}else{document.getElementById("firDiag").classList.add("cur")}},appendMedRecTmplInfo:function(u){f.clearMedRecTmpl();var v=config_cache.getCache(cacheMap.MedRecTmplList);var e=v.dwsMedicalRecordTmpl[u];f.showDiagnosisList(f.getDiagnosisList(e.templateId));f.appendAcogAndMedRecInfo(e);$(".mtr .popup-model").hide()},getDiagnosisList:function(v){var e=[];if(Utils.notBlank(k)){for(var u=0;u<k.length;u++){if(v==k[u]["templateId"]){e.push(k[u])}}}return e},appendMedRecTmpl:function(A){k=A.dwsDiagnosisRecordTmplList;b=[];a=[];$("#medRec_person_tmpl").empty();$("#medRec_planform_tmpl").empty();var x=document.getElementById("medRec_person_tmpl");var w=document.createElement("dt");var z=document.createTextNode("个人模版");w.appendChild(z);x.appendChild(w);var v=document.getElementById("medRec_planform_tmpl");var u=document.createElement("dt");var e=document.createTextNode("诊所模版");u.appendChild(e);v.appendChild(u);var y=A.dwsMedicalRecordTmpl;if(y!=null&&y.length>0){$("#noDataHint").hide();$.each(y,function(D){var B=document.createElement("dd");B.classList.add("tp");B.setAttribute("val",D);var C=document.createTextNode(y[D].templateName);B.appendChild(C);if(y[D].templateType==3){B.setAttribute("title",y[D].templateName);x.appendChild(B);y[D]["index"]=D;b.push(y[D])}else{v.appendChild(B);y[D]["index"]=D;a.push(y[D])}});$("#medRec_person_tmpl").find("dd").show();$("#medRec_person_tmpl").find("dt").addClass("topIcon");$(".tp").off("click").on("click",function(){f.appendMedRecTmplInfo($(this).attr("val"))});Utils.renderPopup()}else{$("#noDataHint").show()}$(".search-btn").on("click",function(){var B=$(".search-input").val();var D="<dt>个人模版</dt>";if($("#medRec_planform_tmpl").find("dt").hasClass("topIcon")){D="<dt>诊所模版</dt>";g=[];$(a).each(function(E,F){if(Utils.notBlank(F.templateName)){if(F.templateName.indexOf(B)!=-1){g.push(F)}}});for(var C=0;C<g.length;C++){D=D+'<dd val="'+g[C].index+'"  title="'+g[C].templateName+'" class="tp" >'+g[C].templateName+"</dd>"}$("#medRec_planform_tmpl").empty().append(D);$("#medRec_planform_tmpl").find("dt").addClass("topIcon");$("#medRec_planform_tmpl").find("dd").hide();$("#medRec_planform_tmpl").find("dd").show();$(".tp").off("click").on("click",function(){f.appendMedRecTmplInfo($(this).attr("val"))});Utils.renderPopup()}if($("#medRec_person_tmpl").find("dt").hasClass("topIcon")){g=[];$(b).each(function(E,F){if(Utils.notBlank(F.templateName)){if(F.templateName.indexOf(B)!=-1){g.push(F)}}});for(var C=0;C<g.length;C++){D=D+'<dd val="'+g[C].index+'"  title="'+g[C].templateName+'" class="tp" >'+g[C].templateName+"</dd>"}$("#medRec_person_tmpl").empty().append(D);$("#medRec_person_tmpl").find("dt").addClass("topIcon");$("#medRec_person_tmpl").find("dd").hide();$("#medRec_person_tmpl").find("dd").show();$(".tp").off("click").on("click",function(){f.appendMedRecTmplInfo($(this).attr("val"))});Utils.renderPopup()}})},showDiagnosisList:function(u){if(Utils.notBlank(u)){$(".addDiagnosis").addClass("dsn").prev().addClass("dsn").attr("val","").attr("valname","").val("");var e=document.getElementsByClassName("input-diagnosis");for(i=0;i<u.length;i++){if(Utils.notBlank(u[i].diagnosis)){e[i].value=u[i].diagnosis}else{e[i].setAttribute("val",u[i].diagnosisIcd10Code);e[i].setAttribute("valName",u[i].diagnosisIcd10);e[i].value=u[i].diagnosisIcd10}$(".addDiagnosis").eq(i).removeClass("dsn").prev().removeClass("dsn")}}else{$(".addDiagnosis").eq(0).removeClass("dsn").prev().removeClass("dsn").attr("val","").attr("valname","").val("")}}};o.prototype={initdoctor:function(){var e=new component_drop_doctor();e.init_preChoose();e.init_view_readOnly();$(".component_drop_doctor_readonly_input").addClass("doci-input");$(".component_drop_doctor_input").addClass("docs-input")},initialization:function(){n.listenViewChange(function(z){var D=z.currentEntity;var E=$("#chiefComplaint");var C=$("#otherPhysicalExamination");if(!D.isActive){if(D.type==1){if(D.sysType==1){var u=$.trim(C.val()).split(" ");var A=u.indexOf(D.name);u.splice(A,1);C.val(u.join(" "))}else{var x=$.trim(E.val()).split(" ");var w=x.indexOf(D.name);x.splice(w,1);E.val(x.join(" "))}}else{if(!D.isActive){f.removeDiagnosis(D.icdCode)}else{var e=r.getDiagnosisList();if(e.length>4){$.paWarn("最多填写5个诊断!");n.removeDiagnosisData(D)}else{if(f.checkDiagnosis(D.icdCode)){if(j){var B=$(".input-diagnosis");var v=0;B.each(function(G){if(!$(B[G]).hasClass("dsn")){v=$(B[G]).attr("index")}});if(v<p){p=v}$(".input-diagnosis").eq(p).val(D.value).attr("val",D.icdCode).attr("valName",D.value);m[p]=D;j=false}else{var B=$(".input-diagnosis");for(var A=0;A<$(B).size();A++){if(!Utils.notBlank($(B[A]).val())){$(".input-diagnosis").eq(A).val(D.value).attr("val",D.icdCode).attr("valName",D.value);$(".addDiagnosis").eq(A).removeClass("dsn").prev().removeClass("dsn");m[A]=D;break}}}}}}}}else{if(D.type==1){if(D.sysType==1){var F=$.trim(C.val());C.val((F!=""?F+" ":F)+D.name)}else{var y=$.trim(E.val()).replace(/^<br>/,"");E.val((y!=""?y+" ":y)+D.name)}}else{if(!D.isActive){f.removeDiagnosis(D.icdCode)}else{var e=r.getDiagnosisList();if(e.length>4){$.paWarn("最多填写5个诊断!");n.removeDiagnosisData(D)}else{if(f.checkDiagnosis(D.icdCode)){if(j){var B=$(".input-diagnosis");var v=0;B.each(function(G){if(!$(B[G]).hasClass("dsn")){v=$(B[G]).attr("index")}});if(v<p){p=v}$(".input-diagnosis").eq(p).val(D.value).attr("val",D.icdCode).attr("valName",D.value);m[p]=D;j=false}else{var B=$(".input-diagnosis");for(var A=0;A<$(B).size();A++){if(!Utils.notBlank($(B[A]).val())){$(".input-diagnosis").eq(A).val(D.value).attr("val",D.icdCode).attr("valName",D.value);$(".addDiagnosis").eq(A).removeClass("dsn").prev().removeClass("dsn");m[A]=D;break}}}}}}}}});$(".open-csds-panel").on("click",function(){var v=$(".cdss_container_wrapper");var e=v.width();if(parseInt(v.css("marginRight"))==0){v.animate({marginRight:"-"+(parseInt(e)+14)+"px"})}else{v.animate({marginRight:"0px"});var u=$("#chiefComplaint");if(u.val()==$.fn.ketchup.messages.required){u.val("").removeClass("pawjzs-error")}s.symptom=u.val();s.gender=gender;s.age=age;s.ageType="岁";s.previousHistory=$("#pastHistory").val();s.allergyHistory=$("#allergiesHistory").val();s.presentHistory=$("#historyOfPresentIllness").val();s.temperature=$("#bodyTempr").val();s.bloodPressureMax=$("#highBldPress").val();s.bloodPressureMin=$("#lowBldPress").val();s.weight=$("#weight").val();(function(){var x="sysType=B&sysModel=HZZX&sysMenu=OPC_DWS04_AI_DIAGNOSIS";var w=new Image(1,1);w.src=ContextClinc_Web+"collection.png?"+x})();n.setAssistantData(s,true);n.setComplaintData(u.val())}});$("#chiefComplaint").on("keyup",function(){s.symptom=chiefComplaint;s.gender=gender;s.age=age;s.ageType="岁";s.previousHistory=$("#pastHistory").val();s.allergyHistory=$("#allergiesHistory").val();s.presentHistory=$("#historyOfPresentIllness").val();s.temperature=$("#bodyTempr").val();s.bloodPressureMax=$("#highBldPress").val();s.bloodPressureMin=$("#lowBldPress").val();s.weight=$("#weight").val();n.setAssistantData(s,true);n.setComplaintData($(this).val())})},validateArea:function(){$("#validateArea").ketchup();$("#height").keyup(function(){c.calBMI()});$("#weight").keyup(function(){c.calBMI()})},calBMI:function(){var v=$("#height").val();var u=$("#weight").val();if(v>0&&u>0){v=v/100;var y=$("#bmiLevelArea");var w=$("#bmi");var e=u/(v*v)+"";e=Utils.roundFixed(e,1);if(e){var x="正常";if(e>=18.5&&e<=24){x="正常"}else{if(e<18.5){x="偏瘦"}else{if(e>24){x="肥胖"}}}y.text(x);w.val(e)}}},saveMedRecord:function(){r.resumeBtn();var J=r.getDiagnosisList();var Q={};Q.dwsDiagnosisRecordList=J;var R=document.getElementById("chiefComplaint").value;var B=document.getElementById("allergiesHistory").value;var F=r.getDiagnosisList();var I=r.checkEmpiIdVal(empiId);if(!Utils.notBlank(F)){$.paWarn("诊断为必填项!");r.suspendBtn();return}if(!I){r.suspendBtn();return}var S=false;var V=t.treatmentType;var S=$("ul.inner-form").ableToFinish();if(!S){r.suspendBtn();return}var z="";var X="";if($("#firDiag").hasClass("cur")){z=document.getElementById("historyOfPresentIllness").value;X=document.getElementById("pastHistory").value}var B=document.getElementById("allergiesHistory").value;var u="";if($("#grs").hasClass("checked")){u=document.getElementById("personalHistory").value}var W="";if($("#yfbds").hasClass("checked")){W=document.getElementById("historyOfPreventiveIno").value}var L="";if($("#jzs").hasClass("checked")){L=document.getElementById("familyHistory").value}var T="";var N="";var w="";if($("#fk").hasClass("checked")){T=document.getElementById("mensesHistory").value;N=document.getElementById("procreateHistory").value;w=document.getElementById("operationHistory").value}var M="";if($("#qt").hasClass("checked")){M=document.getElementById("othersInfo").value}var K=document.getElementById("otherPhysicalExamination").value;var A=document.getElementById("bloodPressureMin").value;var D=document.getElementById("bloodPressureMax").value;var U=document.getElementById("heartRate").value;var P=document.getElementById("temperature").value;var H=document.getElementById("height").value;var C=document.getElementById("weight").value;var y=document.getElementById("bloodSugar").value;var e=document.getElementById("bloodOxygen").value;var O=document.getElementById("breathRate").value;var E=document.getElementById("doctorAdvice").value;var v={dwsMedicalRecord:{acographyId:acographyId,empiId:empiId,chiefComplaint:R,historyOfPresentIllness:z,pastHistory:X,allergiesHistory:B,personalHistory:u,mensesHistory:T,procreateHistory:N,operationHistory:w,historyOfPreventiveIno:W,familyHistory:L,otherPhysicalExamination:K,othersInfo:M,bloodPressureMin:A,bloodPressureMax:D,heartRate:U,temperature:P,height:H,weight:C,bloodSugar:y,bloodOxygen:e,breathRate:O,doctorAdvice:E},treatmentType:V,mdDictDiagnosisReq:Q};var x={url:MedicalRecord_url.medicalRecord_insertOrUpdateDwsMedRec,dataType:"json",type:"POST",data:JSON.stringify(v),contentType:"application/json;charset=utf-8",showMask:true};var G=Utils.myAjaxHandler(x);G.done(function(Y){if(Y!=null&&Y.errorCode==SUCCESSCODE){$.paSuccess("保存成功！");r.suspendBtn();f.showEditeBtn()}else{$.paWarn(status.errorMessage)}}).fail(function(Y){$.paWarn("保存失败!");r.suspendBtn()})},selectMedRecord:function(){r.clearAcogAndMedRec();var e={empiId:empiId,acographyId:acographyId,triageId:triageId};var u={url:MedicalRecord_url.medicalRecord_selectMedRec,dataType:"json",type:"POST",data:e,showMask:true};var v=Utils.myAjaxHandler(u);v.done(function(x){if(x!=null&&x.errorCode==SUCCESSCODE){var w=x.data;if(w.is_machine){$("#bloodInfo").show()}else{$("#bloodInfo").hide()}if(treatmentState==0){f.showNurPreexamData(w.nurPreexam)}else{if(treatmentState==1){if(iflytek){iflytek.initIflytek("#chiefComplaint,#historyOfPresentIllness,#pastHistory,#doctorAdvice")}config_cache.setCache(cacheMap.hisMedRecList,w.dwsHisMedicalRecord);if(w.dwsMedicalRecord!=null){f.appendHisMedRecord(w,false);f.appendMedRecInfo(w);f.showEditeBtn()}else{f.appendHisMedRecord(w,true);f.appendFirstOrSecTreat(w);f.showNurPreexamData(w.nurPreexam);f.showSaveBtn()}}else{if(treatmentState==2){f.appendMedRecInfo(w);$("#diagnosis").off("blur");f.showEditeBtn()}}}}else{$.paWarn(status.errorMessage)}}).fail(function(w){$.paWarn("保存失败!")}).always(function(){})},selectDwsMedRecHistoryNew:function(u){var w={};var e={empiId:empiId,acographyId:acographyId,triageId:triageId};var v={url:MedicalRecord_url.medicalRecord_selectDwsMedRecHistoryNew,dataType:"json",type:"POST",data:e};var x=Utils.myAjaxHandler(v);x.done(function(y){if(y!=null&&y.errorCode==SUCCESSCODE){w=y.data.dwsHisMedicalRecord;config_cache.setCache(cacheMap.hisMedRecList,w);if(Utils.isBlank(w)){f.appendHisMedRecordNew(w,true)}else{f.appendHisMedRecordNew(w,false)}}}).fail(function(y){}).always(function(){});return w},selectMedRecordNew:function(){r.clearAcogAndMedRec();var e={empiId:empiId,acographyId:acographyId,triageId:triageId};var u={url:MedicalRecord_url.medicalRecord_selectMedRecNew,dataType:"json",type:"POST",data:e,showMask:true};var v=Utils.myAjaxHandler(u);v.done(function(y){if(y!=null&&y.errorCode==SUCCESSCODE){var x=y.data;if(x.is_machine){$("#bloodInfo").show()}else{$("#bloodInfo").hide()}if(treatmentState==0){f.showNurPreexamData(x.nurPreexam);f.showEditeBtn();$(".diagnosis-btn").hide()}else{if(treatmentState==1){if(iflytek){iflytek.initIflytek("#chiefComplaint,#historyOfPresentIllness,#pastHistory,#doctorAdvice")}var w=c.selectDwsMedRecHistoryNew(false);if(x.dwsMedicalRecord!=null){f.appendMedRecInfo(x);f.showEditeBtn()}else{f.appendFirstOrSecTreat(x);f.showNurPreexamData(x.nurPreexam);f.showSaveBtn()}}else{if(treatmentState==2){f.appendMedRecInfo(x);$("#diagnosis").off("blur");f.showEditeBtn()}}}}else{$.paWarn(status.errorMessage)}}).fail(function(w){$.paWarn("保存失败!")}).always(function(){})},checkMrTmplName:function(w){var u={};var e={url:tmplEditeUrl.checkMrTmplName,dataType:"json",data:{tmplName:w!=null?w:""},async:false};var v=Utils.myAjaxHandler(e);v.done(function(x){if(x!=null&&x.errorCode==SUCCESSCODE){u=x.data}else{$.paWarn(x.errorMessage)}}).fail(function(x){$.paWarn("操作失败!")}).always(function(){});return u},editeMedicalRecTmpl:function(u){var v={};var e={url:tmplEditeUrl.editeMedicalRecTmpl,dataType:"json",type:"POST",data:JSON.stringify(u),contentType:"application/json;charset=utf-8",async:false};var w=Utils.myAjaxHandler(e);w.done(function(x){if(x!=null&&x.errorCode==SUCCESSCODE){v=x.data;$.paSuccess("操作成功!")}else{$.paWarn(x.errorMessage)}}).fail(function(x){$.paWarn("操作失败!")}).always(function(){});return v},selectTmplInfo:function(){var v=config_cache.getCache(cacheMap.MedRecTmplList);if(v==null||v==undefined||v==""){var u={};var e={url:MedicalRecordTmpl_url.medicalRecord_selectAllTemplateInfoNew,type:"POST",dataType:"json"};var w=Utils.myAjaxHandler(e);w.done(function(x){if(x!=null&&x.errorCode==SUCCESSCODE){u=x.data;config_cache.setCache(cacheMap.MedRecTmplList,u);f.appendMedRecTmpl(u)}else{$.paWarn(status.errorMessage)}}).fail(function(x){$.paWarn("保存失败!")}).always(function(){})}else{f.appendMedRecTmpl(v)}},quicklySelect:{historyQueryData:function(e,w){var u=this;var y={dictTypeList:e};var v={type:"POST",contentType:"application/json; charset=utf-8",url:ContextClinc_Server+"docWorkSta/queryMdcDataDictByType",data:JSON.stringify(y),dataType:"json"};var x=Utils.myAjaxHandler(v);x.done(function(A){if(A.errorCode==SUCCESSCODE){if(Utils.isBlank(A.data)){for(var z=0;z<e.length;z++){u.historyInitQuicklySelect(A.data[e[z]],e[z],w)}}}else{$.paError(A.errorMessage)}}).fail(function(z){$.paError("请求异常",null)}).always(function(){})},historyInitQuicklySelect:function(x,e,w){var u=this;var v={idKey:"dictId",txtKey:"dictName",isNeedDel:[true,function(z){var y={msg:"确认删除此常用语？",cancelTxt:"取消",saveTxt:"确定",showMaxNum:4,onYes:function(){u.historyDeleteItem(z,e)}};$.paConfirm(y)}],isNeedSave:[true,function(y){u.historyInsertItem(y,e)}]};$("#"+e).setInputDrop(x,v,function(y){});if(Utils.isBlank(w)){$("#"+w).focus()}},historyDeleteItem:function(y,e){var u=this;if(y.dictType=="allergiesHistory"){y.dictType="allergy_history"}else{y.dictType="ill_history"}var x=y;var v={type:"POST",contentType:"application/json; charset=utf-8",url:ContextClinc_Server+"mdcDataDict/deleteDataDict",data:JSON.stringify(x),dataType:"json",showMask:true};var w=Utils.myAjaxHandler(v);w.done(function(z){if(z.errorCode==SUCCESSCODE){$.paSuccess("删除成功！");u.historyQueryData(["allergiesHistory","familyHistory","pastHistory","personalHistory","historyOfPreventiveIno"],e)}else{$.paError(z.errorMessage)}}).fail(function(z){$.paError("请求异常",null)}).always(function(){})},historyInsertItem:function(u,e){var z=this;var u=u;var w=$.trim(u.dictName);if(!w){$.paWarn("添加内容不能为空!")}else{if(Utils.isBlank(e)){u.dictType=e;if(u.dictType=="allergiesHistory"){u.dictType="allergy_history"}else{u.dictType="ill_history"}var y=$("#"+e).parent().find(".input_drop_data li");var x=false;if(y.length>=99){$.paWarn("常用语数量达到最大数量限制！");return}y.each(function(){var C=$.trim($(this).data("tempData").dictName);if(w==C){x=true;return false}});if(x){$.paWarn("该常用语已存在！");return}}u.dictName=w;var v=u;var B={type:"POST",contentType:"application/json; charset=utf-8",url:ContextClinc_Server+"mdcDataDict/insertDataDict",data:JSON.stringify(v),dataType:"json",showMask:true};var A=Utils.myAjaxHandler(B);A.done(function(C){if(C.errorCode==SUCCESSCODE){$.paSuccess("添加成功！");z.historyQueryData(["allergiesHistory","familyHistory","pastHistory","personalHistory","historyOfPreventiveIno"],e)}else{$.paError(C.errorMessage)}}).fail(function(C){$.paError("请求异常",null)}).always(function(){})}}},getDoctorAdviceQuoteList:function(u){if(Utils.isBlank(acographyId)){var e={url:ContextClinc_Server+"docWorkSta/getDoctorAdviceQuoteList",dataType:"json",data:{acographyId:acographyId},showMask:true};var v=Utils.myAjaxHandler(e);v.done(function(w){if(w!=null&&w.errorCode==SUCCESSCODE){var B=w.data.combDwsTreatmentList;var z=w.data.dwsAssistCheckList;var A=w.data.dwsLaboratoryCheckList;var y=w.data.dwsRecipeList;var C="";if(Utils.isBlank(y)){C+=y}if(Utils.isBlank(B)){C+=B}if(Utils.isBlank(z)){C+=z}if(Utils.isBlank(A)){C+=A}if(Utils.isBlank(C)){$("#doctorAdvice").val(C)}else{$.paAlert("无处方信息引用")}var x=document.getElementById("doctorAdvice").scrollHeight;if(x>u){$(".icon-voice").last().css({width:"20px",right:"50px"})}}}).fail(function(w){}).always(function(){})}}};var f=new l();var c=new o();var r=new h();r._init()});