var userInfo_aclc=config_cache.getCache("medical_user_data");var acographyId=Utils.getQueryString("acographyId");var empiId=Utils.getQueryString("empiId");var clinic_print_model=Class.create({printRecordsFacade:function(a,b){wjPrintUtils.getPrintSetting(wjPrintUtils.printFunction.medicalRecord,function(d,c){if(d==1){print_model.records(a,b,c)}else{if(d==2){print_model.customPrint(a,b,c)}else{$.paWarn("请先配置打印参数！")}}})},customPrint:function(n,b,a,h){var i={acographyId:n,empiId:b};var d={url:ContextClinc_Server+"docWorkSta/selectMedicalRecord",dataType:"json",type:"POST",data:i,async:false};var m=print_model.getData(d).dwsMedicalRecord;if(m==null||m.length==0){$.paWarn("无门诊病历记录");return}if(reviewFlag==true){reviewFlag=false;$.paSuccess("生成预览...")}else{$.paSuccess("正在打印...")}var r=print_model.selectCnMecPatientAndDocInfo(n,b);var f={};f.medicalRecordInfo={};f.medicalRecordInfo.ACOGRAPHY_SERIAL_NO=r.ACOGRAPHY_SERIAL_NO;f.medicalRecordInfo.clinicName=userInfo_aclc.clinicName;if(h){var l=print_model.getYbInFo(n);var q="";if(Utils.isBlank(l)){q=l.ybInsuranceNo}f.medicalRecordInfo.medicareCardNumber=q}else{f.medicalRecordInfo.medicareCardNumber=r.INSURANCE_NO}f.medicalRecordInfo.PATIENT_NAME=r.PATIENT_NAME;var k="";if(r.PATIENT_GENDER==1){k="男"}if(r.PATIENT_GENDER==2){k="女"}if(r.PATIENT_GENDER==3){k="保密"}f.medicalRecordInfo.PATIENT_GENDER=k;f.medicalRecordInfo.PATIENT_BIRTH_DATE=Utils.getPersonAccurateAge(r.PATIENT_BIRTH_DATE);f.medicalRecordInfo.DEPARTMENT_NAME=r.DEPARTMENT_NAME;f.medicalRecordInfo.CHARGE_TYPE="--";var e=r.PATIENT_NO;if(null==e||"null"==e||""==e){e=""}else{e=e.substr(0,18)}f.medicalRecordInfo.patient_no=e;var j=r.LIVING_ADDRESS_COUNTRYSIDE;if(null==j||"null"==j||""==j){j="-"}var p;if(null==r.MOBILE_PHONE_NUMBER||"null"==r.MOBILE_PHONE_NUMBER||""==r.MOBILE_PHONE_NUMBER){p=j+"/-"}else{p=j+"/"+r.MOBILE_PHONE_NUMBER}if(null!=r.MOBILE_PHONE_NUMBER&&print_model.getStrLength(p)>106){var c=print_model.getStrLength("/"+r.MOBILE_PHONE_NUMBER);p=print_model.cutStr(j,106-c)+"/"+r.MOBILE_PHONE_NUMBER}f.medicalRecordInfo.addressPhone=p;var g=r.DiagnosisList;if(null==g||"null"==g||""==g){g=""}f.medicalRecordInfo.diagnosisList=g;f.medicalRecordInfo.MODIFY_DATE=Utils.timeStampToDateStr(r.MODIFY_DATE,4);f.medicalRecordInfo.chiefComplaint=(m.chiefComplaint==null||m.chiefComplaint==""?"--":m.chiefComplaint);f.medicalRecordInfo.allergiesHistory=m.allergiesHistory;if(!k){if(m.mensesHistory!=null&&m.mensesHistory!=""){f.medicalRecordInfo.mensesHistory=m.mensesHistory}if(m.procreateHistory!=null&&m.procreateHistory!=""){f.medicalRecordInfo.procreateHistory=m.procreateHistory}if(m.operationHistory!=null&&m.operationHistory!=""){f.medicalRecordInfo.operationHistory=m.operationHistory}}else{f.medicalRecordInfo.mensesHistory=null;f.medicalRecordInfo.procreateHistory=null;f.medicalRecordInfo.operationHistory=null}f.medicalRecordInfo.pastHistory=(m.pastHistory==null||m.pastHistory.length==0?"无":m.pastHistory);f.medicalRecordInfo.historyOfPresentIllness=(m.historyOfPresentIllness==null||m.historyOfPresentIllness.length==0?"无":m.historyOfPresentIllness);f.medicalRecordInfo.personalHistory=(m.personalHistory==null||m.personalHistory.length==0?"无":m.personalHistory);f.medicalRecordInfo.historyOfPreventiveIno=(m.historyOfPreventiveIno==null||m.historyOfPreventiveIno.length==0?"无":m.historyOfPreventiveIno);f.medicalRecordInfo.familyHistory=(m.familyHistory==null||m.familyHistory.length==0?"无":m.familyHistory);var o="";if(Utils.isBlank(m.temperature)){o+="体温"+m.temperature+"°C  "}if(Utils.isBlank(m.bloodPressureMin)&&Utils.isBlank(m.bloodPressureMax)){o+="血压"+m.bloodPressureMax+"/"+m.bloodPressureMin+"mm Hg  "}if(Utils.isBlank(m.heartRate)){o+="脉搏"+m.heartRate+"bpm  "}if(Utils.isBlank(m.breathRate)){o+="呼吸"+m.breathRate+"次/分  "}if(Utils.isBlank(m.otherPhysicalExamination)){o+=m.otherPhysicalExamination}f.medicalRecordInfo.tgStr=(o==null||o.length==0?"无":o);f.medicalRecordInfo.doctorAdvice=(m.doctorAdvice==null||m.doctorAdvice.length==0?"无":m.doctorAdvice);f.medicalRecordInfo.supportCheck="无";f.medicalRecordInfo.userName=userInfo_aclc.userName;wjPrintUtils.print(a,f,function(s){if(s.code!=SUCCESSCODE){$.paWarn(s.message)}})},medicalRecordHead:function(n,b,s){if(!n){n=acographyId}var t=print_model.selectCnMecPatientAndDocInfo(n,b);var o=print_model.getDwsDrListByAcographyId(n);var d="";var a="";var h=false;var m="诊断：";var e=42;if(Utils.notBlank(o)){var p=o.dwsList;var g=o.denList;if(Utils.notBlank(p)){for(var q=0;q<p.length;q++){if(q==0){if(Utils.notBlank(p[q]["diagnosis"])){d+=p[q]["diagnosis"]+";"}else{d+=p[q]["diagnosisIcd10"]+";"}}else{h=true;m="主诊断：";e=53;if(Utils.notBlank(p[q]["diagnosis"])){a+=p[q]["diagnosis"]+";"}else{a+=p[q]["diagnosisIcd10"]+";"}}}}if(Utils.notBlank(g)){for(var q=0;q<g.length;q++){if(q==0){if(Utils.notBlank(g[q]["diagnosis"])){d+=g[q]["diagnosis"]+";"}else{d+=g[q]["diagnosisIcd10"]+";"}}else{h=true;m="主诊断：";e=53;if(Utils.notBlank(g[q]["diagnosis"])){a+=g[q]["diagnosis"]+";"}else{a+=g[q]["diagnosisIcd10"]+";"}}}}}LODOP.ADD_PRINT_TEXT(7,5,32,25,"NO.");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(7,38,120,25,t.ACOGRAPHY_SERIAL_NO);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#FF0000");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(7,464,40,25,"普通");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.ADD_PRINT_TEXT(7,500,40,25,"#/&");LODOP.SET_PRINT_STYLEA(0,"ItemType",2);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.ADD_PRINT_TEXT(23,0,543,31,userInfo_aclc.clinicName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",15);LODOP.SET_PRINT_STYLEA(0,"FontColor","#242F44");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(54,0,546,31,"门诊病历");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",15);LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.SET_PRINT_STYLEA(0,"ItemType",4);LODOP.ADD_PRINT_TEXT(79,7,111,20,"医疗证/医保卡号：");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(79,116,127,20,s);LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");LODOP.ADD_PRINT_LINE(94,4,94,530,0,1);LODOP.ADD_PRINT_TEXT(100,7,60,25,"姓名：");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(100,43,108,25,t.PATIENT_NAME);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.ADD_PRINT_TEXT(100,150,60,25,"性别：");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.SET_PRINT_STYLEA(0,"Bold",1);var l="";if(t.PATIENT_GENDER==1){l="男"}if(t.PATIENT_GENDER==2){l="女"}if(t.PATIENT_GENDER==3){l="保密"}LODOP.ADD_PRINT_TEXT(100,185,40,25,l);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.ADD_PRINT_TEXT(100,220,60,25,"年龄：");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(100,255,90,25,Utils.getPersonAccurateAge(t.PATIENT_BIRTH_DATE));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.ADD_PRINT_TEXT(100,330,60,25,"科室：");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(100,365,90,25,t.DEPARTMENT_NAME);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.ADD_PRINT_TEXT(100,435,60,25,"费别：");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(100,470,80,25,(t.IS_YB_REG==1?t.MI_TYPE_NAME:"自费"));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.ADD_PRINT_TEXT(135,7,80,25,"病历号：");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.SET_PRINT_STYLEA(0,"Bold",1);var f=t.PATIENT_NO;if(null==f||"null"==f||""==f){f=""}else{f=f.substr(0,18)}LODOP.ADD_PRINT_TEXT(135,52,95,25,f);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.ADD_PRINT_TEXT(135,150,120,25,"住址/电话：");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.SET_PRINT_STYLEA(0,"Bold",1);var k=t.LIVING_ADDRESS_COUNTRYSIDE;if(null==k||"null"==k||""==k){k="-"}var j=t.MOBILE_PHONE_NUMBER;if(null==j||"null"==j||""==j){j="-"}var r=k+"/"+j;if(print_model.getStrLength(r)>100){var c=print_model.getStrLength("/"+j);r=print_model.cutStr(k,100-c)+"/"+j}LODOP.ADD_PRINT_TEXT(135,217,313,25,r);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.ADD_PRINT_TEXT(170,7,100,25,m);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(170,e,314,25,d||"-");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.ADD_PRINT_TEXT(170,379,100,25,"开具日期：");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(170,440,95,25,Utils.timeStampToDateStr(t.MODIFY_DATE,4));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);if(h){LODOP.ADD_PRINT_TEXT(200,7,100,25,"副诊断：");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(200,e,444,25,a||"-");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.ADD_PRINT_LINE(230,4,230,530,0,1)}else{LODOP.ADD_PRINT_LINE(198,4,198,530,0,1)}LODOP.ADD_PRINT_LINE(733,4,733,530,0,1);return{gender:t.PATIENT_GENDER,flag:h}},getDwsDrListByAcographyId:function(b){if(Utils.notBlank(b)){var a={url:ContextClinc_Server+"docWorkSta/getDwsDrListByAcographyId",dataType:"json",async:false,data:{acographyId:b}}}return print_model.getData(a)},records:function(r,c,a){LODOP=getLodop();if(!LODOP){return}var h={acographyId:r,empiId:c};var d={url:ContextClinc_Server+"docWorkSta/selectMedicalRecord",dataType:"json",type:"POST",data:h,async:false};var e=print_model.getData(d);var m=e.dwsMedicalRecord;var l=e.yb;var u="";if(Utils.isBlank(l)){u=l.ybInsuranceNo}if(m==null||m.length==0){$.paWarn("无门诊病历记录");return}var g=_.isNumber(a.rightOffset)?a.rightOffset:0;var f=_.isNumber(a.bottomOffset)?a.bottomOffset:0;LODOP.PRINT_INITA(f,g,530+g,763+f,"");LODOP.SET_PRINT_PAGESIZE(1,1480,2100,"");var j=print_model.medicalRecordHead(r,c,u);print_model.createRecordsFoot(e.dwsAcography.doctorName);var p=0;var k=203;if(j.flag){k=243}LODOP.ADD_PRINT_TEXT(k,10,505,510,"主诉："+(m.chiefComplaint==null||m.chiefComplaint==""?"无":m.chiefComplaint));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",10);var q=11;var s=print_model.getValidateArea(m);var b=[["historyOfPresentIllness","pastHistory","allergiesHistory","personalHistory","historyOfPreventiveIno","familyHistory","mensesHistory","procreateHistory","operationHistory","othersInfo","doctorAdvice"],["现病史 ：","既往病史 ：","过敏史 ：","个人史 ：","预防接种史 ：","家族史 ：","月经史 ：","生育史 ：","手术史 ：","其他 ：","处理意见 ：\n"]];for(var o=0;o<q;o++){var n=true;var t=m[b[0][o]];p+=(t==null)?0:t.length;if(o==9){p+=s.length}if(p>=500){LODOP.NEWPAGEA();print_model.medicalRecordHead(r,c,u);print_model.createRecordsFoot(e.dwsAcography.doctorName);n=false}else{n=true}if(b[0][o]==b[0][6]||b[0][o]==b[0][7]||b[0][o]==b[0][8]&&n){if(j.gender!=1){if(p<=500){if(t!=null){LODOP.ADD_PRINT_TEXT(15,0,505,510,(b[1][o])+((t==null)?"无":t));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",10);LODOP.SET_PRINT_STYLEA(0,"LinkedItem",-1)}}else{if(t!=null){p=0;LODOP.ADD_PRINT_TEXT(k,10,505,510,(b[1][o])+((t==null)?"无":t));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",10)}}}}else{if(n){if(b[0][o]!=b[0][3]&&b[0][o]!=b[0][4]&&b[0][o]!=b[0][5]&&b[0][o]!=b[0][9]){if(t!=null){LODOP.ADD_PRINT_TEXT(15,0,505,510,(b[1][o])+((t==null)?"无":t));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",10);LODOP.SET_PRINT_STYLEA(0,"LinkedItem",-1)}}else{if(t!=null){LODOP.ADD_PRINT_TEXT(15,0,505,510,(b[1][o])+((t==null)?"无":t));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",10);LODOP.SET_PRINT_STYLEA(0,"LinkedItem",-1)}}if(o==9){if(s){LODOP.ADD_PRINT_TEXT(15,0,505,510,"体格检查："+(s));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",10);LODOP.SET_PRINT_STYLEA(0,"LinkedItem",-1)}}}else{if(b[0][o]!=b[0][3]&&b[0][o]!=b[0][4]&&b[0][o]!=b[0][5]&&b[0][o]!=b[0][9]){p=0;LODOP.ADD_PRINT_TEXT(k,10,505,510,(b[1][o])+((t==null)?"无":t));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",10)}else{if(t!=null){p=0;LODOP.ADD_PRINT_TEXT(k,10,505,510,(b[1][o])+((t==null)?"无":t));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",10)}}if(o==9){if(s){LODOP.ADD_PRINT_TEXT(15,0,505,510,"体格检查："+(s));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",10);LODOP.SET_PRINT_STYLEA(0,"LinkedItem",-1)}}}}}operateType()},createRecordsFoot:function(a){LODOP.ADD_PRINT_LINE(733,4,733,530,0,1);LODOP.ADD_PRINT_TEXT(741,345,100,25,"签字医生：");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.SET_PRINT_STYLEA(0,"ItemType",4);LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.ADD_PRINT_TEXT(741,410,140,25,(a==null||a.length==0?userInfo_aclc.userName:a));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",1)},getValidateArea:function(a){var b="";if(Utils.isBlank(a.temperature)){b+="体温"+a.temperature+"°C  "}if(Utils.isBlank(a.bloodPressureMin)&&Utils.isBlank(a.bloodPressureMax)){b+="血压"+a.bloodPressureMax+"/"+a.bloodPressureMin+"mm Hg  "}if(Utils.isBlank(a.heartRate)){b+="脉搏"+a.heartRate+"bpm  "}if(Utils.isBlank(a.breathRate)){b+="呼吸"+a.breathRate+"次/分  "}if(Utils.isBlank(a.otherPhysicalExamination)){b+=a.otherPhysicalExamination}return b},getYbInFo:function(d){var b="";var c={ybBizRecord:{acographyId:d}};var a={type:"POST",url:ContextClinc_Server+"ybReimburse/getYBBizStateById",data:JSON.stringify(c),dataType:"json",contentType:"application/json; charset=utf-8",async:false,showMask:true};var e=Utils.myAjaxHandler(a);e.done(function(f){if(f!=null&&f.errorCode==SUCCESSCODE){b=f.data}}).fail(function(f){$.paAlert("获取用户信息失败!")}).always(function(){});return b},hisRecords:function(a){wjPrintUtils.getPrintSetting(wjPrintUtils.printFunction.medicalRecord,function(j,b){LODOP=getLodop();if(!LODOP){return}if(a==null||a.length==0){return}var n=print_model.getYbInFo(a.acographyId);var u="";if(Utils.isBlank(n)){u=n.ybInsuranceNo}var h=_.isNumber(b.rightOffset)?b.rightOffset:0;var g=_.isNumber(b.bottomOffset)?b.bottomOffset:0;LODOP.PRINT_INITA(g,h,530+h,763+g,"");LODOP.SET_PRINT_PAGESIZE(1,1480,2100,"");var k={acographyId:a.acographyId,empiId:a.empiId};var e={url:ContextClinc_Server+"docWorkSta/selectMedicalRecord",dataType:"json",type:"POST",data:k,async:false};var f=print_model.getData(e);var l=print_model.medicalRecordHead(acographyId,empiId,u);print_model.createRecordsFoot(f.dwsAcography.doctorName);var q=0;var m=203;if(l.flag){m=243}LODOP.ADD_PRINT_TEXT(m,10,505,510,"主诉："+(a.chiefComplaint==null||a.chiefComplaint==""?"无":a.chiefComplaint));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",10);var r=11;var s=print_model.getValidateArea(a);var c=[["historyOfPresentIllness","pastHistory","allergiesHistory","personalHistory","historyOfPreventiveIno","familyHistory","mensesHistory","procreateHistory","operationHistory","othersInfo","doctorAdvice"],["现病史 ：","既往病史 ：","过敏史 ：","个人史 ：","预防接种史 ：","家族史 ：","月经史 ：","生育史 ：","手术史 ：","其他 ：","处理意见 ：\n"]];var d=0;for(var p=0;p<r;p++){var o=true;var t=a[c[0][p]];q+=(t==null)?0:t.length;if(p==9){q+=s.length}if(q>=500){LODOP.NEWPAGEA();print_model.medicalRecordHead(acographyId,empiId,u);print_model.createRecordsFoot(f.dwsAcography.doctorName);o=false}else{o=true}if(c[0][p]==c[0][6]||c[0][p]==c[0][7]||c[0][p]==c[0][8]&&o){if(l.gender!=1){if(q<=500){if(t!=null){LODOP.ADD_PRINT_TEXT(15,0,505,510,(c[1][p])+((t==null)?"无":t));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",10);LODOP.SET_PRINT_STYLEA(0,"LinkedItem",-1)}}else{if(t!=null){q=0;LODOP.ADD_PRINT_TEXT(m,10,505,510,(c[1][p])+((t==null)?"无":t));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",10)}}}}else{if(o){if(c[0][p]!=c[0][3]&&c[0][p]!=c[0][4]&&c[0][p]!=c[0][5]&&c[0][p]!=c[0][9]){if(t!=null){LODOP.ADD_PRINT_TEXT(15,0,505,510,(c[1][p])+((t==null)?"无":t));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",10);LODOP.SET_PRINT_STYLEA(0,"LinkedItem",-1)}}else{if(t!=null){LODOP.ADD_PRINT_TEXT(15,0,505,510,(c[1][p])+((t==null)?"无":t));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",10);LODOP.SET_PRINT_STYLEA(0,"LinkedItem",-1)}}if(p==9){if(s){LODOP.ADD_PRINT_TEXT(15,0,505,510,"体格检查："+(s));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",10);LODOP.SET_PRINT_STYLEA(0,"LinkedItem",-1)}}}else{if(c[0][p]!=c[0][3]&&c[0][p]!=c[0][4]&&c[0][p]!=c[0][5]&&c[0][p]!=c[0][9]){q=0;LODOP.ADD_PRINT_TEXT(m,10,505,510,(c[1][p])+((t==null)?"无":t));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",10)}else{if(t!=null){q=0;LODOP.ADD_PRINT_TEXT(m,10,505,510,(c[1][p])+((t==null)?"无":t));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",10)}}if(p==9){if(s){LODOP.ADD_PRINT_TEXT(15,0,505,510,"体格检查："+(s));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",10);LODOP.SET_PRINT_STYLEA(0,"LinkedItem",-1)}}}}}operateType()})},examineFormPrint:function(c,b,a){wjPrintUtils.getPrintSetting(wjPrintUtils.printFunction.examineForm,function(e,d){if(e==1){print_model.examineForm(c,b,d,a)}else{if(e==2){print_model.examineFormCustomPrint(c,b,function(f){if(reviewFlag==true){reviewFlag=false;$.paSuccess("生成预览...")}else{$.paSuccess("正在打印...")}wjPrintUtils.printMore(d,f,"examine",function(g){if(g.code!=SUCCESSCODE){$.paWarn(g.message)}})})}else{$.paWarn("请先配置打印参数！")}}})},examineForm:function(a,d,l,g){var p=this;if(!a){a=acographyId}LODOP=getLodop();if(!LODOP){return}var r={url:ContextClinc_Server+"dwsAssistCheck/selectDwsAcByAcographyID",dataType:"json",type:"POST",data:{acographyid:a},async:false};var n=print_model.getData(r).dwsLaboratoryCheckList;var f=new Object();var c=print_model.getData(r).dwsAcography==null?f:print_model.getData(r).dwsAcography;if(n==null||n.length==0){return}var k=_.isNumber(l.rightOffset)?l.rightOffset:0;var j=_.isNumber(l.bottomOffset)?l.bottomOffset:0;LODOP.PRINT_INITA(j,k,530+k,763+j,"");LODOP.SET_PRINT_PAGESIZE(1,1480,2100,"");var q=print_model.createHead4Check(a,d);LODOP.ADD_PRINT_TEXT(8,10,543,31,userInfo_aclc.clinicName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",15);LODOP.SET_PRINT_STYLEA(0,"FontColor","#242F44");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(38,11,546,31,"检验单");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",15);LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.SET_PRINT_STYLEA(0,"ItemType",4);LODOP.ADD_PRINT_TEXT(q+8,10,q+13,25,"项目名称");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);if(g=="1"){LODOP.ADD_PRINT_TEXT(q+8,260,170,25,"标本");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1)}else{LODOP.ADD_PRINT_TEXT(q+8,260,85,25,"标本");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(q+8,421,85,25,"单价（元）");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1)}LODOP.ADD_PRINT_LINE(q+25,8,q+25,521,8,1);var o=q+34;var h=0;for(var e in n){if(e!=0){for(var b=8;b<=521;){LODOP.ADD_PRINT_LINE(o-15,b,o-15,b+3,0,1);b=b+5}}LODOP.ADD_PRINT_TEXT(o,10,250,10,n[e].ITEMNAME);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",8);if(g=="1"){LODOP.ADD_PRINT_TEXT(o,260,296,20,n[e].SAMPLES);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",8)}else{LODOP.ADD_PRINT_TEXT(o,260,196,20,n[e].SAMPLES);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",8);LODOP.ADD_PRINT_TEXT(o,421,100,20,n[e].PRICE);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",8)}o+=37;h+=n[e].PRICE}if(g!="1"){LODOP.ADD_PRINT_TEXT(712,345,140,25,"检验单总金额：");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.SET_PRINT_STYLEA(0,"ItemType",4);LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.ADD_PRINT_TEXT(712,430,100,20,p.toDecimal2(h)+" 元");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",8);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.SET_PRINT_STYLEA(0,"Alignment",1)}LODOP.ADD_PRINT_LINE(733,4,733,530,0,1);LODOP.ADD_PRINT_TEXT(741,7,100,25,"打印时间：");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.ADD_PRINT_TEXT(741,65,175,25,Utils.timeStampToDateStr(new Date().getTime(),9));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.ADD_PRINT_TEXT(741,345,80,25,"申请人：");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.SET_PRINT_STYLEA(0,"ItemType",4);LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.ADD_PRINT_TEXT(741,395,140,25,c.doctorName||"--");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);operateType()},examineFormCustomPrint:function(h,f,g){var d=this;if(!h){h=acographyId}var a={url:ContextClinc_Server+"dwsAssistCheck/selectDwsAcByAcographyID",dataType:"json",type:"POST",data:{acographyid:h},async:false};var c=print_model.getData(a).dwsLaboratoryCheckList;if(c==null||c.length==0){return}var e=print_model.selectCnMecPatientAndDocInfo(acographyId,f);var b={output:"css",bgColor:"#FFFFFF",color:"#000000",barWidth:2,barHeight:30,moduleSize:6,posX:10,posY:20,addQuietZone:false,fontSize:14};$("#tm_code").fadeIn(0).barcode(e.ACOGRAPHY_SERIAL_NO,"code128",b);html2canvas($("#tm_code"),{onrendered:function(k){var l=k.toDataURL("image/png");$("#tm_code").fadeOut(0);var p={};p.data={};p.data.info={};p.data.info.clinicName=userInfo_aclc.clinicName;p.data.info.patientName=e.PATIENT_NAME;var t="";if(e.PATIENT_GENDER==1){t="男"}if(e.PATIENT_GENDER==2){t="女"}if(e.PATIENT_GENDER==3){t="保密"}p.data.info.gender=t;p.data.info.age=Utils.getPersonAccurateAge(e.PATIENT_BIRTH_DATE);p.data.info.departmentName=e.DEPARTMENT_NAME;p.data.info.fadeName="--";p.data.info.printDate=Utils.timeStampToDateStr(new Date().getTime(),9);p.data.info.applyUser=userInfo_aclc.userName;p.data.info.code=l;var u=e.PATIENT_NO;if(null==u||"null"==u||""==u){u=""}else{u=u.substr(0,18)}p.data.info.patientNo=u;var n=e.LIVING_ADDRESS_COUNTRYSIDE;if(null==n||"null"==n||""==n){n="-"}var j="";if(null==e.MOBILE_PHONE_NUMBER||"null"==e.MOBILE_PHONE_NUMBER||""==e.MOBILE_PHONE_NUMBER){j=n+"/-"}else{j=n+"/"+e.MOBILE_PHONE_NUMBER}if(null!=e.MOBILE_PHONE_NUMBER&&print_model.getStrLength(j)>106){var s=print_model.getStrLength("/"+e.MOBILE_PHONE_NUMBER);j=print_model.cutStr(n,106-s)+"/"+e.MOBILE_PHONE_NUMBER}p.data.info.addressPhone=j;var m=e.DiagnosisList;if(null==m||"null"==m||""==m){m=""}p.data.info.diagnosisList=m;p.data.info.modifyDate=Utils.timeStampToDateStr(e.MODIFY_DATE,4);p.data.info.medicareCardNo="";p.data.item=new Array();var r=0;for(var o in c){var q={};q.itemName=c[o].ITEMNAME;q.samples=c[o].SAMPLES;q.price=c[o].PRICE;p.data.item.push(q);r+=c[o].PRICE}p.data.info.totalPrice=d.toDecimal2(r)+" 元";g(p)}})},inspectReportPrint:function(c,b,a){wjPrintUtils.getPrintSetting(wjPrintUtils.printFunction.inspectReport,function(e,d){if(e==1){print_model.inspectReport(c,b,d,a)}else{if(e==2){print_model.inspectReportCustomPrint(c,b,function(f){if(reviewFlag==true){reviewFlag=false;$.paSuccess("生成预览...")}else{$.paSuccess("正在打印...")}wjPrintUtils.printMore(d,f,"inspectRepor",function(g){if(g.code!=SUCCESSCODE){$.paWarn(g.message)}})})}else{$.paWarn("请先配置打印参数！")}}})},inspectReport:function(a,d,m,h){var p=this;if(!a){a=acographyId}LODOP=getLodop();if(!LODOP){return}var r={url:ContextClinc_Server+"dwsAssistCheck/selectDwsAcByAcographyID",dataType:"json",type:"POST",data:{acographyid:a},async:false};var g=new Object();var e=print_model.getData(r).dwsAcography==null?g:print_model.getData(r).dwsAcography;var k=print_model.getData(r).dwsAssistCheckList;if(k==null||k.length==0){return}var l=_.isNumber(m.rightOffset)?m.rightOffset:0;var j=_.isNumber(m.bottomOffset)?m.bottomOffset:0;LODOP.PRINT_INITA(j,l,530+l,763+j,"");LODOP.SET_PRINT_PAGESIZE(1,1480,2100,"");var q=print_model.createHead4Check(a,d);LODOP.ADD_PRINT_TEXT(8,10,543,31,userInfo_aclc.clinicName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",15);LODOP.SET_PRINT_STYLEA(0,"FontColor","#242F44");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(38,11,546,31,"检查单");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",15);LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.SET_PRINT_STYLEA(0,"ItemType",4);LODOP.ADD_PRINT_TEXT(q+13,7,510,60,"病历摘要："+($("#historyOfPresentIllness").val()==null||$("#historyOfPresentIllness").val().length==0?"无":$("#historyOfPresentIllness").val()));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.ADD_PRINT_LINE(q+80,10,q+80,535,0,1);LODOP.ADD_PRINT_TEXT(q+91,10,100,25,"项目名称");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(q+91,164,85,25,"部位");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);if(h=="1"){LODOP.ADD_PRINT_TEXT(q+91,252,200,25,"检查目的");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.SET_PRINT_STYLEA(0,"Alignment",1)}else{LODOP.ADD_PRINT_TEXT(q+91,252,100,25,"检查目的");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.ADD_PRINT_TEXT(q+91,435,100,25,"单价（元）");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1)}LODOP.ADD_PRINT_LINE(q+110,10,q+110,535,0,1);var o=q+125;var c=0;for(var f in k){if(f!=0){for(var b=10;b<=532;){LODOP.ADD_PRINT_LINE(o-14,b,o-14,b+3,0,1);b=b+5}}LODOP.ADD_PRINT_TEXT(o,10,154,20,k[f].ITEMNAME);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",8);if(k[f].PARTS.length>12){LODOP.ADD_PRINT_TEXT(o-8,164,92,35,k[f].PARTS);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",7);LODOP.SET_PRINT_STYLEA(0,"Alignment",1)}else{LODOP.ADD_PRINT_TEXT(o,164,92,20,k[f].PARTS);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",8);LODOP.SET_PRINT_STYLEA(0,"Alignment",1)}if(h=="1"){if(k[f].ILLSTAT!=null&&k[f].ILLSTAT.length>23){LODOP.ADD_PRINT_TEXT(o-8,252,280,35,k[f].ILLSTAT==null||k[f].ILLSTAT.length==0?"--":k[f].ILLSTAT);LODOP.SET_PRINT_STYLEA(0,"FontSize",7)}else{LODOP.ADD_PRINT_TEXT(o,252,280,20,k[f].ILLSTAT==null||k[f].ILLSTAT.length==0?"--":k[f].ILLSTAT);LODOP.SET_PRINT_STYLEA(0,"FontSize",8)}LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",1)}else{if(k[f].ILLSTAT!=null&&k[f].ILLSTAT.length>16){LODOP.ADD_PRINT_TEXT(o-8,252,190,35,k[f].ILLSTAT==null||k[f].ILLSTAT.length==0?"--":k[f].ILLSTAT);LODOP.SET_PRINT_STYLEA(0,"FontSize",7)}else{LODOP.ADD_PRINT_TEXT(o,252,190,20,k[f].ILLSTAT==null||k[f].ILLSTAT.length==0?"--":k[f].ILLSTAT);LODOP.SET_PRINT_STYLEA(0,"FontSize",8)}LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.ADD_PRINT_TEXT(o,437,170,20,k[f].PRICE);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",8)}o+=47;c+=k[f].PRICE}if(h!="1"){LODOP.ADD_PRINT_TEXT(712,345,140,25,"检查单总金额：");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.SET_PRINT_STYLEA(0,"ItemType",4);LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.ADD_PRINT_TEXT(712,430,100,20,p.toDecimal2(c)+" 元");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",8);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.SET_PRINT_STYLEA(0,"Alignment",1)}LODOP.ADD_PRINT_LINE(733,4,733,530,0,1);LODOP.ADD_PRINT_TEXT(741,7,100,25,"打印时间：");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.ADD_PRINT_TEXT(741,65,175,25,Utils.timeStampToDateStr(new Date().getTime(),9));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.ADD_PRINT_TEXT(741,345,80,25,"申请人：");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.SET_PRINT_STYLEA(0,"ItemType",4);LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.ADD_PRINT_TEXT(741,395,140,25,e.doctorName||"--");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);operateType()},inspectReportCustomPrint:function(h,f,g){var d=this;if(!h){h=acographyId}var a={url:ContextClinc_Server+"dwsAssistCheck/selectDwsAcByAcographyID",dataType:"json",type:"POST",data:{acographyid:h},async:false};var c=print_model.getData(a).dwsAssistCheckList;if(c==null||c.length==0){return}var e=print_model.selectCnMecPatientAndDocInfo(h,f);var b={output:"css",bgColor:"#FFFFFF",color:"#000000",barWidth:2,barHeight:30,moduleSize:6,posX:10,posY:20,addQuietZone:false,fontSize:14};$("#barCode").fadeIn(0).barcode(e.ACOGRAPHY_SERIAL_NO,"code128",b);html2canvas($("#barCode"),{onrendered:function(k){var m=k.toDataURL("image/png");$("#barCode").fadeOut(0);var q={};q.data={};q.data.info={};q.data.info.clinicName=userInfo_aclc.clinicName;q.data.info.patientName=e.PATIENT_NAME;var t="";if(e.PATIENT_GENDER==1){t="男"}if(e.PATIENT_GENDER==2){t="女"}if(e.PATIENT_GENDER==3){t="保密"}q.data.info.gender=t;q.data.info.age=Utils.getPersonAccurateAge(e.PATIENT_BIRTH_DATE);q.data.info.departmentName=e.DEPARTMENT_NAME;q.data.info.fadeName="--";q.data.info.printDate=Utils.timeStampToDateStr(new Date().getTime(),9);q.data.info.applyUser=userInfo_aclc.userName;q.data.info.code=m;q.data.info.historyOfPresentIllness=$("#historyOfPresentIllness").val()==null||$("#historyOfPresentIllness").val().length==0?"无":$("#historyOfPresentIllness").val();var u=e.PATIENT_NO;if(null==u||"null"==u||""==u){u=""}else{u=u.substr(0,18)}q.data.info.patientNo=u;var o=e.LIVING_ADDRESS_COUNTRYSIDE;if(null==o||"null"==o||""==o){o="-"}var j="";if(null==e.MOBILE_PHONE_NUMBER||"null"==e.MOBILE_PHONE_NUMBER||""==e.MOBILE_PHONE_NUMBER){j=o+"/-"}else{j=o+"/"+e.MOBILE_PHONE_NUMBER}if(null!=e.MOBILE_PHONE_NUMBER&&print_model.getStrLength(j)>106){var s=print_model.getStrLength("/"+e.MOBILE_PHONE_NUMBER);j=print_model.cutStr(o,106-s)+"/"+e.MOBILE_PHONE_NUMBER}q.data.info.addressPhone=j;var n=e.DiagnosisList;if(null==n||"null"==n||""==n){n=""}q.data.info.diagnosisList=n;q.data.info.modifyDate=Utils.timeStampToDateStr(e.MODIFY_DATE,4);q.data.info.medicareCardNo="";q.data.item=new Array();var l=0;for(var p in c){var r={};r.itemName=c[p].ITEMNAME;r.parts=c[p].PARTS;r.price=c[p].PRICE;l+=c[p].PRICE;if(c[p].ILLSTAT!=null&&c[p].ILLSTAT.length>19){r.illstat=c[p].ILLSTAT==null||c[p].ILLSTAT.length==0?"--":c[p].ILLSTAT}else{r.illstat=c[p].ILLSTAT==null||c[p].ILLSTAT.length==0?"--":c[p].ILLSTAT}q.data.item.push(r)}q.data.info.totalPrice=d.toDecimal2(l)+" 元";g(q)}})},printLabReportPic:function(d,c){var a=new Array();for(var b=0;b<d.length;b++){a[a.length]=d[b].picUrl}LODOP=getLodop();if(!LODOP){return}LODOP.PRINT_INITA(0,0,0,0,"");LODOP.SET_PRINT_PAGESIZE(1,2960,4200,"");LODOP.SET_PRINT_MODE("PRINT_PAGE_PERCENT","Auto-Width");for(var b=0;b<d.length;b++){LODOP.ADD_PRINT_URL(0,0,2960,4200,d[b].picUrl);if(b!=d.length-1){LODOP.NewPage()}}if(c){LODOP.PRINT()}else{LODOP.PREVIEW()}},selectCnMecPatientAndDocInfo:function(e,d){var c={acographyId:e,empiId:d};var a={url:ContextClinc_Server+"dwsCnMedical/selectCnMecPatientAndDocInfo",dataType:"json",type:"POST",data:c,async:false};var b=print_model.getData(a);return b},createHead:function(a,e){if(!a){a=acographyId}var f=print_model.selectCnMecPatientAndDocInfo(a,e);LODOP.ADD_PRINT_TEXT(7,5,32,25,"NO.");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(7,38,120,25,f.ACOGRAPHY_SERIAL_NO);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#FF0000");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(7,464,35,25,"普通");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.ADD_PRINT_TEXT(7,500,35,25,"#/&");LODOP.SET_PRINT_STYLEA(0,"ItemType",2);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.ADD_PRINT_TEXT(105,7,34,25,"姓名 ");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(105,150,40,25,"性别");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(105,229,35,25,"年龄");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(105,332,35,25,"科室");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(105,445,40,25,"费别");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(135,8,45,25,"病历号");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(135,160,66,25,"住址/电话");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(170,8,70,25,"临床诊断");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(170,384,60,25,"开具日期");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(105,40,108,25,f.PATIENT_NAME);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);var h="";if(f.PATIENT_GENDER==1){h="男"}if(f.PATIENT_GENDER==2){h="女"}if(f.PATIENT_GENDER==3){h="保密"}LODOP.ADD_PRINT_TEXT(105,190,36,25,h);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.ADD_PRINT_TEXT(105,264,70,25,Utils.getPersonAccurateAge(f.PATIENT_BIRTH_DATE));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.ADD_PRINT_TEXT(105,366,81,25,f.DEPARTMENT_NAME||"-");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");LODOP.ADD_PRINT_TEXT(105,485,44,25,f.PAYMENT_TYPE_NAME||"-");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");var i=f.PATIENT_NO;if(null==i||"null"==i||""==i){i=""}else{i=i.substr(0,18)}LODOP.ADD_PRINT_TEXT(135,47,119,25,i);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);var d=f.LIVING_ADDRESS_COUNTRYSIDE;if(null==d||"null"==d||""==d){d="-"}var b=d+"/"+f.MOBILE_PHONE_NUMBER;if(null!=f.MOBILE_PHONE_NUMBER&&print_model.getStrLength(b)>106){var g=print_model.getStrLength("/"+f.MOBILE_PHONE_NUMBER);b=print_model.cutStr(d,106-g)+"/"+f.MOBILE_PHONE_NUMBER}if(f.MOBILE_PHONE_NUMBER==null){b=d+"/-"}LODOP.ADD_PRINT_TEXT(135,226,333,25,b);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");var c=f.DiagnosisList;if(null==c||"null"==c||""==c){c=""}LODOP.ADD_PRINT_TEXT(170,69,314,25,c||"-");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");LODOP.ADD_PRINT_TEXT(170,440,95,25,Utils.timeStampToDateStr(f.MODIFY_DATE,4));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.ADD_PRINT_LINE(94,4,94,530,0,1);LODOP.ADD_PRINT_LINE(127,4,127,530,0,0);LODOP.ADD_PRINT_LINE(166,4,166,530,0,0);LODOP.ADD_PRINT_LINE(198,4,198,530,0,1);LODOP.ADD_PRINT_LINE(733,4,733,530,0,3)},createHead4Check:function(o,b){if(!o){o=acographyId}var t=print_model.selectCnMecPatientAndDocInfo(o,b);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",16);LODOP.SET_PRINT_STYLEA(0,"FontColor","#242F44");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.ADD_PRINT_BARCODE(37,8,167,23,"128A",t.ACOGRAPHY_SERIAL_NO);LODOP.SET_PRINT_STYLEA(0,"FontSize",4);var p=print_model.getDwsDrListByAcographyId(o);var d="";var a="";if(Utils.notBlank(p)){var q=p.dwsList;var h=p.denList;if(Utils.notBlank(q)){for(var r=0;r<q.length;r++){if(r==0){if(Utils.notBlank(q[r]["diagnosis"])){d+=q[r]["diagnosis"]+";"}else{d+=q[r]["diagnosisIcd10"]+";"}}else{if(Utils.notBlank(q[r]["diagnosis"])){a+=q[r]["diagnosis"]+";"}else{a+=q[r]["diagnosisIcd10"]+";"}}}}if(Utils.notBlank(h)){for(var r=0;r<h.length;r++){if(r==0){if(Utils.notBlank(h[r]["diagnosis"])){d+=h[r]["diagnosis"]+";"}else{d+=h[r]["diagnosisIcd10"]+";"}}else{if(Utils.notBlank(h[r]["diagnosis"])){a+=h[r]["diagnosis"]+";"}else{a+=h[r]["diagnosisIcd10"]+";"}}}}}LODOP.ADD_PRINT_TEXT(77,7,162,20,"医疗证/医保卡号：");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(77,114,330,20,t.IS_YB_REG==1?(t.INSURANCE_NO||"-"):"-");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.ADD_PRINT_LINE(94,4,94,530,0,1);LODOP.ADD_PRINT_TEXT(100,7,60,25,"姓名：");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(100,43,108,25,t.PATIENT_NAME);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.ADD_PRINT_TEXT(100,150,60,25,"性别：");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.SET_PRINT_STYLEA(0,"Bold",1);var n="";if(t.PATIENT_GENDER==1){n="男"}if(t.PATIENT_GENDER==2){n="女"}if(t.PATIENT_GENDER==3){n="保密"}LODOP.ADD_PRINT_TEXT(100,185,40,25,n);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.ADD_PRINT_TEXT(100,220,60,25,"年龄：");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(100,255,90,25,Utils.getPersonAccurateAge(t.PATIENT_BIRTH_DATE));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.ADD_PRINT_TEXT(100,330,60,25,"科室：");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(100,365,90,25,t.DEPARTMENT_NAME);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.ADD_PRINT_TEXT(100,435,60,25,"费别：");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(100,470,80,25,(t.IS_YB_REG==1?t.MI_TYPE_NAME:"自费"));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.ADD_PRINT_TEXT(135,7,80,25,"病历号：");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.SET_PRINT_STYLEA(0,"Bold",1);var e=t.PATIENT_NO;if(null==e||"null"==e||""==e){e=""}else{e=e.substr(0,18)}LODOP.ADD_PRINT_TEXT(135,52,95,25,e);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.ADD_PRINT_TEXT(135,150,120,25,"住址/电话：");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.SET_PRINT_STYLEA(0,"Bold",1);var m=t.LIVING_ADDRESS_COUNTRYSIDE;if(null==m||"null"==m||""==m){m="-"}var k=t.MOBILE_PHONE_NUMBER;if(null==k||"null"==k||""==k){k="-"}var s=m+"/"+k;if(print_model.getStrLength(s)>100){var c=print_model.getStrLength("/"+k);s=print_model.cutStr(m,100-c)+"/"+k}LODOP.ADD_PRINT_TEXT(135,217,313,25,s);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.ADD_PRINT_TEXT(170,379,100,25,"开具日期：");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(170,440,95,25,Utils.timeStampToDateStr(t.MODIFY_DATE,4));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);var g=0;var j=0;if(q!=null&&q!=undefined){g=q.length}if(h!=null&&h!=undefined){j=h.length}if((g<=1)&&(j<=1)){LODOP.ADD_PRINT_TEXT(170,7,100,25,"诊断：");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.SET_PRINT_STYLEA(0,"Bold",1);var l=d;if(null==l||"null"==l||""==l){l=""}LODOP.ADD_PRINT_TEXT(170,41,314,25,l);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.ADD_PRINT_LINE(197,4,197,530,0,1);LODOP.ADD_PRINT_LINE(733,4,733,530,0,1);return 200}LODOP.ADD_PRINT_TEXT(170,7,100,25,"主诊断：");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.SET_PRINT_STYLEA(0,"Bold",1);var l=d;if(null==l||"null"==l||""==l){l=""}LODOP.ADD_PRINT_TEXT(170,52,314,25,l);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.ADD_PRINT_TEXT(205,7,100,25,"副诊断：");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.SET_PRINT_STYLEA(0,"Bold",1);var f=a;if(null==f||"null"==f||""==f){f=""}LODOP.ADD_PRINT_TEXT(205,52,530,25,f);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");LODOP.SET_PRINT_STYLEA(0,"Alignment",1);LODOP.ADD_PRINT_LINE(233,4,233,530,0,1);LODOP.ADD_PRINT_LINE(733,4,733,530,0,1);return 236},getStrLength:function(b){var a=b.match(/[^\x00-\xff]/ig);return b.length+(a==null?0:a.length)},cutStr:function(d,a){if(!d){return""}if(a<=0){return""}var c=0;for(var b=0;b<d.length;b++){if(d.charCodeAt(b)>255){c+=2}else{c++}if(c==a){return d.substring(0,b-2)}else{if(c>a){return d.substring(0,b-2)}}}return d},getData:function(a){var b="";var c=Utils.myAjaxHandler(a);c.done(function(d){if(d!=null&&d.errorCode==SUCCESSCODE){b=d.data}else{$.paAlert(d.errorMessage)}}).fail(function(d){$.paAlert("获取用户信息失败!")}).always(function(){});return b},toDecimal2:function(a){var d=parseFloat(a);if(isNaN(d)||d<0){return"0.00"}var d=Math.round(a*100)/100;var c=d.toString();var b=c.indexOf(".");if(b<0){b=c.length;c+="."}while(c.length<=b+2){c+="0"}return c}});var clinic_print_data=Class.create({getRecordData:function(){},getAcData:function(){var d=$("#table_ac").find("tr");if(treatmentState!=2){d.splice(d.length-1,1)}var c=[];var b=true;$.each(d,function(e){var a=$(d[e]).find("td");var h=a.find("._ac_tab_ip_part_id").val();var g=a.find("._ac_tab_ip_pro_id").val();if(h!=null&&g!=null&&h!=""&&g!=""){var f={assistExamRemark:a.find("._ac_tab_ip_illstat").val(),examName:a.find("._ac_tab_ip_pro").val(),positionName:a.find("._ac_tab_ip_part").val(),};c.push(f)}else{if($("#td_ac_pro_"+e).val()!=""&&$("#td_ac_part_"+e).val()!=""&&$("#td_ac_illstat_"+e).val()!=""&&$("#td_ac_pro_"+e).val()!=null&&$("#td_ac_part_"+e).val()!=null&&$("#td_ac_illstat_"+e).val()!=null){var f={assistExamRemark:$("#td_ac_illstat_"+e).val(),examName:$("#td_ac_pro_"+e).val(),positionName:$("#td_ac_part_"+e).val()};c.push(f)}else{b=false;return}}});if(b){return c}else{return false}},getLcData:function(){var c=$("#table_lc").find("tr");if(treatmentState!=2){c.splice(c.length-1,1)}var d=[];var a=true;$.each(c,function(e){var h=$(c[e]).find("td");var b=h.find("._lc_tab_ip_sample_id").val();var f=h.find("._lc_tab_ip_pro_id").val();if(b!=null&&f!=null&&b!=""&&f!=""){var g={labExamPrice:h.find("._lc_tab_ip_price").val(),examSampleName:h.find("._lc_tab_ip_sample").val(),examName:h.find("._lc_tab_ip_pro").val(),};d.push(g)}else{if($("#td_lc_price_"+e).val()!=""&&$("#td_lc_sample_"+e).val()!=""&&$("#td_lc_pro_"+e).val()!=""&&$("#td_lc_price_"+e).val()!=null&&$("#td_lc_sample_"+e).val()!=null&&$("#td_lc_pro_"+e).val()!=null){var g={labExamPrice:$("#td_lc_price_"+e).val(),examSampleName:$("#td_lc_sample_"+e).val(),examName:$("#td_lc_pro_"+e).val(),};d.push(g)}else{a=false;return}}});if(a){return d}else{return false}},getTreatData:function(){var d=$("#table_tp").find("tr");var c=[];if(treatmentState!=2){d.splice(d.length-1,1)}var b=true;$.each(d,function(f){var g=$(d[f]).find("td");var a=g.find("._tp_tab_ip_unit_id").val();var e=g.find("._tp_tab_ip_pro_id").val();if(a!=null&&e!=null&&a!=""&&e!=""){var h={treatmentRemark:g.find("._tp_tab_ip_remark").val(),treatmentName:g.find("._tp_tab_ip_pro").val(),frequencyName:g.find("._tp_tab_ip_unit").val(),treatmentQty:g.find("._tp_tab_ip_treatnum").val()};c.push(h)}else{if($("#td_tp_pro_"+f).val()!=""&&$("#td_tp_frequency_"+f).val()!=""&&$("#td_tp_treatnum_"+f).val()!=""&&$("#td_tp_remark_"+f).val()!=""&&$("#td_tp_pro_"+f).val()!=null&&$("#td_tp_frequency_"+f).val()!=null&&$("#td_tp_treatnum_"+f).val()!=null&&$("#td_tp_remark_"+f).val()!=null){var h={treatmentRemark:$("#td_tp_remark_"+f).val(),treatmentName:$("#td_tp_pro_"+f).val(),frequencyName:$("#td_tp_frequency_"+f).val(),treatmentQty:$("#td_tp_treatnum_"+f).val()};c.push(h)}else{b=false;return}}});if(b){return c}else{return false}},});var print_model=clinic_print_model;