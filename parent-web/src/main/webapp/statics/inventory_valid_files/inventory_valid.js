var inventorywarn=Utils.getQueryString("inventorywarn")!=null?Utils.getQueryString("inventorywarn"):"";var zeroselect=Utils.getQueryString("zeroselect")!=null?Utils.getQueryString("zeroselect"):"";zeroselect=zeroselect==""?"1":zeroselect;var inventoryType=Utils.getQueryString("inventoryType")!=null?Utils.getQueryString("inventoryType"):"";var searchText=Utils.getQueryString("searchText")!=null?Utils.getQueryString("searchText"):"";var currentPageNo=Utils.getQueryString("currentPage");currentPageNo=(currentPageNo==null?1:currentPageNo);$(function(){$("#valid_date_time").datetimepicker({lang:"ch",format:"Y-m-d",timepicker:false});var c=new Date();c.setMonth(c.getMonth()+3);var b=Utils.timeStampToDateStr(c,7);$("#valid_date_time").val(b);if(zeroselect&&zeroselect=="1"){$("#zeroselect").find("input").addClass("checked");$("#zeroselect").find("span").addClass("active")}var a=[{id:"0",txt:"已过期"},{id:"30",txt:"30天内过期"},{id:"90",txt:"90天内过期"},{id:"183",txt:"6个月内过期"},{id:"365",txt:"一年内过期"}];$("#valid_day").WJZSDropdown(a,{isNeedAll:false,isNeedClear:false},function(d,e){inventoryIndex.searchInventory()});$("#valid_day").SelectWJZSDropdownFirstItem();inventoryIndex.initClassify();inventoryIndex.searchInventory();$("#search_btn").on("click",function(d){inventoryIndex.searchInventory()});$("#search_text").on("keyup",function(d){if(d.which==13){inventoryIndex.searchInventory()}});$(".btn-cancel").on("click",function(){location.href="inventory_info.html?inventorywarn="+inventorywarn+"&zeroselect="+zeroselect+"&inventoryType="+inventoryType+"&searchText="+searchText+"&currentPage="+currentPageNo});$(".checkbox-box li").on("click",function(d){var e=$(this).find("span");e.hasClass("active")?e.removeClass("active"):e.addClass("active");inventoryIndex.searchInventory()})});var inventoryIndex={initClassify:function(){var c={};var a={method:"GET",contentType:"application/json; charset=utf-8",url:ContextClinc_Server+"mdcDictDrug/drugtypes",data:JSON.stringify(c),dataType:"json"};var b=Utils.myAjaxHandler(a);b.done(function(d){if(SUCCESSCODE==d.errorCode){inventoryIndex.setInventoryClassify(d.data)}else{$.paError(d.errorMessage,null)}}).fail(function(d){$.paError("请求异常",null)}).always(function(){})},setInventoryClassify:function(c){var b=[{drugTypeId:"all",drugTypeName:"全部"}];$.merge(b,c);var a={idKey:"drugTypeId",txtKey:"drugTypeName",isNeedClear:false};$("#drug_type").WJZSDropdown(b,a,function(d,e){inventoryIndex.searchInventory()})},getSearchKey:function(c){var a=(c==undefined||c==null)?1:c.currentPage;var b=$("#drug_type").attr("val");if("all"==b){b=""}if($("#zeroselect").find("span").hasClass("active")){zeroselect=1}else{zeroselect=0}var d={drugType:b,searchText:$("#search_text").val(),validDay:$.trim($("#valid_day").attr("val")),currentPage:a,zeroselect:zeroselect,pageSize:10};return d},searchInventory:function(b,d){var c=inventoryIndex.getSearchKey(b);var a=$.extend({},b,c);a.ajaxopts={showMask:true,url:ContextClinc_Server+"inventory/inventory_list",type:"POST"};a.callback=function(h){if(SUCCESSCODE==h.errorCode){var e=h.data.dataSource;var g="";for(var f=0;f<e.length;f++){g+=inventoryIndex.addInventoryListhtml(e[f])}$("#inventory_table").empty();$("#inventory_table").append(g)}else{$.paError(h.errorMessage,null)}};$("#my-page").generatePagination(a)},addInventoryListhtml:function(c){var b="";b+="<tr>";b+='<td width="8%">'+c.drugTypeName+"</td>";b+='<td width="15%">'+c.drugName+"</td>";b+='<td width="12%">'+c.drugPackageSpec+"</td>";b+='<td width="8%">'+(c.drugDoseName?c.drugDoseName:"--")+"</td>";b+='<td width="10%">'+this.changePrice(c.drugPurchasePrice)+"/"+c.drugRecipeUnitName+"</td>";b+='<td width="10%">'+c.drugStoreQty+c.drugStoreUnitName+"</td>";var d=c.batchNum!=null?c.batchNum:"";b+='<td width="10%">'+d+"</td>";b+='<td width="10%">'+Utils.timeStampToDateStr(c.validDate,7)+"</td>";var a=c.drugManufactorName!=null?c.drugManufactorName:"";b+="<td>"+a+"</td>";b+="</tr>";return b},changeLcTrBgr:function(b){var a=b.find("tr");var c=a.length;if(c>1){$.each(a,function(d){$(a[d]).removeClass("table-tr-bgc");if(d%2!=0){$(a[d]).addClass("table-tr-bgc")}})}},changePrice:function(a){return null!=a&&""!=a?(a+="",0==a.indexOf(".")&&(a="0"+a),(a.indexOf(".")<0||a.substring(a.indexOf(".")+1).length==0||a.substring(a.indexOf(".")+1).length==1)&&(a=parseFloat(a).toFixed(2)+""),a.substring(a.indexOf(".")+1).length>4&&(a=parseFloat(a).toFixed(4)+"")):a="0.00",a},};