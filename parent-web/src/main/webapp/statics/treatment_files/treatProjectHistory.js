var TreatProjectHistory=function(){this.quoteObj=$(" <span class='quote' title='引用'></span>")};TreatProjectHistory.prototype={init:function(b){var a=this;this.bindEvent();this.selectDwsHistoryTpByAcographyID(b,function(c){$(".historyRecord").empty();$.each(c,function(g,j){var d=a.newHistoryRecordItem();var k=j.dwsAcography;var h=j.treatmentItemList;d.data("treatmentItemList",h);d.find(".check-style").text(a.convertTreatmentType(k.treatmentType));d.find(".checkDate").text(new Date(k.addDate).Format("yyyy-MM-dd HH:mm:ss"));d.find(".doctorName").text(k.doctorName);if(j.clinicName==null){d.find(".branchOffice").hide()}else{d.find(".clinicName").text(j.clinicName)}var f=a.newHistoryRecordTable();$.each(h,function(e,i){var l=a.newTreatmentTr();l.find(".treatmentName").text(i.ITEMNAME||"--");l.find(".treatmentNum").text(i.TREATNUM);l.find(".treatmentRemark").text(i.TPREMARK||"--");l.find(".treatmentPrice").text(Utils.changePrice(i.TREATMENT_PRICE_MODIFY));l.find(".treatmentChargeStatus").html(_tpView.getStatusText(i.CHARGE_STATUS,i.ITEM_TYPE,i.IS_SEND,i.IS_EXECUTE));f.append(l)});d.find(".history-table-wrapper").append(f);d.attr("acographyId",k.acographyId);d.attr("listId",g);if(k.clinicId!=clinicID){d.find(".quote").hide()}$(".historyRecord").append(d)})})},initHistory:function(b){var a=this;this.selectDwsHistoryTpByAcographyID(b,function(c){$(".historyRecord").empty();$.each(c,function(g,j){var d=a.newHistoryRecordItem();var k=j.dwsAcography;var h=j.treatmentItemList;d.data("treatmentItemList",h);d.find(".check-style").text(a.convertTreatmentType(k.treatmentType));d.find(".checkDate").text(new Date(k.addDate).Format("yyyy-MM-dd HH:mm:ss"));d.find(".doctorName").text(k.doctorName);if(j.clinicName==null){d.find(".branchOffice").hide()}else{d.find(".clinicName").text(j.clinicName)}var f=a.newHistoryRecordTable();$.each(h,function(e,i){var l=a.newTreatmentTr();l.find(".treatmentName").text(i.ITEMNAME||"--");l.find(".treatmentNum").text(i.TREATNUM);l.find(".treatmentRemark").text(i.TPREMARK||"--");l.find(".treatmentPrice").text(Utils.changePrice(i.TREATMENT_PRICE_MODIFY));l.find(".treatmentChargeStatus").html(_tpView.getStatusText(i.CHARGE_STATUS,i.ITEM_TYPE,i.IS_SEND,i.IS_EXECUTE));f.append(l)});d.find(".history-table-wrapper").append(f);d.attr("acographyId",k.acographyId);d.attr("listId",g);if(k.clinicId!=clinicID){d.find(".quote").hide()}$(".historyRecord").append(d)})})},bindEvent:function(){var a=this;$(".historyRecord").off("click",".head-line");$(".historyRecord").on("click",".head-line",function(){if($(this).find("button").hasClass("expand")){$(this).find("button").removeClass("expand").addClass("collapse");$(this).siblings(".detail").show()}else{$(this).find("button").removeClass("collapse").addClass("expand");$(this).siblings(".detail").hide()}});$(".historyRecord").off("click",".quote");$(".historyRecord").on("click",".quote",function(){var b=$(this).parent(".history-top-btn").parent(".detail").parent(".history_record_item").attr("listId");a.selectDwsHistoryTpByAcographyID(acographyId,function(c){_tpView.fillTreamentItem(c[b].treatmentItemList);if(hidePrice==1){_tpView.hidePrice()}});a.initHistory(acographyId)});$(".historyRecord").off("click",".history_print");$(".historyRecord").on("click",".history_print",function(){var b=$(this).parent(".history-top-btn").parent(".detail").parent(".history_record_item").attr("acographyId");a.printHistoryTreatByAcographyId(b)})},printHistoryTreatByAcographyId:function(a){new TreatmentReportPrint().doPrintFacade(a,empiId)},convertTreatmentType:function(a){if(a===1||a==="1"||a==null){return"初诊"}else{if(a===2||a==="2"){return"复诊"}}return"未知"},quoteBtnShow:function(){this.quoteObj.show();$(".historyRecord").find(".quote").show()},quoteBtnHide:function(){this.quoteObj.hide();$(".historyRecord").find(".quote").hide()},newHistoryRecordItem:function(){var b="<div class='history_record_item'>						<div class='head-line history'>							<span class='check-style'></span>							就诊时间:<span class='checkDate'></span>							就诊医生:<span class='doctorName'></span>							<span class='branchOffice'>门店:<span class='clinicName'></span></span>							<button class='expand'>								<i></i>							</button>						</div>						<div class='detail' style='display: none'>						    <div class='history-top-btn'>                                <span class='print history_print' title='打印'></span>                            </div>							<div class='table-wrapper history-table-wrapper'>							</div>						</div>					</div>";var a=$(b);a.find(".history_print").after(this.quoteObj.clone());return a},newHistoryRecordTable:function(){var a="<table class='common-table full-width-table history-treatment-record'>					    <tr>                            <th width='40%'>项目名称</th>							<th>数量</th>                            <th>备注</th>							<th class='price_head'>单价</th>							<th>收费状态</th>                        </tr>					</table>";return $(a)},newTreatmentTr:function(){var a="<tr>                        <td class='treatmentName'></td>						<td class='treatmentNum'></td>                        <td class='treatmentRemark'></td>						<td class='price treatmentPrice'></td>						<td class='treatmentChargeStatus'></td>                    </tr>";return $(a)},selectDwsHistoryTpByAcographyID:function(d,f){var a=this;var c={};var b={url:TreatPro_url.treatPro_selectHistoryDwsTpByAcographyID,dataType:"json",data:{acographyID:d},async:true,showMask:true};var e=Utils.myAjaxHandler(b);e.done(function(g){if(g!=null&&g.errorCode==SUCCESSCODE){f&&f.call(a,g.data);if(hidePrice&&hidePrice==1){$(".price_head").hide();$(".price").hide()}}else{$.paError(g.errorMessage)}}).fail(function(g){$.paError("操作失败!")}).always(function(){});return c},};