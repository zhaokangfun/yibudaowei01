var gender={"1":"男","2":"女","3":"保密"};var genderList=["","男","女","保密"];var drugSourceData=[{id:0,name:"本院"},{id:1,name:"外购"},{id:2,name:"免费"}];var isPayData=[{id:0,name:"未收费"},{id:1,name:"已收费"},{id:2,name:"已退费"},{id:3,name:"部分退费"}];var userInfo_aclc=config_cache.getCache("medical_user_data");var acographyId=Utils.getQueryString("acographyId");var empiId=Utils.getQueryString("empiId");var westMed;var clinicParams=userInfo_aclc.clinicParams;var isShowAmount;var printMode=0;var extraHeight=0;var zgd=0;for(var index in clinicParams){if(clinicParams[index].parameterCode=="3013"){isShowAmount=clinicParams[index].parameterValue;break}}for(var index in clinicParams){if(clinicParams[index].parameterCode=="3025"){printMode=clinicParams[index].parameterValue;break}}function WMPrescriptionPrint(){}WMPrescriptionPrint.prototype={printWestRecipeFacade:function(a,d,e,b){var c=this;c.getRecipeByRecipeIdAction(a,function(f){if(!f){$.paWarn("处方信息为空！");return}else{westMed=f;wjPrintUtils.getPrintSetting(wjPrintUtils.printFunction.westRecipe,function(n,l){if(n==1){if(printMode==0){c.doPrint(f,d,e,l,b)}else{c.doPrintV2(f,d,e,l)}}else{if(n==2){if(reviewFlag==true){reviewFlag=false;$.paSuccess("生成预览...")}else{$.paSuccess("正在打印...")}var k=c.selectWestDocInfo(d,e);if(!k){$.paWarn("患者信息不存在");return}var g={};var h=k.secondaryDiagnosis?k.mainDiagnosis+";"+k.secondaryDiagnosis:k.mainDiagnosis;g.basicInfo={clinicName:userInfo_aclc.clinicName,ACOGRAPHY_SERIAL_NO:k.ACOGRAPHY_SERIAL_NO,insuranceNo:westMed.insuranceNo,PATIENT_NAME:k.PATIENT_NAME,PATIENT_GENDER:k.PATIENT_GENDER,PATIENT_BIRTH_DATE:Utils.getPersonAccurateAge(k.PATIENT_BIRTH_DATE),DEPARTMENT_NAME:k.DEPARTMENT_NAME,PATIENT_NO:k.PATIENT_NO,LIVING_ADDRESS_COUNTRYSIDE:k.LIVING_ADDRESS_COUNTRYSIDE,MOBILE_PHONE_NUMBER:k.MOBILE_PHONE_NUMBER,DiagnosisList:h,MODIFY_DATE:k.MODIFY_DATE,doctorName:westMed.doctorName,totalPrice:westMed.totalPrice};g.recipeWestList=westMed.recipeWestList;for(var j in g.recipeWestList){var m=g.recipeWestList[j];g.recipeWestList[j].drugDose=m.drugDose+m.drugUnitName;if(m.drugSource||m.drugSource=="0"){g.recipeWestList[j].drugSource=c.convertId2Name(m.drugSource)}g.recipeWestList[j].totalQty=m.totalQty+(m.recipeUnit||"");g.recipeWestList[j].totalDay=m.totalDay+"天";g.recipeWestList[j].drugUsageName="用法:"+m.drugUsageName;if(m.skinTest=="1"){g.recipeWestList[j].drugName+="[皮试]"}}wjPrintUtils.printMore(l,g,"WestRecipe",function(i){if(i.code!=SUCCESSCODE){$.paWarn(i.message)}})}else{$.paWarn("请先配置打印参数！")}}})}})},doPrint:function(e,v,b,a,m){var n=this;b=b;LODOP=getLodop();if(!LODOP){return}var i=_.isNumber(a.rightOffset)?a.rightOffset:0;var h=_.isNumber(a.bottomOffset)?a.bottomOffset:0;LODOP.SET_PRINT_PAGESIZE(1,1480,2100,"");extraHeight=0;n.createHead(v,b,e);var u=165+zgd;LODOP.ADD_PRINT_LINE(u,530,u,8,0,1);LODOP.ADD_PRINT_TEXT(u,10,100,35,"Rp.");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",18);LODOP.SET_PRINT_STYLEA(0,"Bold",1);u=u+35;n.medicienFooter(v,b,e);var z=new Array();for(var t=0;t<e.recipeWestList.length;t++){z.push(e.recipeWestList[t])}var w;var g=new Array();var d=true;for(var r=0;r<e.recipeWestList.length;r++){var q=false;var f=0;w=new Array();if(g.length>0){for(var o=0;o<g.length;o++){if(g[o]==e.recipeWestList[r].groupNum){q=true}}}if(q){continue}for(var t=0;t<z.length;t++){if(e.recipeWestList[r].groupNum==z[t].groupNum){if(!m){}w.push(z[t]);g.push(e.recipeWestList[r].groupNum);f++}}if(w.length>1){var c=u;for(var l=0;l<w.length;l++){if(u>650){LODOP.NEWPAGEA();c=252+extraHeight;extraHeight=0;n.createHead(v,b,e);u=165+zgd;LODOP.ADD_PRINT_LINE(u,530,u,8,0,1);LODOP.ADD_PRINT_TEXT(u,10,100,35,"Rp.");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",18);LODOP.SET_PRINT_STYLEA(0,"Bold",1);u=u+35;n.medicienFooter(v,b,e)}u+=10;LODOP.ADD_PRINT_TEXT(u,10,160,25,(l==0?w[l].groupNum+"、":"     ")+w[l].drugName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");if(w[l].skinTest==1){LODOP.ADD_PRINT_TEXT(u,160,105,25,"[皮试]");LODOP.SET_PRINT_STYLEA(0,"Bold",1)}else{LODOP.ADD_PRINT_TEXT(u,160,105,25," ");LODOP.SET_PRINT_STYLEA(0,"Bold",1)}LODOP.ADD_PRINT_TEXT(u,218,110,25,w[l].drugSpec);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(u,313,100,25,w[l].drugDose+" "+w[l].drugUnitName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(u,370,45,25,w[l].totalQty+w[l].recipeUnit);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(u,430,40,25,this.convertId2Name(w[l].drugSource));u+=33;d=true}LODOP.ADD_PRINT_TEXT(u,160,185,25,"用法："+w[0].drugUsageName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");if(w[0].dripSpeed){LODOP.ADD_PRINT_TEXT(u,243,80,25,w[0].dripSpeed+"滴/分");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑")}LODOP.ADD_PRINT_TEXT(u,380,40,25,w[0].totalDay+"天");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(u,420,100,25,w[0].remark||"");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");d=false}else{if(u>650){LODOP.NEWPAGEA();extraHeight=0;n.createHead(v,b,e);u=165+zgd;LODOP.ADD_PRINT_LINE(u,530,u,8,0,1);LODOP.ADD_PRINT_TEXT(u,10,100,35,"Rp.");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",18);LODOP.SET_PRINT_STYLEA(0,"Bold",1);u=u+35;n.medicienFooter(v,b,e)}u+=10;LODOP.ADD_PRINT_TEXT(u,10,160,25,w[0].groupNum+"、"+w[0].drugName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");if(w[0].skinTest==1){LODOP.ADD_PRINT_TEXT(u,160,105,25,"[皮试]");LODOP.SET_PRINT_STYLEA(0,"Bold",1)}else{LODOP.ADD_PRINT_TEXT(u,160,105,25," ");LODOP.SET_PRINT_STYLEA(0,"Bold",1)}LODOP.ADD_PRINT_TEXT(u,218,110,25,w[0].drugSpec);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(u,313,100,25,w[0].drugDose+" "+w[0].drugUnitName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(u,370,45,25,w[0].totalQty+w[0].recipeUnit);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(u,430,40,25,this.convertId2Name(w[0].drugSource));u+=33;LODOP.ADD_PRINT_TEXT(u,160,185,25,"用法："+w[0].drugUsageName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");if(w[0].dripSpeed){LODOP.ADD_PRINT_TEXT(u,243,80,25,w[0].dripSpeed+"滴/分");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑")}LODOP.ADD_PRINT_TEXT(u,380,40,25,w[0].totalDay+"天");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(u,420,100,25,w[0].remark||"");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑")}LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(u,323,55,25,w[0].frequencyRemark||this.createFrequencyName(w[0].frequencyName));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");u+=30}u+=10;LODOP.ADD_PRINT_TEXT(u,150,241,25,"(以下空白)");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);operateType()},doPrintV2:function(f,b,e,m){var n=this;e=e;LODOP=getLodop();if(!LODOP){return}var k=_.isNumber(m.rightOffset)?m.rightOffset:0;var i=_.isNumber(m.bottomOffset)?m.bottomOffset:0;LODOP.PRINT_INITA(i,k,530+k,763+i,"");LODOP.SET_PRINT_PAGESIZE(1,1480,2100,"");extraHeight=0;n.createHeadV2(b,e,f);n.medicienFooter(b,e,f);var c=new Array();for(var d=0;d<f.recipeWestList.length;d++){c.push(f.recipeWestList[d])}var g=252;var h;var a=new Array();var l=true;n.createBodyV2(b,e,f,f.recipeWestList);g+=10;operateType()},selectWestDocInfo:function(f,e){var a=this;var d={acographyId:f,empiId:e};var b={url:ContextClinc_Server+"dentistryRecipe/selectWestDocInfo",dataType:"json",type:"POST",data:d,async:false};var c=a.getData(b);return c},createFrequencyName:function(b){var a=b;if(b=="qd"){a="每天1次"}else{if(b=="bid"){a="每天2次"}else{if(b=="tid"){a="每天3次"}else{if(b=="qid"){a="每天4次"}else{if(b=="qod"){a="隔日1次"}else{if(b=="qw"){a="每周1次"}else{if(b=="prn"){a="必要时"}}}}}}}return a},convertId2Name:function(b){for(var a=0;a<drugSourceData.length;a++){if(drugSourceData[a].id==b){return drugSourceData[a].name}}return""},convertId3Name:function(b){for(var a=0;a<isPayData.length;a++){if(isPayData[a].id==b){return isPayData[a].name}}return""},createHead:function(q,c,j){var p=this;if(!q){q=acographyId}var b=p.selectWestDocInfo(q,c);if(!b){$.paWarn("患者信息不存在");return}LODOP.ADD_PRINT_TEXT(7,5,32,25,"NO.");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(7,38,120,25,b.ACOGRAPHY_SERIAL_NO);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#FF0000");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(7,459,35,25,"普通");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.ADD_PRINT_TEXT(7,495,35,25,"#/&");LODOP.SET_PRINT_STYLEA(0,"ItemType",2);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.ADD_PRINT_TEXT(28,10,543,31,userInfo_aclc.clinicName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",15);LODOP.SET_PRINT_STYLEA(0,"FontColor","#242F44");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(59,11,543,31,"西药处方");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",15);LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);var g=b.PATIENT_NO;if(null==g||"null"==g||""==g){g=""}else{g=g.substr(0,20)}var n=b.LIVING_ADDRESS_COUNTRYSIDE||"-";var v=n+"/"+b.MOBILE_PHONE_NUMBER;if(null!=b.MOBILE_PHONE_NUMBER&&p.getStrLength(v)>102){var e=p.getStrLength("/"+b.MOBILE_PHONE_NUMBER);v=p.cutStr(n,102-e)+"/"+b.MOBILE_PHONE_NUMBER}if(b.MOBILE_PHONE_NUMBER==null){v=n+"/-"}extraHeight+=this.calcHeight(v,341)-16;var a=b.mainDiagnosis||"-";var s=b.secondaryDiagnosis;var d=b.PATIENT_NAME;var l=b.allergiesHistory||"";var i="";var k="";if(s){k='<div style="margin-top:10px;width:500px;"><span style="">副诊断&nbsp;:&nbsp;</span><span style="color:blue;font-weight:normal;">'+s+"</span></div>"}else{k=""}var u="诊断";if(a&&s){u="主诊断"}else{u="诊断"}var h=0;if(g.length>10){h=this.calcHeight(g,90)}var t=b.MI_TYPE_NAME||"自费";var f=0;if(t.length>3){f=this.calcHeight(t,60)}var m=this.calcHeight(Utils.timeStampToDateStr(b.MODIFY_DATE,4),500);var w=this.calcHeight(a,500)+this.calcHeight(s,500);var o=this.calcHeight(l,500);zgd=parseFloat(m)+parseFloat(w)+parseFloat(o)+parseFloat(h)+parseFloat(f);if(!l){zgd+=20}if(g.length>10){zgd-=20}if(t.length>3){zgd-=10}var r=p.GetOSInfo();i='<style>							.print-head{								font-size:13px;								font-weight:bold;								font-family:微软雅黑;								max-width:523px;								vertical-align:text-top;							}							span{								vertical-align:text-top;								word-break:break-all;							}					  </style>					  <div class="print-head">						<div style="border-bottom:1px solid black;">							<span style="float:left;">医疗证/医保卡号&nbsp;:&nbsp;</span><span style="float:left;color:blue;font-weight:normal;">'+(j.isYbReg==1?(j.insuranceNo||"-"):"-")+'</span>							<span style="float:right;color:blue;font-weight:normal;margin-right:30px;">'+(j.recipeCode||"-")+'</span><span style="float:right;">处方单号&nbsp;:&nbsp;</span>						</div>						<div style="border-bottom:0px solid black;padding-bottom:0px;">							<div style="margin-top:5px;">								<span>姓名&nbsp;:&nbsp;</span><span style="color:blue;font-weight:normal;width:90px;">'+d+'</span>								<span style="margin-left:0px;">性别&nbsp;:&nbsp;</span><span style="color:blue;font-weight:normal;width:34px;">'+genderList[b.PATIENT_GENDER?b.PATIENT_GENDER:3]+'</span>								<span style="margin-left:0px;">年龄&nbsp;:&nbsp;</span><span style="color:blue;font-weight:normal;width:80px;">'+Utils.getPersonAccurateAge(b.PATIENT_BIRTH_DATE)+'</span>								<span style="margin-left:0px;">科室&nbsp;:&nbsp;</span><span style="color:blue;font-weight:normal;width:65px;">'+(b.DEPARTMENT_NAME||"-")+'</span>								<span style="margin-left:0px;">费别&nbsp;:&nbsp;</span><span style="color:blue;font-weight:normal;width:50px;">'+(b.MI_TYPE_NAME||"自费")+'</span>							</div>							<div style="margin-top:10px;">								<span>病历号&nbsp;:&nbsp;</span><span style="color:blue;font-weight:normal;width:110px;">'+g+'</span>								<span style="position:absolute;width:72px;left:167px;">住址/电话&nbsp;:&nbsp;</span>								<span style="position:absolute;color:blue;width:290px;left:236px;font-weight:normal;">'+v+'</span>							</div>							<div style="margin-top:10px;padding-right:15px;">								<span style="float:left;">'+u+'&nbsp;:&nbsp;</span><span style="float:left;color:blue;font-weight:normal;width:305px;">'+a+'</span>								<span style="float:left;">开具日期&nbsp;:&nbsp;</span><span style="float:left;color:blue;font-weight:normal;">'+Utils.timeStampToDateStr(b.MODIFY_DATE,4)+"</span>							</div>							"+k+'							<div style="margin-top:5px;width:500px;">								<span style="">过敏史&nbsp;:&nbsp;</span><span style="color:blue;font-weight:normal;">'+l+"</span>							</div>						</div>					  </div>";extraHeight+=zgd;LODOP.ADD_PRINT_HTM(80,7,530,300+zgd,i)},createHeadV2:function(v,d,m){var u=this;if(!v){v=acographyId}var c=u.selectWestDocInfo(v,d);if(!c){$.paWarn("患者信息不存在");return}LODOP.ADD_PRINT_TEXT(7,5,32,25,"NO.");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(7,38,120,25,c.ACOGRAPHY_SERIAL_NO);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#FF0000");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(7,459,35,25,"普通");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.ADD_PRINT_TEXT(7,495,35,25,"#/&");LODOP.SET_PRINT_STYLEA(0,"ItemType",2);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.ADD_PRINT_TEXT(28,10,543,31,userInfo_aclc.clinicName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",15);LODOP.SET_PRINT_STYLEA(0,"FontColor","#242F44");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(59,11,543,31,"西药处方");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",15);LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);var e=this.calcHeight(c.PATIENT_NAME,90/0.9);var n=this.calcHeight((c.DEPARTMENT_NAME||"-"),65/0.9);var b=this.calcHeight((c.MI_TYPE_NAME||"自费"),60/0.9);var q=e>n?e:n;console.log("line 1:",(q>b?q:b));extraHeight+=(q>b?q:b);var k=c.PATIENT_NO;if(null==k||"null"==k||""==k){k=""}else{k=k.substr(0,20)}var s=c.LIVING_ADDRESS_COUNTRYSIDE||"-";var A=s+"/"+c.MOBILE_PHONE_NUMBER;if(null!=c.MOBILE_PHONE_NUMBER&&u.getStrLength(A)>102){var g=u.getStrLength("/"+c.MOBILE_PHONE_NUMBER);A=u.cutStr(s,102-g)+"/"+c.MOBILE_PHONE_NUMBER}if(c.MOBILE_PHONE_NUMBER==null){A=s+"/-"}var B=this.calcHeight(k,110/0.9);var h=this.calcHeight(A,290/0.9);q=B>h?B:h;console.log("line 2:",q);extraHeight+=q+10;var a=c.mainDiagnosis||"-";var x=c.secondaryDiagnosis;console.log("line 3:",this.calcHeight(a,305/0.9));extraHeight+=this.calcHeight(a,305/0.9)+10;var f=c.PATIENT_NAME;var p=c.allergiesHistory||"-";var l="";var o="";if(x){o='<div style="display:block;clear:both;margin-top:10px;"><span style="">副诊断&nbsp;:&nbsp;</span><span style="width:466px;color:blue;font-weight:normal;">'+x+"</span></div>";console.log("line 4:",this.calcHeight(x,466/0.9));extraHeight+=this.calcHeight(x,466/0.9)+10}else{o=""}var z="诊断";if(a&&x){z="主诊断"}else{z="诊断"}var j=0;if(k.length>10){j=this.calcHeight(k,90)}var y=c.MI_TYPE_NAME||"自费";var i=0;if(y.length>3){i=this.calcHeight(y,60/0.9)}var r=this.calcHeight(Utils.timeStampToDateStr(c.MODIFY_DATE,4),500);var C=this.calcHeight(a,500)+this.calcHeight(x,500);var t=this.calcHeight(p,500);console.log("line 5:",this.calcHeight(p,466/0.9));extraHeight+=this.calcHeight(p,466/0.9)+10;zgd=parseFloat(r)+parseFloat(C)+parseFloat(t)+parseFloat(j)+parseFloat(i>n?i:n);if(!p){zgd+=20}if(k.length>10){zgd-=20}if(y.length>3){zgd-=10}var w=u.GetOSInfo();l='<style>							.print-head{								font-size:13px;								font-weight:bold;								font-family:微软雅黑;								max-width:523px;								vertical-align:text-top;							}							span{								vertical-align:text-top;								word-break:break-all;							}					  </style>					  <div class="print-head">						<div style="border-bottom:1px solid black;">							<span style="float:left;">医疗证/医保卡号&nbsp;:&nbsp;</span><span style="float:left;color:blue;font-weight:normal;">'+(m.isYbReg==1?(m.insuranceNo||"-"):"-")+'</span>							<span style="float:right;color:blue;font-weight:normal;margin-right:30px;">'+(m.recipeCode||"-")+'</span><span style="float:right;">处方单号&nbsp;:&nbsp;</span>						</div>						<div style="border-bottom:0px solid black;padding-bottom:0px;">							<div style="margin-top:5px;">								<span>姓名&nbsp;:&nbsp;</span><span style="color:blue;font-weight:normal;width:90px;">'+f+'</span>								<span style="margin-left:0px;">性别&nbsp;:&nbsp;</span><span style="color:blue;font-weight:normal;width:34px;">'+genderList[c.PATIENT_GENDER?c.PATIENT_GENDER:3]+'</span>								<span style="margin-left:0px;">年龄&nbsp;:&nbsp;</span><span style="color:blue;font-weight:normal;width:70px;">'+Utils.getPersonAccurateAge(c.PATIENT_BIRTH_DATE)+'</span>								<span style="margin-left:0px;">科室&nbsp;:&nbsp;</span><span style="color:blue;font-weight:normal;width:65px;">'+(c.DEPARTMENT_NAME||"-")+'</span>								<span style="margin-left:0px;">费别&nbsp;:&nbsp;</span><span style="color:blue;font-weight:normal;width:60px;">'+(c.MI_TYPE_NAME||"自费")+'</span>							</div>							<div style="margin-top:10px;">								<span style="float:left;">病历号&nbsp;:&nbsp;</span>								<span style="float:left;color:blue;font-weight:normal;width:110px;">'+k+'</span>								<span style="float:left;width:72px;">住址/电话&nbsp;:&nbsp;</span>								<span style="float:left;color:blue;width:290px;font-weight:normal;">'+A+'</span>							</div>							<div style="display:block;clear:both;margin-top:10px;padding-right:15px;">								<span style="float:left;">'+z+'&nbsp;:&nbsp;</span><span style="float:left;color:blue;font-weight:normal;width:305px;">'+a+'</span>								<span style="float:left;">开具日期&nbsp;:&nbsp;</span><span style="float:left;color:blue;font-weight:normal;">'+Utils.timeStampToDateStr(c.MODIFY_DATE,4)+"</span>							</div>							"+o+'							<div style="margin-top:5px;width:500px;">								<span style="">过敏史&nbsp;:&nbsp;</span><span style="color:blue;font-weight:normal;">'+p+"</span>							</div>						</div>					  </div>";extraHeight+=110;LODOP.ADD_PRINT_HTM(80,7,530,300+zgd,l)},createBody:function(n,b,f,r){var g=["YF09023","YF09024","YF09025","YF09005","YF09006","YF09019"];var l={};var j={};var q={};var i={};for(k=0;k<r.length;k++){if(l[r[k].groupNum]==undefined||l[r[k].groupNum]==null){l[r[k].groupNum]=0;i[r[k].groupNum]=0;q[r[k].groupNum]=r[k].remark}l[r[k].groupNum]+=1}var o="<style>							span{								font-size:13px;								font-family:微软雅黑;								vertical-align:text-top;								word-wrap:break-word;								border:0;								padding:0;							}							.group-num{								float:left;								margin:0;								margin-left:15px;								display:inline-block;								box-sizing:border-box;								-moz-box-sizing:border-box;								-webkit-box-sizing:border-box;								width:20px;							}							.drug-name{								width:156px;							}							.drug-spec{								width:160px;								padding-right:16px;								word-wrap:break-word;								position:absolute;								left:170px;							}							.drug-dose{								width:116px;								position:absolute;								left:332px;							}							.day-or-qty{								width:84px;							}							.dose{								position:absolute;								width:99px;								left:55px;							}							.usage{								position:absolute;								width:68px;								left:159px;							}							.frequency{								position:absolute;								width:80px;								left:230px;							}							.skin-test{								position:absolute;								width:40px;								left:295px;							}							.remark{								position:absolute;								left:340px;							}							.line{								position:relative;							}						</style>";var t='<div style="font-size:25px;font-weight:bold;">								Rp.						</div>';LODOP.ADD_PRINT_HTM(260+extraHeight,15,530,25,t);var a=294+extraHeight;var d=0;var p=22;for(var k=0;k<r.length;k++){var c=false;var e="";if(j[r[k].groupNum]==null){j[r[k].groupNum]=0;e=r[k].groupNum+"."}j[r[k].groupNum]++;if(j[r[k].groupNum]==l[r[k].groupNum]){c=true}var h='<div class="line">								<span class="group-num">'+e+'</span>								<span class="drug-name">'+r[k].drugName+((l[r[k].groupNum]!=1&&r[k].skinTest=="1")?"<b>(皮试)</b>":"")+'</span>								<span class="drug-spec">'+r[k].drugSpec+'</span>								<span class="drug-dose">'+(l[r[k].groupNum]==1&&$.inArray(r[k].drugUsageId,g)==-1?"":(r[k].drugDose+" "+r[k].drugUnitName))+"</span>							</div>";d=this.calcMaxHeight(r[k].drugName+((l[r[k].groupNum]!=1&&r[k].skinTest=="1")?"<b>(皮试)</b>":""),r[k].drugSpec);if(a+d>667){LODOP.NEWPAGEA();extraHeight=0;this.createHead(n,b,f);LODOP.ADD_PRINT_HTM(240+extraHeight,15,530,28,t);this.medicienFooter(n,b,f);a=294+extraHeight}LODOP.ADD_PRINT_HTM(a,35,530,d,o+h);i[r[k].groupNum]+=d;if($.inArray(r[k].drugUsageId,g)==-1){LODOP.ADD_PRINT_HTM(a,485,45,14,'<span style="font-size:13px;font-family:微软雅黑;">'+r[k].totalQty+r[k].recipeUnit+"</span>")}a+=d;if(c){if($.inArray(r[k].drugUsageId,g)!=-1){LODOP.ADD_PRINT_LINE(a-i[r[k].groupNum]+6,482,a-3,483,0,1);LODOP.ADD_PRINT_HTM(a-20,485,45,14,'<span style="font-size:13px;font-family:微软雅黑;">X&nbsp;'+r[k].totalDay+"天</span>")}var m="";if(l[r[k].groupNum]==1&&$.inArray(r[k].drugUsageId,g)==-1){m='<div class="line">											<span class="dose">用法&nbsp;:&nbsp;'+(r[k].drugDose+" "+r[k].drugUnitName)+'</span>											<span class="usage">'+r[k].drugUsageName+'</span>											<span class="frequency">'+(r[k].frequencyRemark||this.createFrequencyName(r[k].frequencyName))+'</span>											<span class="skin-test">'+((l[r[k].groupNum]==1&&r[k].skinTest=="1")?"<b>皮试</b>":"")+'</span>											<span class="remark">'+$.trim(q[r[k].groupNum])+"</span>									   </div>"}else{m='<div class="line">											<span class="usage" style="width:94px;left:55px;">用法&nbsp;:&nbsp;'+r[k].drugUsageName+'</span>											<span class="frequency">'+(r[k].frequencyRemark||this.createFrequencyName(r[k].frequencyName))+'</span>											<span class="skin-test">'+((l[r[k].groupNum]==1&&r[k].skinTest=="1")?"<b>皮试</b>":"")+'</span>											<span class="remark">'+$.trim(q[r[k].groupNum])+"</span>									   </div>"}LODOP.ADD_PRINT_HTM(a,40,530,p,o+m);a+=(p+5)}}LODOP.ADD_PRINT_TEXT(a,160,241,25,"(以下空白)");LODOP.SET_PRINT_STYLEA(0,"FontSize","10");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2)},createBodyV2:function(n,b,f,r){var g=["YF09023","YF09024","YF09025","YF09005","YF09006","YF09019"];var l={};var j={};var q={};var i={};for(k=0;k<r.length;k++){if(l[r[k].groupNum]==undefined||l[r[k].groupNum]==null){l[r[k].groupNum]=0;i[r[k].groupNum]=0;q[r[k].groupNum]=r[k].remark}l[r[k].groupNum]+=1}var o="<style>							span{								font-size:13px;								font-family:微软雅黑;								vertical-align:text-top;								word-wrap:break-word;								border:0;								padding:0;							}							.group-num{								float:left;								margin:0;								margin-left:15px;								display:inline-block;								box-sizing:border-box;								-moz-box-sizing:border-box;								-webkit-box-sizing:border-box;								width:20px;							}							.drug-name{								width:156px;							}							.drug-spec{								width:160px;								padding-right:16px;								word-wrap:break-word;								position:absolute;								left:170px;							}							.drug-dose{								width:116px;								position:absolute;								left:332px;							}							.day-or-qty{								width:84px;							}							.dose{								position:absolute;								width:99px;								left:55px;							}							.usage{								position:absolute;								width:68px;								left:159px;							}							.frequency{								position:absolute;								width:80px;								left:230px;							}							.skin-test{								position:absolute;								width:40px;								left:295px;							}							.remark{								position:absolute;								left:340px;							}							.line{								position:relative;							}						</style>";var t='<div style="font-size:25px;font-weight:bold;">								Rp.						</div>';LODOP.ADD_PRINT_LINE(extraHeight,530,extraHeight,8,0,1);LODOP.ADD_PRINT_HTM(extraHeight+10,15,530,25,t);var a=extraHeight+45;var d=0;var p=22;for(var k=0;k<r.length;k++){var c=false;var e="";if(j[r[k].groupNum]==null){j[r[k].groupNum]=0;e=r[k].groupNum+"."}j[r[k].groupNum]++;if(j[r[k].groupNum]==l[r[k].groupNum]){c=true}var h='<div class="line">								<span class="group-num">'+e+'</span>								<span class="drug-name">'+r[k].drugName+((l[r[k].groupNum]!=1&&r[k].skinTest=="1")?"<b>(皮试)</b>":"")+'</span>								<span class="drug-spec">'+r[k].drugSpec+'</span>								<span class="drug-dose">'+(l[r[k].groupNum]==1&&$.inArray(r[k].drugUsageId,g)==-1?"":(r[k].drugDose+" "+r[k].drugUnitName))+"</span>							</div>";d=this.calcMaxHeight(r[k].drugName+((l[r[k].groupNum]!=1&&r[k].skinTest=="1")?"<b>(皮试)</b>":""),r[k].drugSpec);if(a+d>667){LODOP.NEWPAGEA();extraHeight=0;this.createHeadV2(n,b,f);LODOP.ADD_PRINT_LINE(extraHeight,530,extraHeight,8,0,1);LODOP.ADD_PRINT_HTM(extraHeight+10,15,530,28,t);this.medicienFooter(n,b,f);a=extraHeight+45}LODOP.ADD_PRINT_HTM(a,35,530,d,o+h);i[r[k].groupNum]+=d;if($.inArray(r[k].drugUsageId,g)==-1){LODOP.ADD_PRINT_HTM(a,485,45,14,'<span style="font-size:13px;font-family:微软雅黑;">'+r[k].totalQty+r[k].recipeUnit+"</span>")}a+=d;if(c){if($.inArray(r[k].drugUsageId,g)!=-1){LODOP.ADD_PRINT_LINE(a-i[r[k].groupNum]+6,482,a-3,483,0,1);LODOP.ADD_PRINT_HTM(a-20,485,45,14,'<span style="font-size:13px;font-family:微软雅黑;">X&nbsp;'+r[k].totalDay+"天</span>")}var m="";if(l[r[k].groupNum]==1&&$.inArray(r[k].drugUsageId,g)==-1){m='<div class="line">											<span class="dose">用法&nbsp;:&nbsp;'+(r[k].drugDose+" "+r[k].drugUnitName)+'</span>											<span class="usage">'+r[k].drugUsageName+'</span>											<span class="frequency">'+(r[k].frequencyRemark||this.createFrequencyName(r[k].frequencyName))+'</span>											<span class="skin-test">'+((l[r[k].groupNum]==1&&r[k].skinTest=="1")?"<b>皮试</b>":"")+'</span>											<span class="remark">'+$.trim(q[r[k].groupNum])+"</span>									   </div>"}else{m='<div class="line">											<span class="usage" style="width:94px;left:55px;">用法&nbsp;:&nbsp;'+r[k].drugUsageName+'</span>											<span class="frequency">'+(r[k].frequencyRemark||this.createFrequencyName(r[k].frequencyName))+'</span>											<span class="skin-test">'+((l[r[k].groupNum]==1&&r[k].skinTest=="1")?"<b>皮试</b>":"")+'</span>											<span class="remark">'+$.trim(q[r[k].groupNum])+"</span>									   </div>"}LODOP.ADD_PRINT_HTM(a,40,530,p,o+m);a+=(p+5)}}LODOP.ADD_PRINT_TEXT(a,160,241,25,"(以下空白)");LODOP.SET_PRINT_STYLEA(0,"FontSize","10");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2)},medicienFooter:function(d,f,e){var b=this;var c=b.GetOSInfo();var a=741;if(c.indexOf("Windows_XP")>-1||c.indexOf("Windows_vista")>-1){a=715}LODOP.ADD_PRINT_TEXT(a,7,80,25,"医师");LODOP.SET_PRINT_STYLEA(0,"FontSize","10");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.SET_PRINT_STYLEA(0,"ItemType",4);LODOP.ADD_PRINT_TEXT(a,46,66,25,(e.doctorName));LODOP.SET_PRINT_STYLEA(0,"FontSize","10");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.SET_PRINT_STYLEA(0,"ItemType",4);LODOP.ADD_PRINT_LINE(a+13,34,a+13,110,0,1);LODOP.ADD_PRINT_TEXT(a,116,66,25,"审方药师");LODOP.SET_PRINT_STYLEA(0,"FontSize","10");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.SET_PRINT_STYLEA(0,"ItemType",4);LODOP.ADD_PRINT_TEXT(a,326,66,25,"");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.SET_PRINT_STYLEA(0,"ItemType",4);LODOP.ADD_PRINT_LINE(a+13,169,a+13,249,0,1);LODOP.ADD_PRINT_TEXT(a+1,256,66,25,"配药药师");LODOP.SET_PRINT_STYLEA(0,"FontSize","10");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.SET_PRINT_STYLEA(0,"ItemType",4);LODOP.ADD_PRINT_TEXT(a,326,66,25,"");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.SET_PRINT_STYLEA(0,"ItemType",4);LODOP.ADD_PRINT_LINE(a+13,308,a+13,388,0,1);LODOP.ADD_PRINT_TEXT(a,396,66,25,"发药药师");LODOP.SET_PRINT_STYLEA(0,"FontSize","10");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.SET_PRINT_STYLEA(0,"ItemType",4);LODOP.ADD_PRINT_TEXT(a,461,61,25,"");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.SET_PRINT_STYLEA(0,"ItemType",4);LODOP.ADD_PRINT_LINE(a+13,447,a+13,527,0,1);LODOP.ADD_PRINT_LINE(a-13,4,a-13,530,0,1);if(isShowAmount!=1){LODOP.ADD_PRINT_TEXT(a-35,345,200,28,"药品总金额："+e.totalPrice+"元");LODOP.SET_PRINT_STYLEA(0,"FontSize","10");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.SET_PRINT_STYLEA(0,"ItemType",4)}},getStrLength:function(b){var a=b.match(/[^\x00-\xff]/ig);return b.length+(a==null?0:a.length)},cutStr:function(d,a){if(!d){return""}if(a<=0){return""}var c=0;for(var b=0;b<d.length;b++){if(d.charCodeAt(b)>255){c+=2}else{c++}if(c==a){return d.substring(0,b-2)}else{if(c>a){return d.substring(0,b-2)}}}return d},getData:function(a){var b="";var c=Utils.myAjaxHandler(a);c.done(function(d){if(d!=null&&d.errorCode==SUCCESSCODE){b=d.data}else{$.paAlert(d.errorMessage)}}).fail(function(d){$.paAlert("获取用户信息失败!")}).always(function(){});return b},toDecimal4:function(a){var d=parseFloat(a);if(isNaN(d)||d<0){return"0.0000"}var d=Math.round(a*10000)/10000;var c=d.toString();var b=c.indexOf(".");if(b<0){b=c.length;c+="."}while(c.length<=b+4){c+="0"}return c},toDecimal2:function(a){var d=parseFloat(a);if(isNaN(d)||d<0){return"0.00"}var d=Math.round(a*100)/100;var c=d.toString();var b=c.indexOf(".");if(b<0){b=c.length;c+="."}while(c.length<=b+2){c+="0"}return c},GetOSInfo:function(){var a=navigator.platform;var b=navigator.userAgent;if(a=="Win32"||a=="Windows"){if(b.indexOf("WOW64")>-1){_bit="64位"}else{_bit="32位"}if(b.indexOf("Windows NT 6.0")>-1||b.indexOf("Windows Vista")>-1){return"Windows_vista "+_bit}else{if(b.indexOf("Windows NT 6.1")>-1||b.indexOf("Windows 7")>-1){return"Windows_7 "+_bit}else{try{var f=Array("2000","XP","2003");var d=b.match(/Windows NT 5.\d/i).toString();return"Windows_"+f[d.replace(/Windows NT 5.(\d)/i,"$1")]+" "+_bit}catch(c){return"Windows"}}}}else{if(a=="Mac68K"||a=="MacPPC"||a=="Macintosh"){return"Mac"}else{if(a=="X11"){return"Unix"}else{if(String(a).indexOf("Linux")>-1){return"Linux"}else{return"Unknow"}}}}},calcMaxHeight:function(f,e){var d=$("body").append($('<span stlye="display:none;font-size:13px;" id="textWidth"/>')).find("#textWidth").html(f).width();var c=$("body").append($('<span stlye="display:none;font-size:13px;" id="textWidth2"/>')).find("#textWidth2").html(e).width();$("#textWidth,#textWidth2").remove();var b=Math.ceil(d/1/169);var g=Math.ceil(c/1/158);var a=b>g?b:g;return a*13+(a*2)*3+2},calcHeight:function(d,b){var a=$("body").append($('<span stlye="display:none;font-size:13px;" id="textWidth"/>')).find("#textWidth").html(d).width();$("#textWidth").remove();var c=Math.ceil(a/1/b);return c*14+(c*2)*3+2},getRecipeByRecipeIdAction:function(c,f){var a=this;var d={recipeId:c};var b={url:ContextClinc_Server+"dentistryRecipe/getDentistryRecipeRecipeId",dataType:"json",showMask:true,data:d,async:false};var e=Utils.myAjaxHandler(b);e.done(function(g){if(g.errorCode=="E0000000"){f.call(a,g.data)}else{$.paError("提交失败")}}).fail(function(g){$.paError("操作失败!")}).always(function(){})},};