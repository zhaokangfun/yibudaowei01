var gender={"1":"男","2":"女","3":"保密"};var acographyId=Utils.getQueryString("acographyId");var empiId=Utils.getQueryString("empiId");var userInfo_aclc=config_cache.getCache("medical_user_data");var clinicParams=userInfo_aclc.clinicParams;var isShowAmount;for(var index in clinicParams){if(clinicParams[index].parameterCode=="3013"){isShowAmount=clinicParams[index].parameterValue;break}}function AdditionPrint(){}AdditionPrint.prototype={doPrintFacade:function(h,e,g,a,f,b){var c=this;if(!h){h=acographyId}var d={rightOffset:0,bottomOffset:0};c.doPrint(h,e,d,g,a,f,b)},doPrint:function(o,d,b,a,m,q,s){var n=this;if(!o){o=acographyId}LODOP=getLodop();if(!LODOP){return}var l={acographyId:o,empiId:d};var e={url:ContextClinc_Server+"dwsCnMedical/selectCnMecPatientAndDocInfo",dataType:"json",type:"POST",data:l,async:false};var r=n.getData(e);if(r==null||r.length==0){return}var h={recipeId:m};var c={url:ContextClinc_Server+"dentistryRecipe/getAdditionRecipeId",dataType:"json",type:"POST",data:h,async:false};var g=n.getData(c);if(g==null||g.length==0){$.paWarn("无附加项目！");return}var k=_.isNumber(b.rightOffset)?b.rightOffset:0;var j=_.isNumber(b.bottomOffset)?b.bottomOffset:0;LODOP.PRINT_INITA(j,k,530+k,763+j,"");LODOP.SET_PRINT_PAGESIZE(1,1480,2100,"");n.createHead(r);LODOP.ADD_PRINT_TEXT(28,10,543,31,userInfo_aclc.clinicName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",15);LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(59,11,543,31,"附加项目单");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",15);LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(79,7,111,20,"医疗证/医保卡号：");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(79,116,127,20,r.IS_YB_REG==1?(r.INSURANCE_NO||"-"):"-");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");LODOP.ADD_PRINT_TEXT(211,10,510,60,"病历摘要："+($("#historyOfPresentIllness").val()==null||$("#historyOfPresentIllness").val().length==0?"无":$("#historyOfPresentIllness").val()));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.SET_PRINT_STYLEA(0,"ItemType",4);LODOP.ADD_PRINT_SHAPE(4,278,0,530,30,0,1,"#D7D7D7");LODOP.ADD_PRINT_TEXT(289,10,80,25,"项目名称");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(289,90,80,25,"规格");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);if(isShowAmount!=1){LODOP.ADD_PRINT_TEXT(289,170,70,25,"单价（元）");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(289,240,70,25,"数量");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(289,310,200,25,"备注");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1)}else{LODOP.ADD_PRINT_TEXT(289,170,100,25,"数量");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(289,270,240,25,"备注");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1)}var t=323;var f=0;for(var p in g){if(a==1&&r.CHARGESTATUS==1){continue}if(t>680){LODOP.NEWPAGEA();n.createHead(r);LODOP.ADD_PRINT_TEXT(28,10,543,31,userInfo_aclc.clinicName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",15);LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(59,11,543,31,"附加项目单");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",15);LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(79,7,111,20,"医疗证/医保卡号：");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(79,116,127,20,r.IS_YB_REG==1?(r.INSURANCE_NO||"-"):"-");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");LODOP.ADD_PRINT_TEXT(211,10,510,60,"病历摘要："+($("#historyOfPresentIllness").val()==null||$("#historyOfPresentIllness").val().length==0?"无":$("#historyOfPresentIllness").val()));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.SET_PRINT_STYLEA(0,"ItemType",4);LODOP.ADD_PRINT_SHAPE(4,278,0,530,30,0,1,"#D7D7D7");LODOP.ADD_PRINT_TEXT(289,10,80,25,"项目名称");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(289,90,80,25,"规格");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);if(isShowAmount!=1){LODOP.ADD_PRINT_TEXT(289,170,70,25,"单价（元）");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(289,240,70,25,"数量");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(289,310,200,25,"备注");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1)}else{LODOP.ADD_PRINT_TEXT(289,170,70,25,"数量");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(289,270,240,25,"备注");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1)}t=323}if(p%2==1){LODOP.ADD_PRINT_SHAPE(4,t-14,0,530,46,0,1,"#E6E6E6")}LODOP.ADD_PRINT_TEXT(t,10,80,20,g[p].additionName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",8);LODOP.ADD_PRINT_TEXT(t,90,80,20,g[p].drugPackageSpec);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");if(isShowAmount!=1){LODOP.ADD_PRINT_TEXT(t,170,70,20,n.toDecimal2(g[p].unitPrice));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",8);LODOP.ADD_PRINT_TEXT(t,240,70,20,g[p].additionQty+" "+g[p].unitName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",8);LODOP.ADD_PRINT_TEXT(t-8,310,200,35,g[p].remark?g[p].remark:"");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"FontSize",7);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑")}else{LODOP.ADD_PRINT_TEXT(t,170,100,20,g[p].additionQty+" "+g[p].unitName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",8);LODOP.ADD_PRINT_TEXT(t-8,270,240,35,g[p].remark?g[p].remark:"");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"FontSize",7);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑")}t+=47;f+=(g[p].unitPrice*g[p].additionQty)}if(isShowAmount!=1){LODOP.ADD_PRINT_TEXT(710,360,270,25,"总金额："+n.toDecimal2(f)+" 元");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.SET_PRINT_STYLEA(0,"ItemType",4)}LODOP.ADD_PRINT_TEXT(728,325,70,25,"申请医生：");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.SET_PRINT_STYLEA(0,"ItemType",4);LODOP.ADD_PRINT_TEXT(728,385,150,18,q);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");if(s){reviewFlag=false}operateType()},createHead:function(data){var self=this;var data=data;LODOP.ADD_PRINT_TEXT(7,5,32,25,"NO.");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(7,38,120,25,data.ACOGRAPHY_SERIAL_NO);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#FF0000");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(7,464,35,25,"普通");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.ADD_PRINT_TEXT(7,500,35,25,"#/&");LODOP.SET_PRINT_STYLEA(0,"ItemType",2);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.ADD_PRINT_TEXT(105,7,44,25,"姓名 :");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(105,150,40,25,"性别 :");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(105,229,40,25,"年龄 :");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(105,322,40,25,"科室 :");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(105,435,40,25,"费别 :");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(135,8,55,25,"病历号 :");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(135,155,71,25,"住址/电话 :");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(170,8,70,25,"临床诊断 :");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(170,384,65,25,"开具日期 :");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(105,49,100,25,data.PATIENT_NAME);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");LODOP.ADD_PRINT_TEXT(105,190,36,25,eval("gender["+data.PATIENT_GENDER+"]"));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.ADD_PRINT_TEXT(105,264,60,25,Utils.getPersonAccurateAge(data.PATIENT_BIRTH_DATE));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.ADD_PRINT_TEXT(105,360,81,25,data.DEPARTMENT_NAME||"-");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");LODOP.ADD_PRINT_TEXT(105,475,59,25,data.IS_YB_REG==1?data.MI_TYPE_NAME:"自费");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");var patient_no=data.PATIENT_NO;if(null==patient_no||"null"==patient_no||""==patient_no){patient_no=""}else{patient_no=patient_no.substr(0,18)}LODOP.ADD_PRINT_TEXT(135,47,119,25,patient_no);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);var living_address_countryside=data.LIVING_ADDRESS_COUNTRYSIDE;if(null==living_address_countryside||"null"==living_address_countryside||""==living_address_countryside){living_address_countryside="-"}var addressPhone=living_address_countryside+"/"+data.MOBILE_PHONE_NUMBER;if(null!=data.MOBILE_PHONE_NUMBER&&self.getStrLength(addressPhone)>102){var mobileLength=self.getStrLength("/"+data.MOBILE_PHONE_NUMBER);addressPhone=self.cutStr(living_address_countryside,102-mobileLength)+"/"+data.MOBILE_PHONE_NUMBER}if(data.MOBILE_PHONE_NUMBER==null){addressPhone=living_address_countryside+"/-"}LODOP.ADD_PRINT_TEXT(135,226,333,25,addressPhone);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");var diagnosisList=data.DiagnosisList;var chineseTraDiagnosis=data.CHINESE_TRA_DIAGNOSIS;if(null==diagnosisList||"null"==diagnosisList||""==diagnosisList){diagnosisList=""}if(null==chineseTraDiagnosis||"null"==chineseTraDiagnosis||""==chineseTraDiagnosis){chineseTraDiagnosis=""}LODOP.ADD_PRINT_TEXT(170,69,314,25,diagnosisList||chineseTraDiagnosis||"-");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");LODOP.ADD_PRINT_TEXT(170,450,95,25,Utils.timeStampToDateStr(data.MODIFY_DATE,7));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontColor","#0000FF");LODOP.ADD_PRINT_LINE(94,4,94,530,0,1);LODOP.ADD_PRINT_LINE(198,4,198,530,0,1);LODOP.ADD_PRINT_LINE(723,4,723,530,0,3)},getStrLength:function(b){var a=b.match(/[^\x00-\xff]/ig);return b.length+(a==null?0:a.length)},cutStr:function(d,a){if(!d){return""}if(a<=0){return""}var c=0;for(var b=0;b<d.length;b++){if(d.charCodeAt(b)>255){c+=2}else{c++}if(c==a){return d.substring(0,b-2)}else{if(c>a){return d.substring(0,b-2)}}}return d},getData:function(a){var b="";var c=Utils.myAjaxHandler(a);c.done(function(d){if(d!=null&&d.errorCode==SUCCESSCODE){b=d.data}else{$.paAlert(d.errorMessage)}}).fail(function(d){$.paAlert("获取用户信息失败!")}).always(function(){});return b},toDecimal4:function(a){var d=parseFloat(a);if(isNaN(d)||d<0){return"0.0000"}var d=Math.round(a*10000)/10000;var c=d.toString();var b=c.indexOf(".");if(b<0){b=c.length;c+="."}while(c.length<=b+4){c+="0"}return c},toDecimal2:function(a){var d=parseFloat(a);if(isNaN(d)||d<0){return"0.00"}var d=Math.round(a*100)/100;var c=d.toString();var b=c.indexOf(".");if(b<0){b=c.length;c+="."}while(c.length<=b+2){c+="0"}return c},};