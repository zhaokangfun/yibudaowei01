var gender={"1":"男","2":"女","3":"保密"};var userInfo_aclc=config_cache.getCache("medical_user_data");var item3013=_.find(userInfo_aclc.clinicParams,function(a){return a.parameterCode=="3013"});var isHidePrice=item3013&&item3013.parameterValue;function PhysiotherapyPrint(){this.acographyId=Utils.getQueryString("acographyId");this.empiId=Utils.getQueryString("empiId")}PhysiotherapyPrint.prototype={doPrintFacade:function(b){var a=this;wjPrintUtils.getPrintSetting(wjPrintUtils.printFunction.physiotherapy,function(e,d){if(e==1){a.doPrint(b)}else{if(e==2){var c=a.customPrint(b);wjPrintUtils.print(d,c,function(f){if(f.code!=SUCCESSCODE){$.paWarn(f.message)}})}else{$.paWarn("请先配置打印参数！")}}})},doPrint:function(c){var k=this;LODOP=getLodop();if(!LODOP){return}var l={url:ContextClinc_Server+"tcmPhysiotherapy/queryPhysiotherapys",dataType:"json",contentType:"application/json",type:"POST",data:JSON.stringify({empiId:k.empiId,acographyId:k.acographyId,physiotherapyId:c}),async:false};var e=k.getData(l);var j=e.physiotherapies[0];var d=j.items;var f=e.empi;if(e==null||e.length==0){return}LODOP.PRINT_INITA(0,0,572,763,"");LODOP.SET_PRINT_PAGESIZE(1,1480,2100,"");k.createHead(f);k.createFooter(j,f);var h=245;var g=0;var b=0;for(var a in d){if(h>650){h=245;LODOP.NEWPAGEA();k.createHead(f);k.createFooter(j,f)}if(a%2==1){LODOP.ADD_PRINT_SHAPE(4,h-5,0,530,42,0,1,"#F0F0F0")}b=b+1;LODOP.ADD_PRINT_TEXT(h,10,180,25,b+". "+d[a].treatmentName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",10);LODOP.ADD_PRINT_TEXT(h,260,50,25,d[a].qty);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",10);LODOP.ADD_PRINT_TEXT(h,363,175,35,d[a].description||"");LODOP.SET_PRINT_STYLEA(0,"FontSize",10);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(h,185,75,25,(isHidePrice==1?"-":k.toDecimal2(d[a].price)));LODOP.SET_PRINT_STYLEA(0,"FontSize",10);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(h,305,62,25,(d[a].treatmentUnitName||""));LODOP.SET_PRINT_STYLEA(0,"FontSize",10);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");h+=45;g+=(d[a].price*d[a].qty)}LODOP.ADD_PRINT_TEXT(741,92,74,25,"总金额(元):");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.SET_PRINT_STYLEA(0,"ItemType",4);LODOP.ADD_PRINT_TEXT(741,150,100,25,(isHidePrice==1?"-":k.toDecimal2(g)));LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",10);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_LINE(753,155,753,246,0,1);LODOP.ADD_PRINT_TEXT(h,215,100,20,"(以下空白)");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Italic",1);operateType()},createHead:function(empi){var self=this;LODOP.ADD_PRINT_LINE(733,0,733,530,0,1);LODOP.ADD_PRINT_SHAPE(4,207,0,530,30,0,1,"#DCDCDC");LODOP.ADD_PRINT_TEXT(217,26,150,25,"项目名称");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",10);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(217,185,75,25,"单价（元）");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",10);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(217,260,40,25,"数量");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",10);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(217,305,40,25,"单位");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",10);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(217,363,40,25,"备注");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",10);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(79,7,111,20,"医疗证/医保卡号：");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(79,110,127,20,empi.IS_YB_REG==1?(empi.INSURANCE_NO||"-"):"-");LODOP.ADD_PRINT_TEXT(28,10,510,25,userInfo_aclc.clinicName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",13);LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(53,10,510,25,"理疗单");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",13);LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(7,5,32,25,"NO.");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(7,491,35,25,"#/&");LODOP.SET_PRINT_STYLEA(0,"ItemType",2);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.ADD_PRINT_TEXT(105,7,45,25,"姓名 :");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(105,159,40,25,"性别 :");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(105,229,41,25,"年龄 :");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(105,332,40,25,"科室 :");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(105,442,40,25,"费别 :");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(135,8,55,25,"病历号 :");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(135,160,71,25,"住址/电话 :");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(170,8,100,25,"临床诊断及证型 :");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(170,384,65,25,"开具日期 :");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(7,38,120,25,empi.ACOGRAPHY_SERIAL_NO);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(105,50,108,25,empi.PATIENT_NAME);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(105,199,33,25,eval("gender["+empi.PATIENT_GENDER+"]"));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.ADD_PRINT_TEXT(105,270,70,25,Utils.getPersonAccurateAge(empi.PATIENT_BIRTH_DATE));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(105,370,81,25,empi.DEPARTMENT_NAME||"-");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(105,479,59,25,empi.MI_TYPE_NAME||"自费");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");var patient_no=empi.PATIENT_NO;if(null==patient_no||"null"==patient_no||""==patient_no){patient_no=""}else{patient_no=patient_no.substr(0,18)}LODOP.ADD_PRINT_TEXT(135,55,119,25,patient_no);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");var living_address_countryside=empi.LIVING_ADDRESS_COUNTRYSIDE;if(null==living_address_countryside||"null"==living_address_countryside||""==living_address_countryside){living_address_countryside="-"}var addressPhone=living_address_countryside+"/"+empi.MOBILE_PHONE_NUMBER;if(null!=empi.MOBILE_PHONE_NUMBER&&self.getStrLength(addressPhone)>102){var mobileLength=self.getStrLength("/"+empi.MOBILE_PHONE_NUMBER);addressPhone=self.cutStr(living_address_countryside,102-mobileLength)+"/"+empi.MOBILE_PHONE_NUMBER}if(empi.MOBILE_PHONE_NUMBER==null){addressPhone=living_address_countryside+"/-"}LODOP.ADD_PRINT_TEXT(135,231,310,25,addressPhone);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");var diagnosis=empi.CHINESE_TRA_DIAGNOSIS;if(diagnosis){if(empi.DiagnosisList){diagnosis+="；"+empi.DiagnosisList}}else{diagnosis=empi.DiagnosisList}LODOP.ADD_PRINT_TEXT(170,107,281,25,diagnosis||"-");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(170,449,95,25,Utils.timeStampToDateStr(empi.MODIFY_DATE,7));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_LINE(94,4,94,530,0,1);LODOP.ADD_PRINT_LINE(198,4,198,530,0,1)},createFooter:function(b,a){LODOP.ADD_PRINT_TEXT(30,476,52,20,"理疗单"+b.physiotherapyNo);LODOP.ADD_PRINT_TEXT(741,253,40,25,"医师 :");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.SET_PRINT_STYLEA(0,"ItemType",4);LODOP.ADD_PRINT_TEXT(741,283,100,25,a.DOCTOR_NAME);LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_LINE(753,288,753,379,0,1);LODOP.ADD_PRINT_TEXT(741,390,54,25,"执行人 :");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(741,430,100,25,(b.executorName||""));LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_LINE(753,435,753,526,0,1)},customPrint:function(physiotherapyId){var self=this;var options={url:ContextClinc_Server+"tcmPhysiotherapy/queryPhysiotherapys",dataType:"json",contentType:"application/json",type:"POST",data:JSON.stringify({empiId:empiId,acographyId:acographyId,physiotherapyId:physiotherapyId}),async:false};var treatData=self.getData(options);var physiotherapy=treatData.physiotherapies[0];var items=physiotherapy.items;var empi=treatData.empi;if(treatData==null||treatData.length==0){return}var printData={};printData.data={};printData.data.info={};printData.data.info.clinicName=userInfo_aclc.clinicName;printData.data.info.patientName=empi.PATIENT_NAME;printData.data.info.gender=eval("gender["+empi.PATIENT_GENDER+"]");printData.data.info.age=Utils.getPersonAccurateAge(empi.PATIENT_BIRTH_DATE);printData.data.info.departmentName=empi.DEPARTMENT_NAME||"-";printData.data.info.fadeName=empi.MI_TYPE_NAME||"-";printData.data.info.doctorName=physiotherapy.employeeName||userInfo_aclc.userName;printData.data.info.executorName=physiotherapy.executorName||"--";var patient_no=empi.PATIENT_NO;if(null==patient_no||"null"==patient_no||""==patient_no){patient_no=""}else{patient_no=patient_no.substr(0,18)}printData.data.info.patientNo=patient_no;var diagnosis=empi.CHINESE_TRA_DIAGNOSIS;if(diagnosis){if(empi.DiagnosisList){diagnosis+="；"+empi.DiagnosisList}}else{diagnosis=empi.DiagnosisList}printData.data.info.diagnosis=diagnosis||"-";printData.data.info.medicareCardNo=empi.INSURANCE_NO||"-";var living_address_countryside=empi.LIVING_ADDRESS_COUNTRYSIDE;if(null==living_address_countryside||"null"==living_address_countryside||""==living_address_countryside){living_address_countryside="-"}var addressPhone="";if(null==empi.MOBILE_PHONE_NUMBER||"null"==empi.MOBILE_PHONE_NUMBER||""==empi.MOBILE_PHONE_NUMBER){addressPhone=living_address_countryside+"/-"}else{addressPhone=living_address_countryside+"/"+empi.MOBILE_PHONE_NUMBER}if(null!=empi.MOBILE_PHONE_NUMBER&&self.getStrLength(addressPhone)>102){var mobileLength=self.getStrLength("/"+empi.MOBILE_PHONE_NUMBER);addressPhone=self.cutStr(living_address_countryside,102-mobileLength)+"/"+empi.MOBILE_PHONE_NUMBER}printData.data.info.addressPhone=addressPhone;printData.data.info.physiotherapyNo="理疗单"+physiotherapy.physiotherapyNo;printData.data.info.acographySerialNo="NO."+empi.ACOGRAPHY_SERIAL_NO;printData.data.info.modifyDate=Utils.timeStampToDateStr(empi.MODIFY_DATE,4);printData.data.detail=new Array();var totalPrice=0;var count=0;for(var i in items){count=count+1;var detail={};detail.treatmentName=count+". "+items[i].treatmentName;detail.treatmentUnitName=items[i].qty+items[i].treatmentUnitName;if(null==items[i].treatmentUnitName||"null"==patient_no||""==items[i].treatmentUnitName){detail.price=self.toDecimal2(items[i].price)+"元/"}else{detail.price=self.toDecimal2(items[i].price)+"元/"+items[i].treatmentUnitName}detail.description=items[i].description;printData.data.detail.push(detail);totalPrice+=(items[i].price*items[i].qty)}printData.data.info.totalPrice=totalPrice;return printData},getStrLength:function(b){var a=b.match(/[^\x00-\xff]/ig);return b.length+(a==null?0:a.length)},cutStr:function(d,a){if(!d){return""}if(a<=0){return""}var c=0;for(var b=0;b<d.length;b++){if(d.charCodeAt(b)>255){c+=2}else{c++}if(c==a){return d.substring(0,b-2)}else{if(c>a){return d.substring(0,b-2)}}}return d},getData:function(a){var b="";var c=Utils.myAjaxHandler(a);c.done(function(d){if(d!=null&&d.errorCode==SUCCESSCODE){b=d.data}else{$.paAlert(d.errorMessage)}}).fail(function(d){$.paAlert("获取用户信息失败!")}).always(function(){});return b},toDecimal2:function(a){var d=parseFloat(a);if(isNaN(d)||d<0){return"0.00"}var d=Math.round(a*100)/100;var c=d.toString();var b=c.indexOf(".");if(b<0){b=c.length;c+="."}while(c.length<=b+2){c+="0"}return c},};