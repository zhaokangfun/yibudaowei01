function PricingCharge(){this.userInfo=config_cache.getCache("medical_user_data");this.params={pageSize:12,currentPage:1,dataSource:1}}PricingCharge.prototype={constructor:PricingCharge,_initPage:function(){this.initDepartmentDrop();this.initBirthdayDatetimepicker();this.initDateControl();this._bindEvent();this.initChargeParam();this.initTipso();$("#search_btn").click();patientDependOuter.showPatientNoRuleList()},_bindEvent:function(){var a=this;$("#tablist").on("click","li",function(){var c=a.acquirePageParam();if(c==undefined){return}parameters=$.extend({},a.params,c);var b=$(this);b.addClass("cur").siblings().removeClass("cur");$(".chargeCard").empty();if(b.attr("id")=="tab-charge"){a.showUnChargeInfo(parameters)}else{a.showRegisterInfo(parameters)}});$("#search_btn").on("click",function(){var b=a.acquirePageParam();if(b==undefined){return}parameters=$.extend({},a.params,b);a.showUnChargeInfo(parameters)});$(document).keyup(function(b){if(b.keyCode==13){var c=a.acquirePageParam();if(c==undefined){return}parameters=$.extend({},a.params,c);a.showUnChargeInfo(parameters)}});$("#tab-fast").on("click",function(){$("#dialog").show().ketchup();Utils.renderPopup($("#dialog"))});$("#fast_charge_btn").off("click").on("click",function(){var b=$("#dialog").ableToFinish();if(!b){return}var c=a.acquireFastChargeParam();a.saveFastCharge(c,a.afterSaveFastCharge)});$(".fast-close").off("click").on("click",function(){a.emptyFastChargeParam();$("#dialog").hide()});$(".recipe-close").off("click").on("click",function(){$(".pend-charge-recipe-popup").hide();$(".bg-popup").hide()});this.bindPatiNameThinkBox();$("#birthday").on("keypress",function(){var b=$(this);var c=b.val();if(c!=null&&c.length==4){b.val(c+"-")}else{if(c.length==7){b.val(c+"-")}}});$("#age,#month").on("blur",function(){a.handleAgeAndBirthdate()});$("#birthday").on("blur",function(){var c=$.trim($("#birthday").val());var b=Utils.calcPatientAge(c);if(b!=""){var d=b.split(",");$("#age").val(d[0]);$("#month").val(d[1]);$("#age").removeClass("pawjzs-error");$("#month").removeClass("pawjzs-error")}});$(".all-checkbox").on("click",function(){$(this).toggleClass("checked");if($(this).hasClass("checked")){$(".pend-charge-recipe-table td i").addClass("checked")}else{$(".pend-charge-recipe-table td i").removeClass("checked")}a.caclTotalMoney()});$(".pend-charge-recipe-table").on("click","td i",function(){$(this).toggleClass("checked");var b=$(".pend-charge-recipe-table").data("params");if(YBUtils.isChongQingYb(b.MI_TYPE_CODE)){$(".all-checkbox").click()}a.caclTotalMoney()});$("#choose_recipe_btn").on("click",function(){param=a.acquireRecipeParam();location.href="chargeInfo.html?param="+JSON.stringify(param)});$("#clear_data").on("click",function(){a.emptyFastChargeParam()})},initTipso:function(){$("#tab-fast").tipso({content:"快速登记患者信息，直接开收费项目，可以不用通过医生开单",useTitle:false,});$(".tips-floating .tips-list ul li").first().click(function(){$("#tab-fast").tipso("show",{delay:"300","continue":"2000"})})},initDateControl:function(){var c=session_cache.getCache("ChargeDateCondition");var b=Utils.timeStampToDateStr(new Date(),7);if(c){var a=c.startDateTime;var d=c.endDateTime}else{var a=b;var d=b}$("#start_date_time").datetimepicker({lang:"ch",format:"Y-m-d",timepicker:false,maxDate:b});$("#end_date_time").datetimepicker({lang:"ch",format:"Y-m-d",timepicker:false,maxDate:b});$("#start_date_time").val(a);$("#end_date_time").val(d)},bindPatiNameThinkBox:function(){var d=this;var b={columns:[{display:"姓名",dataKey:"NAME",width:60},{display:"性别",dataKey:"PATIENTSEX",width:30},{display:"年龄",dataKey:"BIRTHDATEANDAGE",width:120},{display:"手机",dataKey:"MOBILEPHONENUMBER",width:100}],canedit:true,selectFirst:true,formatResult:function(e){return e.NAME},formatMatch:function(g,f,e){return g.NAME+"--"+g.MOBILEPHONENUMBER},matchContains:"word",autoFill:false,width:365,multiple:false,multipleSeparator:", ",highlight:function(f,e){return f.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+e.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>")},scroll:true,scrollHeight:180};if(cacheUtils.isChainClinic()){var c=0;b.columns[c].width=45;b.columns[++c].width=30;b.columns[++c].width=120;b.columns[++c].width=95;b.columns[++c]={display:"建档分店",dataKey:"CLINICNAME",width:85};b.width=480}else{b.width=420}var a=ContextClinc_Server+"patient/selectPatientListByPatName";$("#patiName").autocomplete(a,b).result(function(f,h,g){$("#patiName").attr("patientID",h.EMPIID);$("#patiName").attr("readOnly",true);$("#patiName").val(h.NAME||"");$("#sex_warpper").find("span[val='"+h.PATIENTSEX_+"']").addClass("checked").siblings("span").removeClass("checked");$("#birthday").val(h.PATIENTBIRTHDATE_);var e=Utils.calcPatientAge(h.PATIENTBIRTHDATE_);if(e!=""){var i=e.split(",");$("#age").val(i[0]);$("#month").val(i[1]);$("#age").removeClass("pawjzs-error");$("#month").removeClass("pawjzs-error")}$("#moblieNum").val(h.MOBILEPHONENUMBER)})},tranSexToVal:function(a){if(a=="男"){return"1"}else{if(a=="女"){return"2"}else{if(a=="保密"){return"3"}else{return a}}}},initSexDropDown:function(){var a=[{id:"1",txt:"男"},{id:"2",txt:"女"},{id:"3",txt:"保密"}];$("#sex").WJZSDropdown(a,null,function(b,c){})},initDepartmentDrop:function(){var a=this;var b={url:ContextClinc_Server+"mdcDepartment/selectListForClinic",dataType:"json"};var c=Utils.myAjaxHandler(b);c.done(function(e){if("E0000000"==e.errorCode){var d={idKey:"DEPARTMENT_ID",txtKey:"DEPARTMENT_NAME",isNeedClear:false};$("#department").WJZSDropdown(e.data,d,function(f,g){a.initDoctorDrop(g.DEPARTMENT_ID);if(g.DEPARTMENT_ID==null||$.trim(g.DEPARTMENT_ID)==""){$("#doctor").removeClass("validate(required)");$("#dialog").ketchup();$("#doctor_necessary").hide()}else{$("#doctor").addClass("validate(required)");$("#dialog").ketchup();$("#doctor_necessary").show();$("#doctor").removeClass("pawjzs-error");$("#doctor").parent().removeClass("pawjzs-error")}})}else{}}).fail(function(d){$.paError("请求未响应，请检查网络连接！");return false}).always(function(){})},initDoctorDrop:function(c){var d=this;var b=$("#doctor");b.val("");b.attr("val","");if(!c){return}var a={method:"POST",url:ContextClinc_Server+"doctorManage/getDoctorsByDepartmentId",contentType:"application/json",dataType:"json",data:c,showMask:true};var e=Utils.myAjaxHandler(a);e.done(function(h){var g=h.errorCode;if(g=="E0000000"){var f={idKey:"doctorId",txtKey:"doctorName",isNeedClear:false,isNeedThink:true};$("#doctor").WJZSDropdown(h.data,f,function(i,j){});if(h.data.length==1){$("#doctor").SelectWJZSDropdownFirstItem()}}})},initBirthdayDatetimepicker:function(){$("#birthday").datetimepicker({lang:"ch",format:"Y-m-d",maxDate:new Date().Format("yyyy-MM-dd"),timepicker:false,mask:false,onShow:function(){},onSelectDate:function(){$("#birthday").trigger("blur")}})},emptyFastChargeParam:function(){$("#patiName").removeAttr("readOnly");$("#patiName").removeAttr("patientID");$(".popcontent .input-text").val("");$(".popcontent .input-text").removeClass("pawjzs-error");$(".popcontent div").removeClass("pawjzs-error");$("#doctor").removeClass("validate(required)");$("#doctor_necessary").hide()},acquireFastChargeParam:function(){var c=this.userInfo.department;var d="";var e="";d=Utils.trimObj($("#department").attr("val"));e=$("#department").val();if(!Utils.notBlank(e)){d=""}if(!Utils.notBlank(d)){if(Utils.notBlank(c)){d=c.departmentId;e=c.departmentName}else{d="";e=""}}var f=Utils.trimObj($("#doctor").attr("val"));var b=Utils.trimObj($("#doctor").val());if(!Utils.notBlank(b)){f=""}if(!Utils.notBlank(f)){f="";b=""}f=f=="null"?"":f;var a={empiId:Utils.trimObj($("#patiName").attr("patientID")),ruleId:patientDependOuter.getPatientRuleId(),patientName:Utils.trimObj($("#patiName").val()),patientBirthDate:$("#birthday").val(),patientGender:$("#sex_warpper").find("span.checked").attr("val"),mobilePhoneNumber:Utils.trimObj($("#moblieNum").val()),clinicId:this.userInfo.clinicId,doctorId:f,doctorName:b,departmentId:d,departmentName:e,editFlag:"add"};return a},saveFastCharge:function(b,c){var e=this;var a={url:ContextClinc_Server+"empi/fastChargeRegister",dataType:"json",data:b,showMask:true};var d=Utils.myAjaxHandler(a);d.done(function(f){if("E0000000"==f.errorCode){$.extend(b,f.data);c(e,b);return true}else{$.paError("保存快速收费信息数据ajax：返回错误！"+f.errorMessage)}}).fail(function(f){$.paError("请求未响应，请检查网络连接！");return false}).always(function(){})},afterSaveFastCharge:function(a,b){$("#dialog").hide();window.location.href="./chargeInfo.html?param="+JSON.stringify(b)},acquirePageParam:function(){var a=$("#start_date_time").val();var c=$("#end_date_time").val();var b={startDateTime:a,endDateTime:c};session_cache.setCache("ChargeDateCondition",b);if(a!=null&&c!=null&&a>c){$.paWarn("开始日期不能大于结束日期！");$("#end_date_time").val($("#start_date_time").val());return}var d={beginDate:(a==""?"":a+"T00:00:00.000+0800"),endDate:(c==""?"":c+"T23:59:59.000+0800"),patientName:$("#patient_key").val()};return d},showUnChargeInfo:function(b){$(".chargeCard").empty();var a=this;var c=b;c.ajaxopts={url:chargeUrl.listUnchargePatient,showMask:true};c.callback=function(f){if(f.errorCode==SUCCESSCODE){var e=f.data;var d=e.dataSource.length;if(d==0){$("#nothing").show()}else{$("#nothing").hide()}var g=e.dataSource;a.renderTableList(g)}};$("#my-page").generatePagination(c)},showRegisterInfo:function(c,e){$(".chargeCard").empty();var a=this.self?this.self:this;var b={type:"POST",contentType:"application/json; charset=utf-8",url:chargeUrl.listRegisterPatient,dataType:"json",data:JSON.stringify(c),async:true,showMask:true};var d=Utils.myAjaxHandler(b);d.done(function(i){if(i.errorCode=="E0000000"){var g=i.data;var f=g.dataSource.length;if(f==0){$("#nothing").show()}else{$("#nothing").hide()}var h={containerId:"my-page",pageCount:g.totalPage,condition:c,callback:a.showRegisterInfo,self:a};if(!c.isGenerated){Pagination.generatePagination(h)}var j=g.dataSource;a.renderTableList(j);if(typeof e==="function"){e(c.currentPage,g.totalPage)}}else{$.paError("查询待收费记录数据ajax：返回错误！"+i.errorMessage)}}).fail(function(f){$.paError("获取数据失败!")}).always()},renderTableList:function(b){var a="";$(".chargeCard").empty();var c=this;$.each(b,function(f){var d=c.newCardItem();d.find(".patient_name").text(b[f]["patientName"]);if(1==b[f]["isYbReg"]){d.find(".patient_name").append('<span style="font-size:14px;color: #ffffff;">[医保]</span>')}var e=b[f]["patientBirthDate"];e=e==""?"--岁":Utils.getPersonAccurateAge(e);d.find(".patient_ageOrsex").text(getGenderName(b[f]["patientGender"])+" "+e);d.find(".patient_date").text(parseDate2String(b[f]["addDate"],"yyyy/MM/dd HH:mm:ss"));if(b[f]["oweFlag"]==1){d.find(".pick-status").removeClass("dsn")}else{d.find(".pick-status").addClass("dsn")}if(b[f]["chargeFlag"]==4&&(b[f]["PAY_TYPE"]==9||b[f]["PAY_TYPE"]==5)&&!b[f]["MI_TYPE_CODE"]){d.find(".s_box_bot").children().remove();d.find(".s_box_bot").append("<a class='reCharge'>支付</a><a class='undoCharge'>撤销</a>");d.find(".s_box_top").addClass("purple_color");d.find(".pick-status").removeClass("dsn");d.find(".pick-status").text("收费中")}else{if(b[f]["chargeFlag"]==4&&b[f]["MI_TYPE_CODE"]==MI_TYPE_CODE_CONSTANTS.YB_SHENZHEN_TYPE_CODE){d.find(".s_box_top").addClass("purple_color");d.find(".pick-status").removeClass("dsn");d.find(".pick-status").text("收费中");d.find(".accepts").text("医保支付");d.find(".accepts").on("click",b[f],function(){$(this).css("disabled","disabled");c.invokeYBChargeConfirmInterface(b[f])})}else{if(b[f]["chargeFlag"]==4&&b[f]["MI_TYPE_CODE"]==MI_TYPE_CODE_CONSTANTS.YB_NEW_SHENZHEN_TYPE_CODE){d.find(".s_box_top").addClass("purple_color");d.find(".pick-status").removeClass("dsn");d.find(".pick-status").text("收费中");d.find(".accepts").text("医保支付");d.find(".accepts").on("click",b[f],function(){$(this).css("disabled","disabled");c.invokeSZYBNewChargeConfirmInterface(b[f])})}else{if(b[f]["manualFlag"]==2||b[f]["pendId"]!=undefined){d.find(".s_box_bot").children().remove();d.find(".s_box_bot").append("<a class='charge'>收费</a><a class='cancelTemp'>撤销</a>");d.find(".s_box_top").addClass("purple_color");d.find(".pick-status").removeClass("dsn");d.find(".pick-status").text("暂存")}}}}if(d.find(".cancelTemp").size()==0&&b[f]["chargeFlag"]!=4){d.css("cursor","pointer").on("click",b[f],function(g){if(b[f].dataSource==chargeConstant.dataSourcePE){location.href="chargeInfo.html?param="+JSON.stringify(b[f])}else{location.href="chargeInfo.html?param="+JSON.stringify(b[f])}})}else{d.find(".charge").on("click",b[f],function(g){if(b[f].dataSource==chargeConstant.dataSourcePE){location.href="chargeInfo.html?param="+JSON.stringify(b[f])}else{location.href="chargeInfo.html?param="+JSON.stringify(b[f])}});d.find(".cancelTemp").on("click",b[f],function(g){c.cancelTempItems(g.data)})}if(d.find(".undoCharge").size()==1){d.find(".undoCharge").on("click",b[f],function(h){var g={msg:"确定撤销收费单？",cancelTxt:"取消",saveTxt:"确定",onYes:function(){c.paOnePayUndoCharge(h.data)},onNo:function(){return}};$.paConfirm(g)})}if(d.find(".reCharge").size()==1){d.find(".reCharge").on("click",b[f],function(g){c.paOnePayReCharge(g.data);$("#pay_pop").show()})}$(".chargeCard").append(d)})},newCardItem:function(){var a="<div class='s_box'><div class='s_box_top'><div class='s_box_top_l'><img src='../resources/images/card_photo_man.png' alt=''/></div><div class='s_box_top_r'><span class='patient_name'></span><span class='patient_ageOrsex'></span><span class='patient_date'></span></div></div><div class='s_box_bot'><a class='accepts'>收费</a></div><span class='pick-status pick-before'>欠费</span>";"</div>";return $(a)},choosePendRecipe:function(c){var a=this;var b=$(".pend-charge-recipe-table");this.queryRecipeInfo(c,function(d){$(".all-checkbox").removeClass("checked");b.empty();b.removeData("params");a.showRecipeInfo(d);b.data("params",c);b.data("rsData",d);if(!(typeof(ybDJObj)=="undefined")){$("#choose_recipe_btn").click()}})},cancelTempItems:function(c){var a={acographyId:c.acographyId,};c.chargePend=a;var b={msg:"确定撤销暂存单？",cancelTxt:"取消",saveTxt:"确定",onYes:function(){var d={type:"POST",contentType:"application/json; charset=utf-8",url:chargeUrl.cancelTempItems,dataType:"json",data:JSON.stringify(c),async:true,showMask:true};var e=Utils.myAjaxHandler(d);e.done(function(f){if(f.errorCode=="E0000000"){$.paSuccess("撤销成功！");$("#search_btn").click()}else{$.paError("撤销暂存单失败，"+f.errorMessage);$("#search_btn").click()}}).fail(function(f){$.paError("获取数据失败!")}).always()},onNo:function(){return}};$.paConfirm(b)},queryRecipeInfo:function(c,d){var a={type:"POST",contentType:"application/json; charset=utf-8",url:chargeUrl.listPendRecipeInfo,dataType:"json",data:JSON.stringify(c),async:true,showMask:true};var b=Utils.myAjaxHandler(a);b.done(function(e){if(e.errorCode=="E0000000"){d(e.data)}else{$.paError("查询待收费处方信息失败，"+e.errorMessage)}}).fail(function(e){$.paError("获取数据失败!")}).always()},showRecipeInfo:function(b){var a=$(".pend-charge-recipe-table");$.each(b,function(e,f){var d="";d+="<tr>";d+="<td width='30px'><i></i></td>";d+="<td width='150px' >"+parseDate2String(f.recipeDate,"yyyy/MM/dd HH:mm:ss")+"</td>";d+="<td width='100px'>"+f.docotorName+"</td>";d+="<td width='100px'>"+f.acographyTypeName+"</td>";d+="<td width='100px'>"+fmoney(f.totalMoney)+"</td>";d+="<td width='60px'>"+f.recipeState+"</td>";d+="</tr>";var c=$(d);c.data("recipeData",f);a.append(c)});$(".all-checkbox").click();if(typeof(ybDJObj)=="undefined"){$(".pend-charge-recipe-popup").show();$(".bg-popup").show()}},caclTotalMoney:function(c){var b=0;$(".pend-charge-recipe-table i[class='checked']").each(function(f){var e=$(this).parent().parent().data("recipeData");b=Utils.accAdd(b,e.totalMoney)});$("#recipe_total_money").text(fmoney(b));var d=this.getOrDefaultZero(c);var a=accSub(b,d);if(a<0){a=0}$("#amount_receivable").text(fmoney(a))},acquireRecipeParam:function(){var b=$(".pend-charge-recipe-table").data("params");var a=[];var e=[];var c=1;var d={};$(".pend-charge-recipe-table i[class='checked']").each(function(g){var f=$(this).parent().parent().data("recipeData");if(Utils.notBlank(f.bizId)){a.push(f.bizId)}else{if(f.costSourceType==2){c=2}else{var h=f.acographyType.split(",");$.merge(e,h)}}});d.recipeIds=(a.length==0?null:a);d.acographyTypes=(e.length==0?null:e);d.costSourceType=c;var d=$.extend({},b,d);return d},handleAgeAndBirthdate:function(){var a=$.trim($("#age").val());var e=$.trim($("#month").val());if(a==""){a=0}if(e==""){e=0}if(isNaN(a)||isNaN(e)||a<0||a>150||e<0||e>12||(a==0&&e==0)){$("#birthday").val("");return}var c;var f=$.trim($("#birthday").val());if(f!=null&&f!=""&&!$("#birthday").hasClass("pawjzs-error")){var b=f.split("-");c=parseInt(b[2]);if(e==0){e=12-parseInt(b[1])}}var d=Utils.calcPatientBirthday(a,e,c);$("#birthday").val(d);$("#birthday").removeClass("pawjzs-error");$("#birthday").parent().removeClass("pawjzs-error")},getDiscountPermit:function(){var c={};var a={method:"POST",url:ContextClinc_Server+"charge/getDiscountPermit",data:c,dataType:"json",async:false,showMask:true};var b=Utils.myAjaxHandler(a);b.done(function(d){if(d!=null&&d.errorCode==SUCCESSCODE){dictData=d.data;session_cache.setCache("discountPermit",dictData.disaccount)}else{$.paError(d.errorMessage,null)}}).fail(function(d){$.paError("请求异常",null)}).always(function(){})},checkDiscountInput:function(b,c,f){var a="";var h=session_cache.getCache("discountPermit");h=parseFloat(h);var g=c;var d=parseFloat(g);if(!dictData.disaccount&&d>0){if(dictData.disaccount!=0){a="您无折扣权限！";return a}}var e=this.calcOrderDiscount(b,d,f);if(h==-1){h=0}if(h==0){e=b}switch(f){case"1":if(parseFloat(c)<0){a="折扣比例不能小于0";return a}else{if(parseFloat(c)>100){a="折扣比例不能大于100";return a}else{if(h!=0&&d<h){$(this).val(g.replace(/.$/,""));a="您的最高优惠折扣权限为："+h;return a}}}break;case"2":if(parseFloat(c)<0){a="优惠金额不能小于0";return a}else{if(d>e){$(this).val(g.replace(/.$/,""));a="您的最高优惠金额为："+e;return a}}break}return a},calcOrderDiscount:function(c,f,b){var a=c;var d=0;var e=b==1?100:0;f=f||e;switch(b){case"1":d=parseFloat(fixByRound(accSub(a,accDiv(accMul(a,f),100)),2));break;case"2":d=f;break}if(d>parseFloat(c)){d=fixByRound(a,2)}return d},getDiscountType:function(){var b=$("#discount_radio").getCheckedData();var a="0";switch(b[0].id){case"n1":a="";break;case"n2":a="1";break;case"n3":a="2";break}return a},getOrDefaultZero:function(a){return(a==undefined||$.trim(a)=="")?0:a},getOrDefaultHundred:function(a){return(a==undefined||$.trim(a)=="")?100:a},validateNumberInput:function(c){if(isNaN($(c).val())){$(c).val($(c).val().replace(/[^\d\.]+/,""))}var b=parseFloat($(c).val())||0;var e=$(c).val().split(".");var a=/^0{1,}/;$(c).val($(c).val().replace(a,"0"));var a=/(^[0-9]+.[0-9]{1,2})[0-9]*/;var d=$(c).val().replace(a,"$1");if(e.length==2&&e[1].length>=2){$(c).val(d)}if(e.length>2){$(c).val(b)}},getChoseItemTotalMoney:function(){var a=0;$(".pend-charge-recipe-table i[class='checked']").each(function(c){var b=$(this).parent().parent().data("recipeData");a=Utils.accAdd(a,b.totalMoney)});return a},cqybDataPageControl:function(){},initChargeParam:function(){getCGPageData(function(a){session_cache.setCache("recordPayData",a);session_cache.setCache("paymentAccounting",a.payment_type);session_cache.setCache("charge_china_medicine_use_type",a.T25)});getYBData(function(a){session_cache.setCache("ybData",a)});getInvoiceTag(function(a){session_cache.setCache("invoiceTag",a)});getMdcParam(function(a){session_cache.setCache("chargeParamterData",a)})},paOnePayReCharge:function(b){var d={chargeId:b.chargeId};var a={url:ContextClinc_Server+"charge/getChargeRecordById",dataType:"json",data:JSON.stringify(d),contentType:"application/json;charset=utf-8"};var c=Utils.myAjaxHandler(a);c.done(function(f){if("E0000000"==f.errorCode){var e=f.data;e=$.extend(e,f.data.pricingCharge);e.payMoney=e.totalMoney;e.receMoney=e.totalMoney;e.discountValue=e.discountMoney;e.owePayOff=true;e.memberPayOff=true;chargePayPanel.window.initChargePay(e)}else{$.paError("请求未响应，请检查网络连接！")}}).fail(function(e){$.paError("请求未响应，请检查网络连接！")}).always(function(){})},paOnePayUndoCharge:function(b){var d={chargeId:b.chargeId};var a={url:ContextClinc_Server+"charge/undo",dataType:"json",data:JSON.stringify(d),contentType:"application/json;charset=utf-8"};var c=Utils.myAjaxHandler(a);c.done(function(e){if("E0000000"==e.errorCode){$.paSuccess("撤销成功！");$("#search_btn").click()}else{if("E2SP0117"==e.errorCode||"E2SP0118"==e.errorCode){$.paSuccess(e.errorMessage,2000,function(){parent.$("#CASH01").click()})}else{$.paSuccess("撤销失败！")}}}).fail(function(e){$.paError("请求未响应，请检查网络连接！")}).always(function(){})},invokeSZYBNewChargeConfirmInterface:function(b){var a=JSON.parse(b.requestParams);YBUtils.szNewSendMsg(a,function(c){a.ybChargeResult=c;YBUtils.updateYBBizFeePayMoney(a,function(d){if(d!=null&&d.errorCode==SUCCESSCODE){$.paConfirm({msg:"医保重新支付成功",saveTxt:"确定",hideCancel:true,onYes:function(){$("#search_btn").click()}})}else{$.paConfirm({msg:"医保重新支付失败,请重新支付:"+d.errorMessage,saveTxt:"确定",hideCancel:true,onYes:function(){}})}})})},invokeYBChargeConfirmInterface:function(b){var c=new ybCharge(b);var a=this;b.ssj=b.selfPayMoney;c.payYBFee(b,function(){a.updateYBBizFeePayMoney(b)})},updateYBBizFeePayMoney:function(h){var e=h.payKind;var d=h.paymentTypeId;var a=h.selfPayMoney;var f=0;if(1==e&&1==d){a=h.chargeMoney||h.CASH_PAY_MONEY||0}var c={ybItemNo:h.ybItemNo,actualPayMoney:a,ransomMoney:f,payState:1};var b={url:ContextClinc_Server+"ybReimburse/updateYBBizFeePayMoney",dataType:"json",type:"POST",data:JSON.stringify(c),contentType:"application/json;charset=utf-8",showMask:true};var g=Utils.myAjaxHandler(b);g.done(function(i){if(i!=null&&i.errorCode==SUCCESSCODE){$.paConfirm({msg:"医保重新支付成功",saveTxt:"确定",hideCancel:true,onYes:function(){$("#search_btn").click()}})}else{$.paConfirm({msg:"医保重新支付失败,请重新支付:"+i.errorMessage,saveTxt:"确定",hideCancel:true,onYes:function(){}})}})}};function closeChargePay(){$("#pay_pop").hide();$(".team_two").addClass("dsn");$(".team_one").removeClass("dsn")}function printChargeList(d,c){var b=session_cache.getCache("OWE_PAY_AND_ZERO");if(1!=b){var a=this;charge_model.getChargeList(d,function(f){var e=charge_model.buildHtmlPrintData(f);charge_model.printModel(f,e,"chargeSave")})}};