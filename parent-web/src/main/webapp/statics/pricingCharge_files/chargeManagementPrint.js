var userInfo_aclc=JSON.parse(localStorage.getItem("medical_user_data"));var ybTypePrint="";var charge_model=Class.create({getChargeList:function(d,g){var f={chargeId:d};var c={type:"POST",contentType:"application/json; charset=utf-8",url:ContextClinc_Server+"charge/queryPrintChargeList",data:JSON.stringify(f),dataType:"json",async:false,showMask:true};var e=Utils.myAjaxHandler(c);e.error(function(){$.paError("请求未响应，请检查网络连接！")});var b=this;var a=e.done(function(h){if(h.errorCode=="E0000000"){g(h.data)}else{$.paError("获取打印数据ajax：返回错误！"+h.errorMessage)}})},chargeList:function(f,j,a,g){LODOP=getLodop(a,g);var d=0;LODOP.PRINT_INITA(0,0,"80mm","","");LODOP.SET_PRINT_PAGESIZE(3,800,200,"");LODOP.ADD_PRINT_TEXT(15,5,275,30,"门诊费用清单");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",12);LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(50,5,208,20,"收费时间："+Utils.timeStampToDateStr(f.chargeInfo.chargeDate,9));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");if(f.agents&&f.agents.length==1){var b=f.agents[0];if(b!=null&&b!=""){LODOP.ADD_PRINT_TEXT(50,222,52,20,b+"剂");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑")}}LODOP.ADD_PRINT_TEXT(75,5,130,20,"姓名："+f.chargeInfo.patientName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(75,144,130,20,"类别："+f.chargeInfo.paymentName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");var e=0;if(f.memberCardNumber!=null){e=25;LODOP.ADD_PRINT_TEXT(100+d,5,280,20,"会员卡号："+f.memberCardNumber);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑")}LODOP.ADD_PRINT_LINE(95+e,4,95+e,265,0,1);LODOP.ADD_PRINT_TEXT(105+d+e,5,100,20,"名称");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(105+d+e,105,60,20,"规格");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(105+d+e,165,40,20,"数量");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(105+d+e,205,50,20,"金额");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");d+=20;$.each(f.feeList,function(n,m){var l=20;var k=cutByte(f.feeList[n].itemName||"",27,"...");l=charge_model.textLinePx(k,7,1)>l?charge_model.textLinePx(k,7,1):l;LODOP.ADD_PRINT_TEXT(105+d+e,5,100,l,cutByte(f.feeList[n].itemName||"",27,"..."));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");l=charge_model.textLinePx(f.feeList[n].itemSpec,9,1)>l?charge_model.textLinePx(f.feeList[n].itemSpec,7,1):l;LODOP.ADD_PRINT_TEXT(105+d+e,105,60,l,f.feeList[n].itemSpec||"");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",7);LODOP.ADD_PRINT_TEXT(105+d+e,165,40,20,f.feeList[n].itemAmount+" "+(f.feeList[n].itemUnit||""));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",7);LODOP.ADD_PRINT_TEXT(105+d+e,205,50,20,fmoney(f.feeList[n].totalMoney));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",7);d+=l+2});LODOP.ADD_PRINT_LINE(100+d+e,4,100+d+e,265,0,1);LODOP.ADD_PRINT_TEXT(110+d+e,10,135,20,"总金额："+fmoney(f.chargeInfo.feeTotalMoney)+"元");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");if(f.chargeInfo.doctorName!=null&&f.chargeInfo.doctorName!=""){LODOP.ADD_PRINT_TEXT(110+d+e,155,135,20,"医生："+f.chargeInfo.doctorName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑")}if(f.memberCardNumber!=null){e+=25;LODOP.ADD_PRINT_TEXT(160+d,10,280,20,"会员余额："+(f.ye/1).toFixed(2)+"元");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑")}if(f.payChannel){var i="";if(f.payChannel.payType){i+="其中"+charge_model.getPayChannelName(f.payChannel.payType,f.memberCardNumber)+(f.payChannel.payMoney1st)||"0元"}if(f.payChannel.payType2nd){i+="、"+charge_model.getPayChannelName(f.payChannel.payType2nd,f.memberCardNumber)+(f.payChannel.payMoney2nd)||"0元"}i+="。";LODOP.ADD_PRINT_TEXT(135+d+e,10,280,20,"支付方式："+i);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");d+=25}LODOP.ADD_PRINT_TEXT(135+d+e,10,280,20,userInfo_aclc.clinicName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");var h=f.chargeInfo.phone;var c=f.chargeInfo.mobile;if(!h){h=c}LODOP.ADD_PRINT_TEXT(160+d+e,10,280,20,"电话："+h);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(185+d+e,10,280,20,"打印于 "+Utils.timeStampToDateStr(new Date(),9));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");charge_model.doPrint(j)},chargeListForNoDetails:function(k,q,b,m){LODOP=getLodop(b,m);var e=0;LODOP.PRINT_INITA(0,0,"80mm","","");LODOP.SET_PRINT_PAGESIZE(3,800,200,"");LODOP.ADD_PRINT_TEXT(15,45,170,30,"门诊费用清单");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",12);LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(50,36,85,20,"姓名:"+k.chargeInfo.patientName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",8);LODOP.ADD_PRINT_TEXT(50,105,110,20,"收费时间:"+Utils.timeStampToDateStr(k.chargeInfo.chargeDate,4));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",8);LODOP.ADD_PRINT_LINE(70,44,70,208,0,1);LODOP.ADD_PRINT_TEXT(80+e,48,70,20,"名称");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(80+e,145,45,20,"金额");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);e+=15;var f=0;var r=0;var l=0;var g=0;var a=0;var d=new Array("药费","治疗费","材料费","取整费","欠费补交");$.each(k.feeList,function(s){var t=k.feeList[s];switch(t.ACOGRAPHY_TYPE){case 11:l+=t.totalMoney;break;case 4:case 5:f+=t.totalMoney;break;case 99:g+=t.totalMoney;break;case 98:a+=t.totalMoney;break;default:r+=t.totalMoney;break}});var p=new Array(f,r,l,g,a);for(var j=0;j<5;j++){var o=fmoney(p[j],2);if(o!=0){LODOP.ADD_PRINT_TEXT(80+e,48,70,20,d[j]);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.ADD_PRINT_TEXT(80+e,120,95,20,o+"元");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);e+=20}}LODOP.ADD_PRINT_LINE(75+e,44,75+e,208,0,1);LODOP.ADD_PRINT_TEXT(85+e,45,170,20,"合计金额："+((Utils.isBlank(k.chargeInfo.feeTotalMoney)?k.chargeInfo.feeTotalMoney:"0")/1).toFixed(2)+"元");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");e+=25;LODOP.ADD_PRINT_TEXT(85+e,45,170,20,"优惠金额："+((Utils.isBlank(k.chargeInfo.discountMoney)?k.chargeInfo.discountMoney:"0")/1).toFixed(2)+"元");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");e+=25;LODOP.ADD_PRINT_TEXT(85+e,45,170,20,"实收金额："+((Utils.isBlank(k.chargeInfo.payMoney)?k.chargeInfo.payMoney:"0")/1).toFixed(2)+"元");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");e+=25;LODOP.ADD_PRINT_TEXT(85+e,45,170,20,"欠费金额："+((Utils.isBlank(k.chargeInfo.oweMoney)?k.chargeInfo.oweMoney:"0")/1).toFixed(2)+"元");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");if(k.payChannel){var h="其中："+charge_model.getPayChannelName(k.payChannel.payType)+((Utils.isBlank(k.payChannel.payMoney1st)?k.payChannel.payMoney1st:"0")/1).toFixed(2)+"元";if(k.payChannel.payType2nd){h=h+","+charge_model.getPayChannelName(k.payChannel.payType2nd)+((Utils.isBlank(k.payChannel.payMoney2nd)?k.payChannel.payMoney2nd:"0")/1).toFixed(2)+"元"}LODOP.ADD_PRINT_TEXT(110+e,45,170,charge_model.textLinePx(h,13,1),h);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");e+=charge_model.textLinePx(h,13,1)}LODOP.ADD_PRINT_TEXT(110+e,45,170,20,"收款人："+(Utils.isBlank(k.chargeInfo.employeeName)?k.chargeInfo.employeeName:""));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(135+e,45,170,20,userInfo_aclc.clinicName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");var n=k.chargeInfo.phone;var c=k.chargeInfo.mobile;if(!n){n=c}LODOP.ADD_PRINT_TEXT(160+e,45,170,20,"电话："+n);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");charge_model.doPrint(q)},chargeCNList:function(e,i,a,f){LODOP=getLodop(a,f);var d=0;LODOP.PRINT_INITA(0,0,"76mm","","");LODOP.SET_PRINT_PAGESIZE(3,760,200,"");LODOP.ADD_PRINT_TEXT(15,10,250,30,"门诊费用清单");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",12);LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(50,10,193,20,"收费时间："+Utils.timeStampToDateStr(e.chargeInfo.chargeDate,9));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");if(e.agents&&e.agents.length==1){var b=e.agents[0];if(b!=null&&b!=""){LODOP.ADD_PRINT_TEXT(50,208,52,20,b+"剂");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑")}}LODOP.ADD_PRINT_TEXT(75,10,125,20,"姓名："+e.chargeInfo.patientName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(75,136,125,20,"类别："+e.chargeInfo.paymentName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_LINE(95,9,95,260,0,1);LODOP.ADD_PRINT_TEXT(105+d,10,110,20,"名称");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(105+d,122,54,20,"单价");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(105+d,170,35,20,"数量");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(105+d,205,55,20,"金额");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");d+=20;$.each(e.feeList,function(n,m){var l=20;var k=cutByte(e.feeList[n].itemName||"",27,"...");l=charge_model.textLinePx(k,7,1)>l?charge_model.textLinePx(k,7,1):l;LODOP.ADD_PRINT_TEXT(105+d,10,116,l,cutByte(e.feeList[n].itemName||"",27,"..."));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");l=charge_model.textLinePx(e.feeList[n].itemName,9,1)>l?charge_model.textLinePx(e.feeList[n].itemName,7,1):l;LODOP.ADD_PRINT_TEXT(105+d,122,54,20,parseFloat((Utils.isBlank(e.feeList[n].itemPrice)?e.feeList[n].itemPrice:"0")).toFixed(2));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",8);LODOP.ADD_PRINT_TEXT(105+d,170,35,20,e.feeList[n].itemAmount+" "+(e.feeList[n].itemUnit||""));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",8);LODOP.ADD_PRINT_TEXT(105+d,205,55,20,((Utils.isBlank(e.feeList[n].totalMoney)?e.feeList[n].totalMoney:"0")/1).toFixed(2));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",8);d+=l+2});LODOP.ADD_PRINT_LINE(100+d,9,100+d,260,0,1);LODOP.ADD_PRINT_TEXT(110+d,10,255,20,"合计金额："+((Utils.isBlank(e.chargeInfo.feeTotalMoney)?e.chargeInfo.feeTotalMoney:"0")/1).toFixed(2)+"元");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");d=d+25;LODOP.ADD_PRINT_TEXT(110+d,10,255,20,"优惠金额："+((Utils.isBlank(e.chargeInfo.discountMoney)?e.chargeInfo.discountMoney:"0")/1).toFixed(2)+"元");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");d=d+25;LODOP.ADD_PRINT_TEXT(110+d,10,255,20,"实收金额："+((Utils.isBlank(e.chargeInfo.payMoney)?e.chargeInfo.payMoney:"0")/1).toFixed(2)+"元");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");d=d+25;LODOP.ADD_PRINT_TEXT(110+d,10,255,20,"欠费金额："+((Utils.isBlank(e.chargeInfo.oweMoney)?e.chargeInfo.oweMoney:"0")/1).toFixed(2)+"元");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");d=d+25;if(e.payChannel){var h="";if(e.payChannel.payType){h+="其中"+charge_model.getPayChannelName(e.payChannel.payType,e.memberCardNumber)+(e.payChannel.payMoney1st)||"0元"}if(e.payChannel.payType2nd){h+="、"+charge_model.getPayChannelName(e.payChannel.payType2nd,e.memberCardNumber)+(e.payChannel.payMoney2nd)||"0元"}h+="。";LODOP.ADD_PRINT_TEXT(110+d,10,255,54,h);d=d+20}LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");if(e.chargeInfo.doctorName){LODOP.ADD_PRINT_TEXT(135+d,10,255,20,"就诊医生："+e.chargeInfo.doctorName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");d+=25}LODOP.ADD_PRINT_TEXT(135+d,10,255,20,userInfo_aclc.clinicName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");var g=e.chargeInfo.phone;var c=e.chargeInfo.mobile;if(!g){g=c}LODOP.ADD_PRINT_TEXT(160+d,10,255,20,"电话："+g);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(185+d,10,255,20,"打印于 "+Utils.timeStampToDateStr(new Date(),9));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");charge_model.doPrint(i)},chargeListForLarge:function(d,j,a,g){LODOP=getLodop(a,g);LODOP.PRINT_INITA(0,0,910,540,"");LODOP.SET_PRINT_PAGESIZE(1,2410,1400,"");LODOP.SET_PRINT_MODE("TRYLINKPRINTER_NOALERT",true);var e=d.chargeInfo;var f=d.feeList;charge_model.chargeListForLargeHead(d);var b=0;var h=1;for(var c=0;c<f.length;c++){LODOP.ADD_PRINT_TEXT(140+b,100,215,20,f[c].itemName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"ItemType",4);LODOP.ADD_PRINT_TEXT(140+b,319,100,20,f[c].itemAmount);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"ItemType",4);LODOP.ADD_PRINT_TEXT(140+b,445,100,20,(f[c].itemUnit||""));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"ItemType",4);LODOP.ADD_PRINT_TEXT(140+b,575,100,20,(f[c].itemPrice/1).toFixed(2));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"ItemType",4);LODOP.ADD_PRINT_TEXT(140+b,701,100,20,(f[c].totalMoney/1).toFixed(2));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"ItemType",4);b+=30;if(b>269){charge_model.chargeListForLargeFooter(d);LODOP.NEWPAGEA();charge_model.chargeListForLargeHead(d);b=0}}if(b>180){charge_model.chargeListForLargeFooter(d);LODOP.NEWPAGEA();charge_model.chargeListForLargeHead(d)}charge_model.chargeListForLargeTotal(d);charge_model.chargeListForLargeFooter(d);charge_model.doPrint(j)},chargeListForLargeTotal:function(d){var b=d.chargeInfo;var c=d.payChannel;var a=d.memberCardNumber;LODOP.ADD_PRINT_LINE(340,100,340,807,0,1);LODOP.ADD_PRINT_TEXT(355,100,170,20,"收费总额 "+((Utils.isBlank(b.feeTotalMoney)?b.feeTotalMoney:"0")/1).toFixed(2));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(387,100,170,20,"实收金额 "+((Utils.isBlank(b.payMoney)?b.payMoney:"0")/1).toFixed(2));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);if(a!=null){LODOP.ADD_PRINT_TEXT(387,262,170,20,"退费金额 "+((Utils.isBlank(b.refundMoney)?b.refundMoney:"0")/1).toFixed(2));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(355,262,170,20,"优惠金额 "+((Utils.isBlank(b.discountMoney)?b.discountMoney:"0")/1).toFixed(2));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(355,433,170,20,"欠费金额 "+((Utils.isBlank(b.oweMoney)?b.oweMoney:"0")/1).toFixed(2));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");if(c){LODOP.ADD_PRINT_TEXT(388,433,170,20,"付款方式 "+(Utils.trimObj(this.getPayChannelStr(c.payType,c.memberCardNumber,c.payKind,c.payType2nd))));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑")}LODOP.ADD_PRINT_TEXT(355,603,210,20,"会员卡号 "+a);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(388,603,210,20,"会员余额 "+(d.ye/1).toFixed(2));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑")}else{LODOP.ADD_PRINT_TEXT(387,371,150,20,"退费金额 "+((Utils.isBlank(b.refundMoney)?b.refundMoney:"0")/1).toFixed(2));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(355,371,150,20,"优惠金额 "+((Utils.isBlank(b.discountMoney)?b.discountMoney:"0")/1).toFixed(2));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(355,631,150,20,"欠费金额 "+((Utils.isBlank(b.oweMoney)?b.oweMoney:"0")/1).toFixed(2));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");if(c){LODOP.ADD_PRINT_TEXT(388,631,190,20,"付款方式 "+(Utils.trimObj(this.getPayChannelStr(c.payType,c.memberCardNumber,c.payKind,c.payType2nd))));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑")}}},chargeListForLargeHead:function(b){var a=b.chargeInfo;LODOP.ADD_PRINT_TEXT(46,100,710,30,userInfo_aclc.clinicName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",12);LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(75,100,150,20,"姓名："+a.patientName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(75,260,100,20,"类别："+a.paymentName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(75,580,190,20,"收费时间："+Utils.timeStampToDateStr(a.chargeDate,9));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",3);LODOP.ADD_PRINT_TEXT(76,420,150,20,"病历号："+(Utils.notBlank(a.PATIENT_NO)?a.PATIENT_NO:"-"));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(108,101,215,20,"项目");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(108,318,100,20,"数量");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(108,446,100,20,"单位");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(108,575,100,20,"单价 (元) ");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(108,701,100,20,"总价");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_LINE(96,100,96,807,0,2);LODOP.ADD_PRINT_LINE(127,100,127,807,0,1)},chargeListForLargeFooter:function(d){var b=d.chargeInfo;LODOP.ADD_PRINT_LINE(410,100,410,807,0,2);LODOP.ADD_PRINT_TEXT(428,100,105,20,"收费单位（盖章）");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(428,260,168,20,"医生："+(Utils.isBlank(b.doctorName)?b.doctorName:""));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(428,459,178,20,"收银员："+(Utils.isBlank(b.employeeName)?b.employeeName:""));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(428,652,168,20,"客户签名：___________________");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(460,100,390,20,"地址："+(Utils.isBlank(b.address)?b.address:""));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");var a=b.phone;var c=b.mobile;if(a){LODOP.ADD_PRINT_TEXT(460,650,155,20,"电话："+a);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑")}else{LODOP.ADD_PRINT_TEXT(460,650,155,20,"电话："+c);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑")}},chargeListForTemplate:function(d,g){var b=d.chargeInfo;LODOP.PRINT_INITA("3mm","-15mm","127.53mm","76mm","套打任务");LODOP.SET_PRINT_PAGESIZE(1,"127.53mm","76mm","");LODOP.SET_PRINT_MODE("TRYLINKPRINTER_NOALERT",true);LODOP.ADD_PRINT_TEXT(76,132,173,20,userInfo_aclc.clinicName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(102,153,74,20,b.patientName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(134,153,74,20,d.isOwePrint!=1?"治疗费":"欠费补交");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(164,153,74,20,((Utils.isBlank(b.oweMoney)?b.oweMoney:"0")/1).toFixed(2));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");var f=((Utils.isBlank(b.actualMoney)?b.actualMoney:"0")/1).toFixed(2);LODOP.ADD_PRINT_TEXT(194,153,239,20,chineseNumber(f));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(104,322,79,20,b.departmentName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(134,322,79,20,((Utils.isBlank(b.feeTotalMoney)?b.feeTotalMoney:"0")/1).toFixed(2));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(164,322,79,20,f);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(224,124,100,20,(Utils.isBlank(b.employeeName)?b.employeeName:""));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");var c=new Date().getFullYear();var e=new Date().getMonth()+1;var a=new Date().getDate();LODOP.ADD_PRINT_TEXT(224,220,50,20,c);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",3);LODOP.ADD_PRINT_TEXT(224,285,29,20,e);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",3);LODOP.ADD_PRINT_TEXT(224,325,29,20,a);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",3);charge_model.doPrint(g)},getPayChannelName:function(d,a){if(d==null){return""}var e;if(e==null){var g={typeName:"1"};var c={method:"POST",url:ContextClinc_Server+"charge/initCGRecordPage",data:g,dataType:"json",async:false,showMask:false};var f=Utils.myAjaxHandler(c);f.done(function(h){if(h!=null&&h.errorCode==SUCCESSCODE){session_cache.setCache("recordPayData",h.data);e=session_cache.getCache("recordPayData");return}else{$.paError(h.errorMessage,null);return}}).fail(function(h){$.paError("请求异常",null)}).always(function(){})}var b=e.T21.filter(function(h){return h.dictItemCode==d})[0].dictItemName;return b},getPayChannelStr:function(d,a,c,b){if(c==2){return this.getPayChannelName(d,a)+"、"+this.getPayChannelName(b,a)}return this.getPayChannelName(d,a)},chargeReport:function(e,j,a,f){LODOP=getLodop(a,f);var b=0;LODOP.PRINT_INITA(0,0,772,1103,"");LODOP.SET_PRINT_PAGESIZE(1,0,0,"A4");LODOP.ADD_PRINT_TEXT(30,60,645,35,userInfo_aclc.clinicName+"收费员交款报表");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",15);LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(75,40,360,30,"总金额："+(e.settleInfo.payMoney/1).toFixed(2));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",14);LODOP.SET_PRINT_STYLEA(0,"FontColor","#FF0000");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(75,500,200,30,"交款员："+e.settleInfo.loginName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",14);LODOP.SET_PRINT_STYLEA(0,"FontColor","#FF0000");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_LINE(110,25,110,740,0,1);LODOP.ADD_PRINT_TEXT(125,40,490,20,"收费起止时间："+Utils.timeStampToDateStr(e.settleInfo.settleStartDate,6)+" 至 "+Utils.timeStampToDateStr(e.settleInfo.settleEndDate,6));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(150,40,350,20,"收费数量  "+e.settleInfo.chargeTimes+"  退费数量  "+e.settleInfo.refundTimes);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(175,40,655,20,"总金额  "+(e.settleInfo.feeTotalMoney/1).toFixed(2)+"   记账金额  "+(e.settleInfo.accountingMoney/1).toFixed(2)+"   优惠金额  "+(e.settleInfo.discountMoney/1).toFixed(2)+"   会员卡充值  "+(e.settleInfo.memberChargeMoney/1).toFixed(2)+"   会员卡退款  "+(e.settleInfo.memberRefundMoney/1).toFixed(2)+"   会员卡消费  "+(e.settleInfo.memberConsumeMoney/1).toFixed(2));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");var c=200;LODOP.ADD_PRINT_TEXT(c+10,25,100,20,"支付方式");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.ADD_PRINT_TEXT(c+10,125,275,20,"大写");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.ADD_PRINT_TEXT(c+10,400,100,20,"小写");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);var h=0;$.each(e.payInfo,function(l,k){if(e.payInfo[l].feeCode!=7){b+=30;LODOP.ADD_PRINT_LINE(c+b,25,c+b,500,0,1);LODOP.ADD_PRINT_TEXT(c+10+b,25,100,20,e.payInfo[l].feeName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.ADD_PRINT_TEXT(c+10+b,125,275,20,chineseNumber((e.payInfo[l].totalMoney/1).toFixed(2)));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.ADD_PRINT_TEXT(c+10+b,400,100,20,(e.payInfo[l].totalMoney/1).toFixed(2));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);h=Utils.accAdd(h,e.payInfo[l].totalMoney)}});b+=30;LODOP.ADD_PRINT_LINE(c+b,25,c+b,500,0,1);LODOP.ADD_PRINT_TEXT(c+10+b,25,100,20,"总计");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(c+10+b,125,275,20,chineseNumber((h/1).toFixed(2)));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(c+10+b,400,100,20,(h/1).toFixed(2));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);b+=30;LODOP.ADD_PRINT_LINE(c+b,125,c,125,0,1);LODOP.ADD_PRINT_LINE(c+b,400,c,400,0,1);LODOP.ADD_PRINT_RECT(c,25,475,b,0,1);var g=c+b+30;b=0;for(var d=0;d<3;d++){LODOP.ADD_PRINT_TEXT(g+10,25+(d*200),100,20,"费别");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.ADD_PRINT_TEXT(g+10,125+(d*200),100,20,"金额");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2)}$.each(e.cwInfo,function(i,l){if(i%3==0){b+=30}LODOP.ADD_PRINT_LINE(g+b,25,g+b,625,0,1);LODOP.ADD_PRINT_TEXT(g+10+b,25+((i%3)*200),100,20,e.cwInfo[i].feeName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.ADD_PRINT_TEXT(g+10+b,125+((i%3)*200),100,20,(e.cwInfo[i].totalMoney/1).toFixed(2));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2)});b+=30;LODOP.ADD_PRINT_LINE(g+b,125,g,125,0,1);LODOP.ADD_PRINT_LINE(g+b,225,g,225,0,1);LODOP.ADD_PRINT_LINE(g+b,325,g,325,0,1);LODOP.ADD_PRINT_LINE(g+b,425,g,425,0,1);LODOP.ADD_PRINT_LINE(g+b,525,g,525,0,1);LODOP.ADD_PRINT_RECT(g,25,600,b,0,1);operateType(j)},MIPrintWithDetail:function(b,f,c,a){var e={chargeBizId:b};options={type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(e),showMask:true,url:ContextClinc_Server+"ybReimburse/getCommonYbBizFeePrint",async:falseG};var d=Utils.myAjaxHandler(options);d.done(function(n){LODOP=getLodop(c,a);var m=n.data;var g=0;LODOP.PRINT_INITA(0,0,"80mm","","");LODOP.SET_PRINT_PAGESIZE(3,800,200,"");LODOP.ADD_PRINT_TEXT(15,5,275,30,"门诊费用清单");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",12);LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(50,5,208,20,"收费时间："+Utils.timeStampToDateStr(m.chargeInfo.chargeDate,9));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");if(m.agents&&m.agents.length==1){var k=m.agents[0];if(k!=null&&k!=""){LODOP.ADD_PRINT_TEXT(50,222,52,20,k+"剂");LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑")}}LODOP.ADD_PRINT_TEXT(75,5,130,20,"姓名："+m.chargeInfo.patientName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(75,144,130,20,"类别："+m.chargeInfo.paymentName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");var l=0;if(m.memberCardNumber!=null){l=25;LODOP.ADD_PRINT_TEXT(100+g,5,280,20,"会员卡号："+m.memberCardNumber);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑")}LODOP.ADD_PRINT_LINE(95+l,4,95+l,265,0,1);LODOP.ADD_PRINT_TEXT(105+g+l,5,100,20,"名称");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(105+g+l,105,60,20,"规格");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(105+g+l,165,40,20,"数量");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(105+g+l,205,50,20,"金额");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");g+=20;$.each(m.feeList,function(r,q){var p=20;var o=cutByte(m.feeList[r].itemName||"",27,"...");p=charge_model.textLinePx(o,7,1)>p?charge_model.textLinePx(o,7,1):p;LODOP.ADD_PRINT_TEXT(105+g+l,5,100,p,cutByte(m.feeList[r].itemName||"",27,"..."));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");p=charge_model.textLinePx(m.feeList[r].itemSpec,9,1)>p?charge_model.textLinePx(m.feeList[r].itemSpec,7,1):p;LODOP.ADD_PRINT_TEXT(105+g+l,105,60,p,m.feeList[r].itemSpec||"");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",7);LODOP.ADD_PRINT_TEXT(105+g+l,165,40,20,m.feeList[r].itemAmount+" "+(m.feeList[r].itemUnit||""));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",7);LODOP.ADD_PRINT_TEXT(105+g+l,205,50,20,(m.feeList[r].totalMoney/1).toFixed(2));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",7);g+=p+2});LODOP.ADD_PRINT_LINE(100+g+l,4,100+g+l,265,0,1);LODOP.ADD_PRINT_TEXT(110+g+l,5,135,20,"总金额："+(m.chargeInfo.feeTotalMoney/1).toFixed(2)+"元");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");if(m.chargeInfo.doctorName!=null&&m.chargeInfo.doctorName!=""){LODOP.ADD_PRINT_TEXT(110+g+l,155,135,20,"医生："+m.chargeInfo.doctorName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑")}if(m.memberCardNumber!=null){l+=25;LODOP.ADD_PRINT_TEXT(160+g,5,280,20,"会员余额："+(m.ye/1).toFixed(2)+"元");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑")}if(m.payChannel){var i="";if(m.payChannel.payType){i+="其中"+charge_model.getPayChannelName(m.payChannel.payType,m.memberCardNumber)+m.payChannel.payMoney1st+"元"}if(m.payChannel.payType2nd){i+="、"+charge_model.getPayChannelName(m.payChannel.payType2nd,m.memberCardNumber)+m.payChannel.payMoney2nd+"元"}i+="。";LODOP.ADD_PRINT_TEXT(135+g+l,5,280,20,"支付方式："+i);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");g+=25}LODOP.ADD_PRINT_TEXT(135+g+l,5,140,20,"医保卡号："+m.ybInsuranceNo);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(135+g+l,153,140,20,"医保卡姓名："+m.insuredPersonName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");if(m.ybPayState!=2){LODOP.ADD_PRINT_TEXT(160+g+l,5,140,20,"结算前余额："+m.ybBefeBalance);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(160+g+l,153,140,20,"结算后余额："+m.ybActBalance);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");g+=25}g+=25;LODOP.ADD_PRINT_TEXT(135+g+l,5,280,20,userInfo_aclc.clinicName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");var h=m.chargeInfo.phone;var j=m.chargeInfo.mobile;if(!h){h=j}LODOP.ADD_PRINT_TEXT(160+g+l,5,280,20,"电话："+h);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(185+g+l,5,280,20,"打印于 "+Utils.timeStampToDateStr(new Date(),9));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");charge_model.doPrint(f)}).fail(function(g){})},printCQNoDetailRefund:function(c,d,b,a){charge_model.setCQPrintNoDetail(c,d,b,a)},setCQPrintNoDetail:function(B,g,a,u){LODOP=getLodop(a,u);var k=0;LODOP.PRINT_INITA(0,0,"100mm","","");LODOP.SET_PRINT_PAGESIZE(3,800,200,"");if(B.miTypeCode=="yb0003"){LODOP.ADD_PRINT_TEXT(15,45,170,30,"重庆医保清单")}else{if(Utils.isBlank(B.isOwePrint)&&B.isOwePrint==1){LODOP.ADD_PRINT_TEXT(15,45,170,30,"补交费用清单")}else{LODOP.ADD_PRINT_TEXT(15,45,170,30,"门诊费用清单")}}LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",12);LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(50,36,85,20,"姓名:"+B.chargeInfo.patientName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",8);LODOP.ADD_PRINT_TEXT(50,125,130,20,"收费时间:"+Utils.timeStampToDateStr(B.chargeInfo.chargeDate,4));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",8);LODOP.ADD_PRINT_LINE(70,44,70,208,0,1);LODOP.ADD_PRINT_TEXT(80+k,48,70,20,"名称");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(80+k,145,45,20,"金额");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);k+=15;var e=0;var D=0;var v=0;var s=0;var o=0;var w=0;var C=0;var d=0;var A=0;var z=0;var r=0;var p=0;var q=new Array("西药费","西药费","中成药费","中成药费","中草药费","中草药费","材料费","材料费","治疗费","治疗费","诊金","诊金");$.each(B.feeList,function(E){var F=B.feeList[E];if(F.totalMoney>0){switch(F.ACOGRAPHY_TYPE){case 11:s+=F.totalMoney;break;case 4:e+=F.totalMoney;break;case 5:D+=F.totalMoney;break;case 15:v+=F.totalMoney;break;case 14:w+=F.totalMoney;break;case 98:break;case 99:break;default:o+=F.totalMoney;break}}if(F.totalMoney<0){switch(F.ACOGRAPHY_TYPE){case 11:z+=F.totalMoney;break;case 4:C+=F.totalMoney;break;case 5:d+=F.totalMoney;break;case 15:A+=F.totalMoney;break;case 14:p+=F.totalMoney;break;case 98:break;case 99:break;default:r+=F.totalMoney;break}}});var m=new Array(e,C,v,A,D,d,s,z,o,r,w,p);for(var t=0;t<10;t++){var n=(m[t]/1).toFixed(2);if(n!=0){LODOP.ADD_PRINT_TEXT(80+k,48,70,20,q[t]);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.ADD_PRINT_TEXT(80+k,120,95,20,n+"元");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);k+=20}}LODOP.ADD_PRINT_LINE(75+k,44,75+k,208,0,1);LODOP.ADD_PRINT_TEXT(85+k,45,170,20,"合计金额："+((Utils.isBlank(B.chargeInfo.feeTotalMoney)?B.chargeInfo.feeTotalMoney:"0")/1).toFixed(2)+"元");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");k+=25;if(B.payChannel.payType){var y=B.chargeInfo.payMoney-B.chargeInfo.refundMoney;LODOP.ADD_PRINT_TEXT(85+k,45,170,20,"实收金额："+((Utils.isBlank(y)?y:"0")/1).toFixed(2)+"元")}else{LODOP.ADD_PRINT_TEXT(85+k,45,170,20,"实收金额：0.00元")}LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");if(B.payChannel){var x="其中：";if(B.payChannel.payType){x=x+charge_model.getPayChannelName(B.payChannel.payType)+((Utils.isBlank(B.payChannel.payMoney1st)?B.payChannel.payMoney1st:"0")/1).toFixed(2)+"元"}if(B.payChannel.payType2nd){x=x+","+charge_model.getPayChannelName(B.payChannel.payType2nd)+((Utils.isBlank(B.payChannel.payMoney2nd)?B.payChannel.payMoney2nd:"0")/1).toFixed(2)+"元"}if(B.selfYbMoney){if(B.payChannel.payType){x=x+",医保"+(B.selfYbMoney/1).toFixed(2)+"元"}else{x=x+"医保"+(B.selfYbMoney/1).toFixed(2)+"元"}}LODOP.ADD_PRINT_TEXT(110+k,45,170,charge_model.textLinePx(x,13,1),x);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");k+=charge_model.textLinePx(x,13,1)}var b=B.ybInsuranceNo==undefined?" ":B.ybInsuranceNo;var f=B.patientName==undefined?" ":B.patientName;var j=B.ybBefeBalance==undefined?" ":B.ybBefeBalance;var l=B.ybActBalance==undefined?" ":B.ybActBalance;LODOP.ADD_PRINT_TEXT(120+k,45,140,20,"医保卡号："+b);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(145+k,45,140,20,"医保卡姓名："+f);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(170+k,45,140,20,"结算前余额："+j);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");k+=25;LODOP.ADD_PRINT_TEXT(170+k,45,140,20,"结算后余额："+l);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");k+=25;LODOP.ADD_PRINT_TEXT(170+k,45,170,20,"收款人："+(Utils.isBlank(B.chargeInfo.employeeName)?B.chargeInfo.employeeName:""));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(195+k,45,170,20,userInfo_aclc.clinicName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");var h=B.chargeInfo.phone;var c=B.chargeInfo.mobile;if(!h){h=c}LODOP.ADD_PRINT_TEXT(220+k,45,170,20,"电话："+h);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");charge_model.doPrint(g)},MICQPrintNoDetail:function(b,f,c,a){var e={chargeBizId:b};options={type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(e),showMask:true,url:ContextClinc_Server+"ybReimburse/getCommonYbBizFeePrint",async:false};var d=Utils.myAjaxHandler(options);d.done(function(g){if(g!=null&&g.errorCode==SUCCESSCODE){charge_model.setCQPrintNoDetail(g.data,f,c,a)}}).fail(function(g){$.paError("打印清单发生异常！")})},MICDPrintNoDetail:function(b,f,c,a){var e={chargeBizId:b};options={type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(e),showMask:true,url:ContextClinc_Server+"ybReimburse/getCommonYbBizFeePrint",async:false};var d=Utils.myAjaxHandler(options);d.done(function(l){var B=l.data;LODOP=getLodop(c,a);var n=0;LODOP.PRINT_INITA(0,0,"100mm","","");LODOP.SET_PRINT_PAGESIZE(3,800,200,"");LODOP.ADD_PRINT_TEXT(15,45,170,30,"门诊费用清单");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",12);LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(50,36,85,20,"姓名:"+B.chargeInfo.patientName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",8);LODOP.ADD_PRINT_TEXT(50,105,130,20,"收费时间:"+Utils.timeStampToDateStr(B.chargeInfo.chargeDate,4));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"FontSize",8);LODOP.ADD_PRINT_LINE(70,44,70,208,0,1);LODOP.ADD_PRINT_TEXT(80+n,48,70,20,"名称");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);LODOP.ADD_PRINT_TEXT(80+n,145,45,20,"金额");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.SET_PRINT_STYLEA(0,"Bold",1);n+=15;var k=0;var s=0;var x=0;var q=0;var g=0;var t=0;var w=0;var A=0;var u=0;var p=0;var v=new Array("药费","药费","治疗费","治疗费","材料费","材料费","取整费","取整费","欠费补交","欠费补交");$.each(B.feeList,function(C){var D=B.feeList[C];if(D.totalMoney>0){switch(D.ACOGRAPHY_TYPE){case 11:x+=D.totalMoney;break;case 4:case 5:k+=D.totalMoney;break;case 99:q+=D.totalMoney;break;case 98:g+=D.totalMoney;break;default:s+=D.totalMoney;break}}if(D.totalMoney<0){switch(D.ACOGRAPHY_TYPE){case 11:A+=D.totalMoney;break;case 4:case 5:t+=D.totalMoney;break;case 99:u+=D.totalMoney;break;case 98:p+=D.totalMoney;break;default:w+=D.totalMoney;break}}});var o=new Array(k,t,s,w,x,A,q,u,g,p);for(var y=0;y<10;y++){var r=(o[y]/1).toFixed(2);if(r!=0){LODOP.ADD_PRINT_TEXT(80+n,48,70,20,v[y]);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);LODOP.ADD_PRINT_TEXT(80+n,120,95,20,r+"元");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.SET_PRINT_STYLEA(0,"Alignment",2);n+=20}}LODOP.ADD_PRINT_LINE(75+n,44,75+n,208,0,1);LODOP.ADD_PRINT_TEXT(85+n,45,170,20,"合计金额："+((Utils.isBlank(B.chargeInfo.feeTotalMoney)?B.chargeInfo.feeTotalMoney:"0")/1).toFixed(2)+"元");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");n+=25;LODOP.ADD_PRINT_TEXT(85+n,45,170,20,"优惠金额："+((Utils.isBlank(B.chargeInfo.discountMoney)?B.chargeInfo.discountMoney:"0")/1).toFixed(2)+"元");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");n+=25;LODOP.ADD_PRINT_TEXT(85+n,45,170,20,"实收金额："+((Utils.isBlank(B.chargeInfo.payMoney)?B.chargeInfo.payMoney:"0")/1).toFixed(2)+"元");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");n+=25;LODOP.ADD_PRINT_TEXT(85+n,45,170,20,"欠费金额："+((Utils.isBlank(B.chargeInfo.oweMoney)?B.chargeInfo.oweMoney:"0")/1).toFixed(2)+"元");LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");if(B.payChannel){var z="其中："+charge_model.getPayChannelName(B.payChannel.payType)+((Utils.isBlank(B.payChannel.payMoney1st)?B.payChannel.payMoney1st:"0")/1).toFixed(2)+"元";if(B.payChannel.payType2nd){z=z+","+charge_model.getPayChannelName(B.payChannel.payType2nd)+((Utils.isBlank(B.payChannel.payMoney2nd)?B.payChannel.payMoney2nd:"0")/1).toFixed(2)+"元"}if(B.selfYbMoney){z=z+",医保"+(B.selfYbMoney/1).toFixed(2)+"元"}LODOP.ADD_PRINT_TEXT(110+n,45,170,charge_model.textLinePx(z,13,1),z);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");n+=charge_model.textLinePx(z,13,1)}LODOP.ADD_PRINT_TEXT(120+n,45,140,20,"医保卡号："+B.ybInsuranceNo);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");var j=B.insuredPersonName==null?B.patientName:B.insuredPersonName;LODOP.ADD_PRINT_TEXT(145+n,45,140,20,"医保卡姓名："+j);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");if(B.ybPayState!=2){if(B.ybBefeBalance!=null){LODOP.ADD_PRINT_TEXT(170+n,45,140,20,"结算前余额："+B.ybBefeBalance);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");n+=25}LODOP.ADD_PRINT_TEXT(170+n,45,140,20,"结算后余额："+B.ybActBalance);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");n+=25}n+=25;LODOP.ADD_PRINT_TEXT(170+n,45,170,20,"收款人："+(Utils.isBlank(B.chargeInfo.employeeName)?B.chargeInfo.employeeName:""));LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");LODOP.ADD_PRINT_TEXT(195+n,45,170,20,userInfo_aclc.clinicName);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");var m=B.chargeInfo.phone;var h=B.chargeInfo.mobile;if(!m){m=h}LODOP.ADD_PRINT_TEXT(220+n,45,170,20,"电话："+m);LODOP.SET_PRINT_STYLEA(0,"FontName","微软雅黑");charge_model.doPrint(f)})},chineseNumber_split:function(b,a){if(a>b.toString().length-1){return"零"}var c=new Array("零","壹","贰","叁","肆","伍","陆","柒","捌","玖");return c[b.toString().substring(b.toString().length-a-1,b.toString().length-a)]},textLinePx:function(j,k,d){if(!Utils.isBlank(j)){return d*20}var h="^[a-z]+$";var c="^[A-Z]+$";var f="^[0-9]+$";var b=j.split("");var g=0;for(var e=0;e<b.length;e++){if(b[e].match(h)||b[e].match(f)){g+=0.5}else{if(b[e].match(c)){g+=0.8}else{g+=1}}}var a=(Math.ceil(g/k)-d)>0?(Math.ceil(g/k)*17.5):(d*20);return a},buildHtmlPrintData:function(u){u.chargeInfo.clinicName=userInfo_aclc.clinicName;u.chargeInfo.printDate=new Date().getTime();if(u.chargeInfo.chargeDate&&!isNaN(u.chargeInfo.chargeDate)){u.chargeInfo.chargeDate=Utils.timeStampToDateStr(u.chargeInfo.chargeDate,9)}u.chargeInfo.actualTotalMoney=((Utils.isBlank(u.chargeInfo.actualTotalMoney)?u.chargeInfo.actualTotalMoney:"0")/1).toFixed(2);u.chargeInfo.feeTotalMoney=((Utils.isBlank(u.chargeInfo.feeTotalMoney)?u.chargeInfo.feeTotalMoney:"0")/1).toFixed(2);u.chargeInfo.payMoney=((Utils.isBlank(u.chargeInfo.payMoney)?u.chargeInfo.payMoney:"0")/1).toFixed(2);u.chargeInfo.refundMoney=((Utils.isBlank(u.chargeInfo.refundMoney)?u.chargeInfo.refundMoney:"0")/1).toFixed(2);u.chargeInfo.discountMoney=((Utils.isBlank(u.chargeInfo.discountMoney)?u.chargeInfo.discountMoney:"0")/1).toFixed(2);u.chargeInfo.oweMoney=((Utils.isBlank(u.chargeInfo.oweMoney)?u.chargeInfo.oweMoney:"0")/1).toFixed(2);var k=new Date().getFullYear();var t=new Date().getMonth()+1;var q=new Date().getDate();u.chargeInfo.paymentType=u.isOwePrint!=1?"治疗费":"欠费补交";var n=((Utils.isBlank(u.chargeInfo.actualMoney)?u.chargeInfo.actualMoney:"0")/1).toFixed(2);u.chargeInfo.actualMoney=n;u.chargeInfo.chineseNumber=chineseNumber(n);u.chargeInfo.year=k;u.chargeInfo.month=t;u.chargeInfo.date=q;u.chargeInfo.memberCardNumber=u.memberCardNumber;if(u.memberCardNumber){u.chargeInfo.memberCardYe=((Utils.isBlank(u.ye)?u.ye:"0")/1).toFixed(2)}if(u.agents&&u.agents.length==1){var g=u.agents[0];if(g!=null&&g!=""){u.chargeInfo.agent=g+"剂"}}if(u.payChannel){u.chargeInfo.payType=Utils.trimObj(this.getPayChannelStr(u.payChannel.payType,u.memberCardNumber,u.payChannel.payKind,u.payChannel.payType2nd));var s=charge_model.getPayChannelName(u.payChannel.payType)+(u.payChannel.payMoney1st/1).toFixed(2)+"元";if(u.payChannel.payType2nd){s=s+"、"+charge_model.getPayChannelName(u.payChannel.payType2nd)+(u.payChannel.payMoney2nd/1).toFixed(2)+"元"}u.chargeInfo.payDetail=s}var d=u.feeList;for(var r=0;r<u.feeList.length;r++){u.feeList[r].itemPrice=(u.feeList[r].itemPrice/1).toFixed(2);u.feeList[r].totalMoney=(u.feeList[r].totalMoney/1).toFixed(2)}if(u.mainList){for(var r=0;r<u.mainList.length;r++){u.mainList[r].ITEMMONEY=(u.mainList[r].ITEMMONEY/1).toFixed(2)}}u.detailList=[];var e=0;var m=0;var p=0;var j=0;var b=0;var o=new Array("药费","治疗费","材料费","取整费","欠费补交");$.each(u.feeList,function(v){var w=u.feeList[v];switch(w.ACOGRAPHY_TYPE){case 11:p+=parseFloat(w.totalMoney);break;case 4:case 5:e+=parseFloat(w.totalMoney);break;case 99:j+=parseFloat(w.totalMoney);break;case 98:b+=parseFloat(w.totalMoney);break;default:m+=parseFloat(w.totalMoney);break}});var h=new Array(e,m,p,j,b);for(var r=0;r<5;r++){var l=(h[r]/1).toFixed(2);if(l!=0){var a={};a.feeName=o[r];a.feeNum=l+"元";u.detailList.push(a)}}var f=u.chargeInfo.phone;var c=u.chargeInfo.mobile;if(!f){f=c}u.chargeInfo.phone=f;return u},printModel:function(c,b,f,h,g,d,e,a){wjPrintUtils.getPrintSetting(wjPrintUtils.printFunction.charge,function(j,i){if(j==1){if(h){h()}charge_model.printCallback(c,g,e,a)}else{if(j==2){$.paSuccess("正在打印...");wjPrintUtils.print(i,b,function(k){if(k.code!=SUCCESSCODE){$.paWarn(k.message)}if(d){d()}})}else{$.paWarn("请先配置打印参数！")}}})},printCallback:function(c,h,b,a){var f=session_cache.getCache("chargeParamterData");localStorage.setItem("chargePrintInfo",JSON.stringify(c));if(Utils.isBlank(h)){h.call()}try{var g=f["5009"];switch(g){case"1":charge_model.chargeListForLarge(c,h,b,a);break;case"2":charge_model.chargeList(c,h,b,a);break;case"4":charge_model.chargeCNList(c,h,b,a);break;case"5":charge_model.chargeListForNoDetails(c,h,b,a);break;case"6":charge_model.getYBType(function(){if(ybTypePrint=="YB0002"){var e=Utils.isBlank(c.isOwePrint)?"2":"1";window.open("./yb/xiamen/print.html?chargeId=1&bizNo=1&source="+e);return}if(Utils.isBlank(c.isOwePrint)&&c.isOwePrint==1){charge_model.printCQNoDetailRefund(c,h,b,a)}else{charge_model.MICQPrintNoDetail(c.chargeInfo.CHARGE_ID,h,b,a)}});break;default:charge_model.chargeListForTemplate(c,h,b,a);break}}catch(d){$.paError("打印异常！")}},getYBType:function(c){var a={url:ContextClinc_Server+"pubClinic/getMiTypeList",contentType:"application/json; charset=utf-8",method:"POST",type:"POST",dataType:"json",showMask:true};var b=Utils.myAjaxHandler(a);b.done(function(e){if(e!=null&&e.errorCode==SUCCESSCODE){var d=e.data;if(d!=null&&d.length>0){$.each(d,function(f,g){ybTypePrint=g.miTypeCode.toUpperCase()})}c.call()}}).fail(function(d){$.paError("打印清单发生异常！")})},doPrint:function(b){LODOP=getLodop();var a=config_cache.getCache("curChargePrint");if(a){LODOP.SET_PRINTER_INDEX(a)}LODOP.SET_PRINT_MODE("TRYLINKPRINTER_NOALERT",true);if(typeof(isChargePreview)!="undefined"&&isChargePreview==true){$.paSuccess("正在预览...");LODOP.PREVIEW();isChargePreview=false}else{$.paSuccess("正在打印...");LODOP.PRINT()}if(b){b()}}});