$(function(){$(".cause_box").ketchup();session_cache.removeCache("chargeParamterData");renderChargeMag.getListData();renderChargeMag.getCGRecordPageData();renderChargeMag.initParamterData();renderChargeMag.hideOrShowYB();$("#search_btn").on("click",function(){if(!$(this).hasClass("disabled")){$(this).addClass("disabled");chargeRecord.showChargeInfo();renderPermissionControl();$(this).removeClass("disabled")}});$("#advanced_search_btn").click(function(){var b=$(".advanced-search-box");if(b.is(":hidden")){$(".tab-top-wrap").css("height","120px");$(".table-wrap").css("padding-top","120px");b.show()}else{$(".tab-top-wrap").css("height","70px");$(".table-wrap").css("padding-top","70px");b.hide()}});$(".exit").click(function(){$(".refundpop").hide()});$("#printerSet").on("click",function(){managePrint.showChoosePrintDiag()});$("#printerEvent").on("click",function(){managePrint.savePrinterInfo();$("#popPrint").hide()});var a=Utils.timeStampToDateStr(new Date(),7);$("#start_date_time").datetimepicker({lang:"ch",format:"Y-m-d",timepicker:false,maxDate:a});$("#end_date_time").datetimepicker({lang:"ch",format:"Y-m-d",timepicker:false,maxDate:a});$("#charge_table").on("click","tr",function(b){if(!($(b.target).is("a")||$(b.target).is(".drop-icon")||$(b.target).is(".pay-type"))){var c=$(this).data("chargeInfo");showChargeDetail(c)}});$("#start_date_time").val(a);$("#end_date_time").val(a);$(".common-table tr:gt(0)").remove();chargeRecord.showChargeInfo();renderPermissionControl()});var renderChargeMag=Class.create({listData:[],hideOrShowYB:function(){getYBData(function(b){var a=b.clinicInfo||null;if(!a||a.miOpenFlag==1){session_cache.setCache("IS_YB_CLINIC","0")}else{session_cache.setCache("IS_YB_CLINIC","1");$("#charge_table_head").find("#ybTotalMoney").removeClass("dsn");$("#charge_table_head").find("#paymentTypeName").removeClass("dsn")}})},getListData:function(){var c=session_cache.getCache("recordDictData");if(c!=null){renderChargeMag.listData=c;this.renderChargeData(c);return}var d=this;var a=[];a.push("T22");a.push("T23");var f={dicts:a};var b={method:"GET",url:chargeUrl.dictItem,data:f,dataType:"json",async:true,showMask:false};var e=Utils.myAjaxHandler(b);e.done(function(g){if(!g.errorMessage){var h=g.data;h.receipt_type=h.T22;h.data_source=h.T23;renderChargeMag.listData=g.data;d.renderChargeData(g.data);session_cache.setCache("recordDictData",g.data)}else{$.paError(g.errorMessage,null);return}}).fail(function(g){$.paError("请求异常",null)}).always(function(){})},getPaymentType:function(){var b=session_cache.getCache("paymentTypeData");if(b!=null){renderChargeMag.listData=b;return}var d={typeName:"1"};var a={method:"POST",url:chargeUrl.queryPaymentTypeInfo,data:d,dataType:"json",async:false};var c=Utils.myAjaxHandler(a);c.done(function(e){if(e!=null&&e.errorCode==SUCCESSCODE){renderChargeMag.listData=e.data;session_cache.setCache("paymentTypeData",e.data);return}else{$.paError(e.errorMessage,null);return}}).fail(function(e){$.paError("请求异常",null)}).always(function(){})},getCGRecordPageData:function(){var b=session_cache.getCache("recordPayData");var c=this;var e={typeName:"1"};var a={method:"POST",url:chargeUrl.initCGRecordPage,data:e,dataType:"json",async:true,showMask:false};var d=Utils.myAjaxHandler(a);d.done(function(g){if(g!=null&&g.errorCode==SUCCESSCODE){renderChargeMag.listData=g.data;c.renderChargeData(g.data);session_cache.setCache("recordPayData",g.data);var f=g.data.T21;session_cache.setCache("IS_USE_YZT","0");$.each(f,function(h){if(f[h]["dictItemCode"]==chargeConstant.chargeYZT){session_cache.setCache("IS_USE_YZT","1");$("#charge_table_head").find(".paystate").removeClass("dsn")}});return}else{$.paError(g.errorMessage,null);return}}).fail(function(f){$.paError("请求异常",null)}).always(function(){})},initParamterData:function(){var b=session_cache.getCache("chargeParamterData");if(b!=null&&b!=undefined){return}var b=["5001","5002","5003","5004","5006","5009","5015"];var a={method:"POST",url:chargeUrl.selectCodeMapByCodes,data:JSON.stringify(b),dataType:"json",contentType:"application/json",async:true,showMask:false};var c=Utils.myAjaxHandler(a);c.done(function(d){if(d!=null&&d.errorCode==SUCCESSCODE){session_cache.setCache("chargeParamterData",d.data)}else{$.paError(d.errorMessage,null);return}}).fail(function(d){$.paError("请求异常",null)}).always(function(){})},renderChargeData:function(a){$.each(a,function(d){var e=$("#"+d+"");var c=a[d];var b={isNeedClear:false,isNeedAll:true,idKey:"dictItemCode",txtKey:"dictItemName"};e.WJZSDropdown(c,b,function(f,g){})});this.initListData()},initListData:function(){var b=config_cache.getCache("medical_user_data")["id"];if(b==undefined||b==null){b=""}var a={payment_type:"",T21:"",receipt_type:"",data_source:"",cashier:b};$.each(a,function(c){$("#"+c).SetWJZSDropdownSelectedData(a[c])})},fillDropMenu:function(a,b){if(b==null||b==undefined){$("#"+a).val("");$("#"+a).attr("")}else{$("#"+a).parent().find("li").each(function(c){if($(this).attr("value")==b){$("#"+a).val($(this).text());$("#"+a).attr("value",b);return false}})}},getCashierList:function(){var b=session_cache.getCache("recordCashierData");if(b!=null){renderChargeMag.listData=b;return}var d={typeName:"收费员"};var a={method:"POST",url:chargeUrl.queryCashierInfo,data:d,dataType:"json",async:false};var c=Utils.myAjaxHandler(a);c.done(function(e){if(e.errorCode=="E0000000"){renderChargeMag.listData=e.data;session_cache.setCache("recordCashierData",e.data)}else{$.paError(e.errorMessage,null);return}}).fail(function(e){$.paError("请求异常",null)}).always(function(){})}});