var isChargePreview=false;var chargePrintParams=null;var chargeData=null;var ybType="";var PrintTypeModel=Class.create({init:function(b,a){PrintTypeModel.removePrintItem();PrintTypeModel.renderFeePrintItem();if(a){PrintTypeModel.renderYBPrintItem(b)}chargeData=b;PrintTypeModel.getPrintItemParams(b,PrintTypeModel.renderRecipePrintItem)},bindSelectPrintEvent:function(){$(".checkboxes_fee li").click(function(){var a=$(this);var b=$(".checkboxes_fee li").filter(".checked").length;if(b==0){a.addClass("checked")}else{if(b==1){if(a.hasClass("checked")){a.removeClass("checked")}else{$(".checkboxes_fee li").filter(".checked").removeClass("checked");a.addClass("checked")}}else{return}}PrintTypeModel.renderPrintButton()});$("#print_return").click(function(){$(".checkboxes_fee li").removeClass("checked");$("#print_type_popup_fee").hide()});$(".close").click(function(){$(".checkboxes_fee li").removeClass("checked");$("#print_type_popup_fee").hide()})},bindPrintEvent:function(){$("#print_sure").click(function(){var b=$(".checkboxes_fee li.checked");PrintTypeModel.getYBType();if(b.hasClass("fee_print")){chargeRecord.printChargeList(chargeData)}else{if(b.hasClass("yb_fee_print")){PrintTypeModel.printYBChargeList(chargeData)}else{var c=b.attr("val");var d=PrintTypeModel.getRecipeOrInspectionData(c);var a=d.acographyType;if(a==4){PrintTypeModel.printWestRecipe(d)}else{if(a==1||a==2){PrintTypeModel.printInspection(d)}}}}$(".checkboxes_fee li").removeClass("checked");$("#print_type_popup_fee").hide()});$("#print_review").click(function(){reviewFlag=true;var b=$(".checkboxes_fee li.checked");if(b.hasClass("fee_print")){isChargePreview=true;chargeRecord.printChargeList(chargeData)}else{if(b.hasClass("yb_fee_print")){isChargePreview=true;PrintTypeModel.printYBChargeList(chargeData)}else{var c=b.attr("val");var d=PrintTypeModel.getRecipeOrInspectionData(c);var a=d.acographyType;if(a==4){PrintTypeModel.printWestRecipe(d)}else{if(a==1||a==2){PrintTypeModel.printInspection(d)}}}}$(".checkboxes_fee li").removeClass("checked");$("#print_type_popup_fee").hide()})},unbindEvent:function(){$(".checkboxes_fee li").unbind();$("#print_sure").unbind();$("#print_review").unbind()},renderRecipePrintItem:function(b){$(".fee_print").attr("val","fee1");var d=0;var a="";var c=0;b.sort(function(g,f){var e=g.itemNo;var h=f.itemNo;return e-h});$.each(b,function(f,h){d=h.acographyType;a=h.acographyTypeName;c=h.itemNo;var g=$("<li></li>").text(a);g.addClass("checkbox_fee print_item");g.attr("val",c);$(".checkboxes_fee").append(g)});PrintTypeModel.unbindEvent();PrintTypeModel.bindSelectPrintEvent();PrintTypeModel.bindPrintEvent();$("#print_type_popup_fee").show()},removePrintItem:function(){$(".checkboxes_fee li").remove()},renderPrintButton:function(){if($(".checkboxes_fee li.checked").length==1){$("#print_sure").attr("style","float:left; margin-right: 20px;margin-top: 20px;");$("#print_review").attr("style","float:left; margin-right: 20px;margin-top: 20px;")}else{$("#print_sure").attr("style","float:left; margin-right: 20px;margin-top: 20px; color: #bbbbbb; border: 1px solid #bbbbbb;background: transparent;");$("#print_review").attr("style","float:left; margin-right: 20px;margin-top: 20px; color: #bbbbbb; border: 1px solid #bbbbbb;background: transparent;")}},getPrintItemParams:function(c,f){var a=this;var e={chargeId:c.chargeId};var b={type:"POST",contentType:"application/json; charset=utf-8",url:ContextClinc_Server+"charge/getRecipeIdByChargeId",data:JSON.stringify(e),dataType:"json",async:true,showMask:true};var d=Utils.myAjaxHandler(b);d.error(function(){$.paError("请求未响应，请检查网络连接！")});d.done(function(g){if(g.errorCode=="E0000000"){chargePrintParams=g.data;f.call(a,g.data)}else{$.paError("获取打印数据发生错误！"+g.errorMessage)}})},printWestRecipe:function(a){var b=a;if(b!=null&&b.recipeId!=null&&b.acographyType==4){new WMPrescriptionPrint().printWestRecipeFacade(b.recipeId,b.acographyId,b.empiId,"1")}else{$.paWarn("处方信息为空！");return}},printInspection:function(a){if(a==null){$.paError("检验检查信息为空!");return}var c=2;var b=a.acographyId;var d=a.empiId;if(b!=null&&d!=null&&a.acographyType==1||a.acographyType==2){if(a.acographyType==1){print_model.examineFormPrint(b,d,c)}if(a.acographyType==2){print_model.inspectReportPrint(b,d,c)}}else{$.paError("检验检查信息为空!")}},getRecipeOrInspectionData:function(a){var b=chargePrintParams.filter(function(c,d){if(c.itemNo==a){return c}});if(b.length==1){return b[0]}else{return null}},renderFeePrintItem:function(){var a=$("<li></li>").text("费用清单");a.addClass("checkbox_fee fee_print");a.attr("val","fee1");a.addClass("checked");$(".checkboxes_fee").append(a)},renderYBPrintItem:function(){var c=self.userInfo.clinicParams.filter(function(d,e){if(d.parameterCode=="5009"){return d}});var a={1:"宽版",2:"窄版-通用",3:"12cm X 7.6cm",4:"窄版-中医专科",5:"窄版-隐藏明细"};$(".fee_print").text(a[c[0].parameterValue]);var b=$("<li></li>").text("医保清单");b.addClass("checkbox_fee yb_fee_print");b.attr("val","yb1");$(".checkboxes_fee").append(b)},printYBChargeList:function(b){var a={url:ContextClinc_Server+"pubClinic/getMiTypeList",contentType:"application/json; charset=utf-8",method:"POST",type:"POST",dataType:"json",showMask:true};var c=Utils.myAjaxHandler(a);c.done(function(e){if(e!=null&&e.errorCode==SUCCESSCODE){var d=e.data;if(d!=null&&d.length>0){$.each(d,function(f,g){if(g.miTypeCode.toUpperCase()=="YB0001"){window.open("./shenzhen/ybListPrint.html?chargeId="+b.chargeId);return}else{if(g.miTypeCode.toUpperCase()=="YB0002"){window.open("./yb/xiamen/print.html?chargeId="+b.chargeId+"&bizNo="+b.bizNo);return}else{if(g.miTypeCode.toUpperCase()=="YB0003"){charge_model.MICQPrintNoDetail(b.chargeId)}else{if(g.miTypeCode.toUpperCase()=="YB0004"){charge_model.MICDPrintNoDetail(b.chargeId)}else{if(g.miTypeCode.toUpperCase()=="YB0005"){window.open("./yb/shenzhen_new/ybListPrint.html?chargeId="+b.chargeId);return}}}}}})}}}).fail(function(d){$.paError("打印清单发生异常！")})},getYBType:function(){var a={url:ContextClinc_Server+"pubClinic/getMiTypeList",contentType:"application/json; charset=utf-8",method:"POST",type:"POST",dataType:"json",showMask:true};var b=Utils.myAjaxHandler(a);b.done(function(d){if(d!=null&&d.errorCode==SUCCESSCODE){var c=d.data;if(c!=null&&c.length>0){$.each(c,function(e,f){ybType=f.miTypeCode.toUpperCase()})}}}).fail(function(c){$.paError("打印清单发生异常！")})}});